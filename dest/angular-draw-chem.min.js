!function(){"use strict";angular.module("mmAngularDrawChem",["ngSanitize"]).config(["$sanitizeProvider",function(a){a.enableSvg()}])}(),function(){"use strict";function a(a,b,c,d,e,f){return{templateUrl:"draw-chem-editor.html",scope:{showEditor:"="},link:function(e,f,g){function h(a){var b=f.find("dc-content")[0],c=[parseFloat((a.clientX-b.getBoundingClientRect().left-2).toFixed(2)),parseFloat((a.clientY-b.getBoundingClientRect().top-2).toFixed(2))];return c}function i(){m=!1,n=!1,l=void 0}function j(b){var d="";d=a.draw(b,"cmpd1").generate(),c.setContent(d)}function k(b,c){return a.modifyStructure(b,angular.copy(e.chosenStructure),c,l)}var l,m=!1,n=!1;e.dialogStyle={},g.width&&(e.dialogStyle.width=g.width),g.height&&(e.dialogStyle.height=g.height),e.closeEditor=function(){c.closeEditor()},e.content=function(){return d.trustAsHtml(c.getContent())},e.clear=function(){c.clearContent()},e.transfer=function(){c.transferContent()},e.chosenStructure,e.currentStructure,e.customButtons=[],angular.forEach(b.custom,function(a){var b=a();e.customButtons.push({name:b.name,choose:function(){e.chosenStructure=b}})}),e.doOnMouseDown=function(b){var d=h(b);m=!0,""!==c.getContent()&&(l=a.isWithin(e.currentStructure,d).absPos,n=!0)},e.doOnMouseUp=function(a){var b=h(a);""!==c.getContent()?e.currentStructure=k(e.currentStructure,b):(e.currentStructure=angular.copy(e.chosenStructure).getDefault(),e.currentStructure.setOrigin(b)),j(e.currentStructure),i()},e.doOnMouseMove=function(a){var b,c,d;n&&(b=h(a),d=angular.copy(e.currentStructure),c=k(d,b),j(c))}}}}angular.module("mmAngularDrawChem").directive("drawChemEditor",a),a.$inject=["DrawChemShapes","DrawChemStructures","DrawChem","$sce","$window","DrawChemConst"]}(),function(){"use strict";function a(a){function b(a,b,c,d){this.coords=a,this.bonds=b,this.info=c,this.attachedBonds=d||[],this.next="",this.calculateNext()}var c={};return b.getOppositeBond=function(a){switch(a){case"N":return"S";case"NE1":return"SW1";case"NE2":return"SW2";case"E":return"W";case"SE1":return"NW1";case"SE2":return"NW2";case"S":return"N";case"SW1":return"NE1";case"SW2":return"NE2";case"W":return"E";case"NW1":return"SE1";case"NW2":return"SE2"}},b.prototype.attachBond=function(a){this.attachedBonds.push(a)},b.prototype.calculateNext=function(){function b(){var a=this.attachedBonds[0];switch(a){case"N":return"SE1";case"NE1":return"SE2";case"NE2":return"S";case"E":return"SW1";case"SE1":return"SW2";case"SE2":return"W";case"S":return"NW1";case"SW1":return"NW2";case"SW2":return"N";case"W":return"NE1";case"NW1":return"NE2";case"NW2":return"E"}}function c(){function a(a,b){return this.attachedBonds[0]===a&&this.attachedBonds[1]===b||this.attachedBonds[0]===b&&this.attachedBonds[1]===a}return a.call(this,"N","SE1")?"SW2":a.call(this,"NE1","SE2")?"W":a.call(this,"NE2","S")?"NW1":a.call(this,"E","SW1")?"NW2":a.call(this,"SE1","SW2")?"N":a.call(this,"SE2","W")?"NE1":a.call(this,"S","NW1")?"NE2":a.call(this,"SW1","NW2")?"E":a.call(this,"SW2","N")?"SE1":a.call(this,"W","NE1")?"SE2":a.call(this,"NW1","NE2")?"S":a.call(this,"NW2","E")?"SW1":void d.call(this)}function d(){var b,c=a.BONDS;for(b=0;b<c.length;b+=1)if(this.attachedBonds.indexOf(c[b].direction)<0)return c[b].direction}1===this.attachedBonds.length?this.next=b.call(this):2===this.attachedBonds.length?this.next=c.call(this):this.attachedBonds.length>2&&this.attachedBonds.length<12?this.next=d.call(this):this.attachedBonds.length>=12?this.next="max":this.next=""},b.prototype.setCoords=function(a){this.coords=a},b.prototype.getInfo=function(){return this.info},b.prototype.getAttachedBonds=function(){return this.attachedBonds},b.prototype.setPreceding=function(a){this.preceding=a},b.prototype.getPreceding=function(a){return"x"===a?this.preceding[0]:"y"===a?this.preceding[1]:this.preceding},b.prototype.getNext=function(){return this.next},b.prototype.setNext=function(a){this.next=a},b.prototype.getCoords=function(a){return"x"===a?this.coords[0]:"y"===a?this.coords[1]:this.coords},b.prototype.getBonds=function(a){return 0===arguments.length?this.bonds:this.bonds[a]},b.prototype.addBond=function(a){this.bonds.push(a)},b.prototype.addBonds=function(a){a.forEach(function(a){this.bonds.push(a)},this)},c.Atom=b,c}angular.module("mmAngularDrawChem").factory("DCAtom",a),a.$inject=["DrawChemConst"]}(),function(){"use strict";function a(a){function b(b,c){this.element=b,this.id=c,this.scale=1,this.transformAttr="",this.style={path:{stroke:"black","stroke-width":a.BOND_WIDTH*this.scale,fill:"none"},"circle.atom:hover":{opacity:"0.3",stroke:"black","stroke-width":a.BOND_WIDTH*this.scale},"circle.atom":{opacity:"0"},"circle.arom":{stroke:"black","stroke-width":a.BOND_WIDTH*this.scale,fill:"none"}}}var c={};return b.prototype.wrap=function(a,b){var c,d={};return"g"!==a||b||(b=d,b.id=this.id),b?(c="<"+a+" ",angular.forEach(b,function(a,b){c+=b+"='"+a+"' "}),this.element=c+">"+this.element+"</"+a+">"):this.element="<"+a+">"+this.element+"</"+a+">",this},b.prototype.transform=function(a,b){return this.transformAttr&&(this.transformAttr+=" "),this.transformAttr+=a+"("+b[0],b.length>1&&(this.transformAttr+=","+b[1]),this.transformAttr+=")",this},b.prototype.style=function(a){},b.prototype.generateUse=function(){return"<use xmlns:xlink='http://www.w3.org/1999/xlink' xlink:href='#"+this.id+"' transform='"+this.transformAttr+"'></use>"},b.prototype.generateStyle=function(){var a='<style type="text/css">';return angular.forEach(this.style,function(b,c){a+=c+"{",angular.forEach(b,function(b,c){a+=c+":"+b+";"}),a+="}"}),a+"</style>"},b.prototype.generate=function(){return this.wrap("svg").element},c.Shape=b,c}angular.module("mmAngularDrawChem").factory("DCShape",a),a.$inject=["DrawChemConst"]}(),function(){"use strict";function a(){function a(a,b){this.name=a,this.defs=b,this.defaultStructure=b[0]}var b={};return a.prototype.getDefs=function(){return this.defs},a.prototype.getDefault=function(){return this.defaultStructure},b.StructureCluster=a,b}angular.module("mmAngularDrawChem").factory("DCStructureCluster",a)}(),function(){"use strict";function a(){function a(a,b,c){this.name=a,this.structure=b,this.transform=[],this.origin=[],this.decorate=c}var b={};return a.prototype.setTransform=function(a,b){this.transform.push({name:a,content:b})},a.prototype.getTransform=function(a){var b,c=this.transform;for(b=0;b<c.length;b+=1)if(c[b].name===a)return c[b].content},a.prototype.setOrigin=function(a){this.origin=a},a.prototype.getOrigin=function(a){return"x"===a?this.origin[0]:"y"===a?this.origin[1]:this.origin},a.prototype.setStructure=function(a){this.structure=a},a.prototype.getStructure=function(a){return 0===arguments.length?this.structure:this.structure[a]},a.prototype.getName=function(){return this.name},a.prototype.getDecorate=function(){return this.decorate},b.Structure=a,b}angular.module("mmAngularDrawChem").factory("DCStructure",a)}(),function(){"use strict";function a(){function a(){b.BOND_LENGTH=b.SET_BOND_LENGTH||20,b.WIDTH_TO_LENGTH=.04,b.BOND_WIDTH=parseFloat((b.BOND_LENGTH*b.WIDTH_TO_LENGTH).toFixed(2)),b.CIRC_R=.12*b.BOND_LENGTH,b.BOND_N=[0,-b.BOND_LENGTH],b.BOND_S=[0,b.BOND_LENGTH],b.BOND_E=[parseFloat((b.BOND_LENGTH*Math.sqrt(3)/2).toFixed(2)),0],b.BOND_W=[-parseFloat((b.BOND_LENGTH*Math.sqrt(3)/2).toFixed(2)),0],b.BOND_NE1=[b.BOND_LENGTH/2,-parseFloat((b.BOND_LENGTH*Math.sqrt(3)/2).toFixed(2))],b.BOND_NE2=[parseFloat((b.BOND_LENGTH*Math.sqrt(3)/2).toFixed(2)),-b.BOND_LENGTH/2],b.BOND_SE1=[parseFloat((b.BOND_LENGTH*Math.sqrt(3)/2).toFixed(2)),b.BOND_LENGTH/2],b.BOND_SE2=[b.BOND_LENGTH/2,parseFloat((b.BOND_LENGTH*Math.sqrt(3)/2).toFixed(2))],b.BOND_SW1=[-b.BOND_LENGTH/2,parseFloat((b.BOND_LENGTH*Math.sqrt(3)/2).toFixed(2))],b.BOND_SW2=[-parseFloat((b.BOND_LENGTH*Math.sqrt(3)/2).toFixed(2)),b.BOND_LENGTH/2],b.BOND_NW1=[-parseFloat((b.BOND_LENGTH*Math.sqrt(3)/2).toFixed(2)),-b.BOND_LENGTH/2],b.BOND_NW2=[-b.BOND_LENGTH/2,-parseFloat((b.BOND_LENGTH*Math.sqrt(3)/2).toFixed(2))],b.BONDS=[{direction:"N",bond:b.BOND_N},{direction:"S",bond:b.BOND_S},{direction:"E",bond:b.BOND_E},{direction:"W",bond:b.BOND_W},{direction:"NE1",bond:b.BOND_NE1},{direction:"NE2",bond:b.BOND_NE2},{direction:"NW1",bond:b.BOND_NW1},{direction:"NW2",bond:b.BOND_NW2},{direction:"SE1",bond:b.BOND_SE1},{direction:"SE2",bond:b.BOND_SE2},{direction:"SW1",bond:b.BOND_SW1},{direction:"SW2",bond:b.BOND_SW2}]}var b={};return b.SET_BOND_LENGTH,b.setBondLength=function(c){b.SET_BOND_LENGTH=c,a()},a(),b}angular.module("mmAngularDrawChem").factory("DrawChemConst",a)}(),function(){"use strict";function a(){function a(a){for(var b=0;b<f.length;b++)if(f[b].name===a)return!0;return!1}function b(a){for(var b=0;b<f.length;b++)if(f[b].name===a)return f[b]}function c(a,b){var c;for(c=0;c<f.length;c++)if(f[c].name===b)return f[c].content=a;f.push({name:b,content:a})}var d={},e=!1,f=[],g={};return d.showEditor=function(){return e},d.runEditor=function(c){var d;e=!0,a(c)||f.push({name:c,content:""}),d=b(c),g.name=d.name,g.content=d.content},d.getContent=function(a){if("string"==typeof a){var c=b(a);return"undefined"==typeof c?"":c.content}return g.content},d.setContent=function(a,b){"undefined"==typeof b?g.content=a:c(a,b)},d.transferContent=function(){c(g.content,g.name)},d.closeEditor=function(){e=!1,g={}},d.clearContent=function(a){"string"==typeof a?c("",a):g.content=""},d}angular.module("mmAngularDrawChem").factory("DrawChem",a)}(),function(){"use strict";function a(a,b,c){function d(a){function c(a,b,d){var h,i,j,k=[f[f.length-1][0],f[f.length-1][1]];for(b.length>0&&(j=[k[0]+b[0].getCoords("x"),k[1]+b[0].getCoords("y")],f.push([j[0],j[1],g]),d.push("L"),d.push(j),"Z"===b[0].getInfo()?(d.push("Z"),b[0].getBonds().length>0&&(i=e.push(["M",j]),c(j,b[0].getBonds(),e[i-1]))):c(b[0].getCoords(),b[0].getBonds(),d)),h=1;h<b.length;h+=1)j=[k[0]+b[h].getCoords("x"),k[1]+b[h].getCoords("y")],f.push([j[0],j[1],g]),i=e.push(["M",k,"L",j]),c(j,b[h].getBonds(),e[i-1])}function d(){var a,b,c,d,f,g=[];for(a=0;a<e.length;a+=1){for(c=e[a],f="",b=0;b<c.length;b+=1)d=c[b],f+="string"==typeof d?d+" ":d[0]+" "+d[1]+" ";g.push(f)}return g}var e=[],f=[],g=b.CIRC_R,h=e.push(["M",a.getOrigin()]);return f.push([a.getOrigin("x"),a.getOrigin("y"),g]),c(a.getOrigin(),a.getStructure(0).getBonds(),e[h-1]),{paths:d(),circles:f}}function e(a,c){var d=b.CIRC_R;return Math.abs(a[0]-c[0])<d&&Math.abs(a[1]-c[1])<d}var f={},g=c.Atom;return f.modifyStructure=function(a,b,c,d){function h(b,n){function o(a,b,c){null!==b&&(p(b,c),a.addBonds(b.getStructure(0).getBonds()))}function p(b,c){var d,e,h,i,j=b.getStructure(0).getBonds();for(d=0;d<j.length;d+=1)if(e=[j[d].getCoords("x")+c[0],j[d].getCoords("y")+c[1]],h=f.isWithin(a,e).foundAtom,"undefined"!=typeof h)return i=g.getOppositeBond(b.getName()),h.attachBond(i),h.calculateNext()}var q,r;for(q=0;q<b.length;q+=1){if(r=[b[q].getCoords("x")+n[0],b[q].getCoords("y")+n[1]],!m&&e(r,c))return l=k(b[q]),o(b[q],l,r),m=!0,a;if(!m&&i(d,r,5))return l=j(b[q]),o(b[q],l,r),m=!0,a;h(b[q].getBonds(),r)}}function i(a,b,c){return"undefined"==typeof a||"undefined"==typeof b?!1:a[0].toFixed(c)===b[0].toFixed(c)&&a[1].toFixed(c)===b[1].toFixed(c)}function j(a){function b(a,b,e,f){return c[0]>d[0]+a&&c[0]<=d[0]+b&&c[1]>=d[1]+e&&c[1]<=d[1]+f}var e,f=Math.PI/6,g=Math.sqrt(Math.pow(c[0]-d[0],2)+Math.pow(c[1]-d[1],2)),h=Math.sin(f/2)*g,i=Math.cos(3*f/2)*g,j=Math.cos(f/2)*g,l=Math.sin(3*f/2)*g;return b(-h,h,-g,-j)?e="N":b(h,i,-j,-l)?e="NE1":b(i,j,-l,-h)?e="NE2":b(j,g,-h,h)?e="E":b(i,j,h,l)?e="SE1":b(h,i,l,j)?e="SE2":b(-h,h,j,g)?e="S":b(-i,-h,l,j)?e="SW1":b(-j,-i,h,l)?e="SW2":b(-g,-j,-h,h)?e="W":b(-j,-i,-l,-h)?e="NW1":b(-i,-h,-j,-l)&&(e="NW2"),k(a,e)}function k(a,c){var d,e,f,g,h;if(1===b.defs.length)return b.getDefault().getStructure(0).getBonds();for(d=0;d<b.defs.length;d+=1){if(e=b.defs[d],h=a.getNext(),"max"===h)return null;if(f=e.getName(),g=c||h,g===f)return a.attachBond(f),a.calculateNext(),e}}var l,m=!1,n=a.getOrigin();return h(a.getStructure(),n),a},f.isWithin=function(a,b){function c(a,g){var h,i;for(h=0;h<a.length;h+=1)i=[a[h].getCoords("x")+g[0],a[h].getCoords("y")+g[1]],!d&&e(i,b)?(d=!0,f.foundAtom=a[h],f.absPos=i):c(a[h].getBonds(),i)}var d=!1,f={},g=a.getOrigin();return c(a.getStructure(),g),f},f.draw=function(c,e){function f(){var a="";return i.forEach(function(b){a+="<path d='"+b+"'></path>"}),j.forEach(function(b){a+="<circle class='atom' cx='"+b[0]+"' cy='"+b[1]+"' r='"+b[2]+"' ></circle>"}),"aromatic"===c.getDecorate()&&(a+="<circle class='arom' cx='"+c.getOrigin("x")+"' cy='"+(c.getOrigin("y")+b.BOND_LENGTH)+"' r='"+.45*b.BOND_LENGTH+"' ></circle>"),a}var g,h=d(c),i=h.paths,j=h.circles;return g=new a.Shape(f(),e),g.element=g.generateStyle()+g.element,g.wrap("g")},f}angular.module("mmAngularDrawChem").factory("DrawChemShapes",a),a.$inject=["DCShape","DrawChemConst","DCAtom"]}(),function(){"use strict";function a(a,b,c,d){var e={},f=d.Atom,g=c.StructureCluster,h=a.BOND_N,i=a.BOND_S,j=a.BOND_W,k=a.BOND_E,l=a.BOND_NE1,m=a.BOND_NE2,n=a.BOND_NW1,o=a.BOND_NW2,p=a.BOND_SE1,q=a.BOND_SE2,r=a.BOND_SW1,s=a.BOND_SW2;return e.benzene=function(){var a="benzene",c=[new b.Structure("N",[new f([0,0],[new f(p,[new f(i,[new f(s,[new f(n,[new f(h,[],"Z",["S","NE2"])],"",["SE1","N"])],"",["NE2","NW1"])],"",["N","SW2"])],"",["NW1","S"])],"",["SE1","SW2"])],"aromatic")],d=new g(a,c);return d},e.cyclohexane=function(){var a="cyclohexane",c=[new b.Structure("N",[new f([0,0],[new f(p,[new f(i,[new f(s,[new f(n,[new f(h,[],"Z",["S","NE2"])],"",["SE1","N"])],"",["NE2","NW1"])],"",["N","SW2"])],"",["NW1","S"])],"",["SE1","SW2"])])],d=new g(a,c);return d},e.singleBond=function(){var a="single-bond",c=[new b.Structure("N",[new f([0,0],[new f(h,[],"",["S"])],"",["N"])]),new b.Structure("NE1",[new f([0,0],[new f(l,[],"",["SW1"])],"",["NE1"])]),new b.Structure("NE2",[new f([0,0],[new f(m,[],"",["SW2"])],"",["NE2"])]),new b.Structure("E",[new f([0,0],[new f(k,[],"",["W"])],"",["E"])]),new b.Structure("SE1",[new f([0,0],[new f(p,[],"",["NW1"])],"",["SE1"])]),new b.Structure("SE2",[new f([0,0],[new f(q,[],"",["NW2"])],"",["SE2"])]),new b.Structure("S",[new f([0,0],[new f(i,[],"",["N"])],"",["S"])]),new b.Structure("SW1",[new f([0,0],[new f(r,[],"",["NE1"])],"",["SW1"])]),new b.Structure("SW2",[new f([0,0],[new f(s,[],"",["NE2"])],"",["SW2"])]),new b.Structure("W",[new f([0,0],[new f(j,[],"",["E"])],"",["W"])]),new b.Structure("NW1",[new f([0,0],[new f(n,[],"",["SE1"])],"",["NW1"])]),new b.Structure("NW2",[new f([0,0],[new f(o,[],"",["SE2"])],"",["NW2"])])],d=new g(a,c);return d},e.custom=[e.benzene,e.cyclohexane,e.singleBond],e}angular.module("mmAngularDrawChem").factory("DrawChemStructures",a),a.$inject=["DrawChemConst","DCStructure","DCStructureCluster","DCAtom"]}();