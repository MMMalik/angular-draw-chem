!function(){"use strict";angular.module("mmAngularDrawChem",["ngSanitize","ui.bootstrap"]).config(["$sanitizeProvider",function(a){a.enableSvg()}])}(),function(){"use strict";function a(a){function b(a,b,c,d){this.coords=a,this.bonds=b,this.info=c,this.attachedBonds=d||[],this.next="",this.label,this.calculateNext()}var c={};return b.getOppositeDirection=function(a){switch(a){case"N":return"S";case"NE1":return"SW1";case"NE2":return"SW2";case"E":return"W";case"SE1":return"NW1";case"SE2":return"NW2";case"S":return"N";case"SW1":return"NE1";case"SW2":return"NE2";case"W":return"E";case"NW1":return"SE1";case"NW2":return"SE2"}},b.prototype.attachBond=function(a){this.attachedBonds.push(a)},b.prototype.calculateNext=function(){function b(){var a=this.attachedBonds[0];switch(a){case"N":return"SE1";case"NE1":return"SE2";case"NE2":return"S";case"E":return"SW1";case"SE1":return"SW2";case"SE2":return"W";case"S":return"NW1";case"SW1":return"NW2";case"SW2":return"N";case"W":return"NE1";case"NW1":return"NE2";case"NW2":return"E"}}function c(){function a(a,b){return this.attachedBonds[0]===a&&this.attachedBonds[1]===b||this.attachedBonds[0]===b&&this.attachedBonds[1]===a}return a.call(this,"N","SE1")?"SW2":a.call(this,"NE1","SE2")?"W":a.call(this,"NE2","S")?"NW1":a.call(this,"E","SW1")?"NW2":a.call(this,"SE1","SW2")?"N":a.call(this,"SE2","W")?"NE1":a.call(this,"S","NW1")?"NE2":a.call(this,"SW1","NW2")?"E":a.call(this,"SW2","N")?"SE1":a.call(this,"W","NE1")?"SE2":a.call(this,"NW1","NE2")?"S":a.call(this,"NW2","E")?"SW1":void d.call(this)}function d(){var b,c=a.BONDS;for(b=0;b<c.length;b+=1)if(this.attachedBonds.indexOf(c[b].direction)<0)return c[b].direction}1===this.attachedBonds.length?this.next=b.call(this):2===this.attachedBonds.length?this.next=c.call(this):this.attachedBonds.length>2&&this.attachedBonds.length<12?this.next=d.call(this):this.attachedBonds.length>=12?this.next="max":this.next=""},b.prototype.setCoords=function(a){this.coords=a},b.prototype.getInfo=function(){return this.info},b.prototype.getAttachedBonds=function(){return this.attachedBonds},b.prototype.setPreceding=function(a){this.preceding=a},b.prototype.getPreceding=function(a){return"x"===a?this.preceding[0]:"y"===a?this.preceding[1]:this.preceding},b.prototype.getNext=function(){return this.next},b.prototype.setLabel=function(a){this.label=a},b.prototype.getLabel=function(){return this.label},b.prototype.setNext=function(a){this.next=a},b.prototype.getCoords=function(a){return"x"===a?this.coords[0]:"y"===a?this.coords[1]:this.coords},b.prototype.getBonds=function(a){return 0===arguments.length?this.bonds:this.bonds[a]},b.prototype.addBond=function(a){this.bonds.push(a)},b.prototype.addBonds=function(a){a.forEach(function(a){this.bonds.push(a)},this)},c.Atom=b,c}angular.module("mmAngularDrawChem").factory("DCAtom",a),a.$inject=["DrawChemConst"]}(),function(){"use strict";function a(){function a(a,b){this.type=a,this.atom=b}var b={};return a.prototype.setType=function(a){this.type=a},a.prototype.getType=function(){return this.type},a.prototype.setAtom=function(a){this.atom=a},a.prototype.getAtom=function(){return this.atom},b.Bond=a,b}angular.module("mmAngularDrawChem").factory("DCBond",a)}(),function(){"use strict";function a(){function a(a,b,c){this.labelName=a,this.bonds=b,this.mode=c}var b={};return a.prototype.getLabelName=function(){return this.labelName},a.prototype.setLabelName=function(a){this.labelName=a},a.prototype.getMaxBonds=function(){return this.bonds},a.prototype.setMaxBonds=function(a){this.bonds=a},a.prototype.getMode=function(){return this.mode},a.prototype.setMode=function(a){this.mode=a},b.Label=a,b}angular.module("mmAngularDrawChem").factory("DCLabel",a)}(),function(){"use strict";function a(a){function b(b,d,e){this.elementFull=b,this.elementMini=d,this.id=e,this.scale=1,this.transformAttr="",this.style={expanded:{"circle.atom:hover":{opacity:"0.3",stroke:"black","stroke-width":a.BOND_WIDTH*this.scale},"text:hover":{opacity:"0.3"},"circle.atom":{opacity:"0"}},base:{path:{stroke:"black","stroke-width":a.BOND_WIDTH*this.scale,fill:"none"},"path.wedge":{stroke:"black","stroke-width":a.BOND_WIDTH*this.scale,fill:"black"},"circle.arom":{stroke:"black","stroke-width":a.BOND_WIDTH*this.scale,fill:"none"},text:{"font-family":c.font,cursor:"default","font-size":c.fontSize+"px"},"tspan.sub":{"font-size":c.subFontSize+"px"},"polygon.text":{fill:"white"}}}}var c={};return c.fontSize=18,c.subFontSize=14,c.font="Arial",b.prototype.setMinMax=function(a){this.minMax=a},b.prototype.wrap=function(a,b,c){var d,e={};return"g"!==b||c||(c=e,c.id=this.id),c?(d="<"+b+" ",angular.forEach(c,function(a,b){d+=b+"='"+a+"' "}),"full"===a?this.elementFull=d+">"+this.elementFull+"</"+b+">":"mini"===a&&(this.elementMini=d+">"+this.elementMini+"</"+b+">")):"full"===a?this.elementFull="<"+b+">"+this.elementFull+"</"+b+">":"mini"===a&&(this.elementMini="<"+b+">"+this.elementMini+"</"+b+">"),this},b.prototype.transform=function(a,b){return this.transformAttr&&(this.transformAttr+=" "),this.transformAttr+=a+"("+b[0],b.length>1&&(this.transformAttr+=","+b[1]),this.transformAttr+=")",this},b.prototype.generateStyle=function(a){var b='<style type="text/css">';return"expanded"===a?a={base:this.style.base,expanded:this.style.expanded}:"base"===a&&(a={base:this.style.base,expanded:{}}),angular.forEach(a,function(a,c){angular.forEach(a,function(a,c){b+=c+"{",angular.forEach(a,function(a,c){b+=c+":"+a+";"}),b+="}"})}),b+"</style>"},c.Shape=b,c}angular.module("mmAngularDrawChem").factory("DCShape",a),a.$inject=["DrawChemConst"]}(),function(){"use strict";function a(a){function b(a,b){this.name=a,this.defs=b,this.defaultStructure=b[0]}var c={};return b.prototype.getDefs=function(){return this.defs},b.prototype.getDefault=function(){return this.defaultStructure},b.prototype.getStructure=function(b,c){var d,e=a.getDirection(b,c);for(d=0;d<this.defs.length;d+=1)if(this.defs[d].getName()===e)return this.defs[d]},c.StructureCluster=b,c}angular.module("mmAngularDrawChem").factory("DCStructureCluster",a),a.$inject=["DrawChemShapes"]}(),function(){"use strict";function a(){function a(a,b,c){this.name=a,this.structure=b,this.transform=[],this.origin=[],this.decorate=c||{}}var b={};return a.prototype.setTransform=function(a,b){this.transform.push({name:a,content:b})},a.prototype.getTransform=function(a){var b,c=this.transform;for(b=0;b<c.length;b+=1)if(c[b].name===a)return c[b].content},a.prototype.setOrigin=function(a){this.origin=a,angular.forEach(this.decorate,function(b,c){b.forEach(function(b){b[0]+=a[0],b[1]+=a[1]})})},a.prototype.getOrigin=function(a){return"x"===a?this.origin[0]:"y"===a?this.origin[1]:this.origin},a.prototype.setStructure=function(a){this.structure=a},a.prototype.addToStructures=function(a){this.structure.push(a)},a.prototype.getStructure=function(a){return 0===arguments.length?this.structure:this.structure[a]},a.prototype.getName=function(){return this.name},a.prototype.getDecorate=function(a){return this.decorate[a]},a.prototype.addDecorate=function(a,b){"undefined"==typeof this.decorate[a]&&(this.decorate[a]=[]),this.decorate[a].push(b)},b.Structure=a,b}angular.module("mmAngularDrawChem").factory("DCStructure",a)}(),function(){"use strict";function a(a,b,c,d){var e={};return e.forward=function(){a.moveRightInStructures(),null===a.getCurrentStructure()?b.clearContent():d.drawStructure(a.getCurrentStructure())},e.close=function(){b.closeEditor()},e.clear=function(){a.addStructure(null),a.setCurrentSvg("")},e.undo=function(){a.moveLeftInStructures(),null===a.getCurrentStructure()?b.clearContent():d.drawStructure(a.getCurrentStructure())},e.transfer=function(){var d,e,f=a.getCurrentStructure(),g="";null!==f&&(d=c.draw(f,"cmpd1"),e={viewBox:(d.minMax.minX-20).toFixed(2)+" "+(d.minMax.minY-20).toFixed(2)+" "+(d.minMax.maxX-d.minMax.minX+40).toFixed(2)+" "+(d.minMax.maxY-d.minMax.minY+40).toFixed(2),height:"100%",width:"100%",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},g=d.wrap("mini","g").wrap("mini","svg",e).elementMini),b.setContent(g),b.setStructure(f),b.transferContent()},e.actions=[{name:"undo",action:e.undo},{name:"forward",action:e.forward},{name:"transfer",action:e.transfer},{name:"clear",action:e.clear},{name:"close",action:e.close}],e}angular.module("mmAngularDrawChem").factory("DrawChemDirectiveActions",a),a.$inject=["DrawChemCache","DrawChem","DrawChemShapes","DrawChemDirectiveUtils"]}(),function(){"use strict";function a(a,b){var c={};return c.drawStructure=function(c){var d="";d=a.draw(c,"cmpd1"),b.setCurrentSvg(d.wrap("full","g").wrap("full","svg").elementFull)},c.resetMouseFlags=function(a){angular.forEach(a,function(b,c){"boolean"==typeof b?a[c]=!1:a[c]=void 0})},c.subtractCoords=function(a,b){return[a[0]-b[0],a[1]-b[1]]},c.isContentEmpty=function(){return null===b.getCurrentStructure()},c.innerCoords=function(a,b){var c=a.find("dc-content")[0],d=[parseFloat((b.clientX-c.getBoundingClientRect().left-2).toFixed(2)),parseFloat((b.clientY-c.getBoundingClientRect().top-2).toFixed(2))];return d},c.modifyStructure=function(b,c,d,e,f){return a.modifyStructure(angular.copy(b),angular.copy(c),d,e,f)},c}angular.module("mmAngularDrawChem").factory("DrawChemDirectiveUtils",a),a.$inject=["DrawChemShapes","DrawChemCache"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j){return{templateUrl:a.getPath()+"draw-chem-editor.html",scope:{showEditor:"="},link:function(j,k,l){function m(a){function c(){r.downAtomCoords=b.isWithin(d.getCurrentStructure(),r.downMouseCoords).absPos,"undefined"!=typeof r.downAtomCoords&&(r.downOnAtom=!0)}return 1!==a.which?void 0:(r.downMouseCoords=g.innerCoords(k,a),r.mouseDown=!0,void(g.isContentEmpty()||c()))}function n(a){function c(){var a=angular.copy(d.getCurrentStructure()),c=b.isWithin(a,r.downMouseCoords).foundAtom,e=c.getLabel();return"label"===p?c.setLabel(angular.copy(j.chosenLabel)):"customLabel"===p&&c.setLabel(new q(j.customLabel,0,"lr")),"undefined"!=typeof e&&("lr"===e.getMode()?c.getLabel().setMode("rl"):"rl"===e.getMode()&&c.getLabel().setMode("lr")),a}function f(){var a,b,c,f;return g.isContentEmpty()?r.movedOnEmpty?(a=angular.copy(j.chosenStructure.getStructure(i,r.downMouseCoords)),a.setOrigin(r.downMouseCoords)):(a=angular.copy(j.chosenStructure.getDefault()),a.setOrigin(i)):(b=r.movedOnEmpty?angular.copy(j.chosenStructure.getStructure(i,r.downMouseCoords)):angular.copy(j.chosenStructure.getDefault()),a=angular.copy(d.getCurrentStructure()),c=g.subtractCoords(i,a.getOrigin()),b.getStructure(0).setCoords(c),"undefined"!=typeof b.getDecorate("aromatic")&&(f=e.getBondByDirection(b.getName()).bond,a.addDecorate("aromatic",[i[0]+f[0],i[1]+f[1]])),a.addToStructures(b.getStructure(0))),a}var h,i=g.innerCoords(k,a);return 1!==a.which?void 0:(h=!r.downOnAtom||"label"!==p&&"customLabel"!==p?r.downOnAtom&&"structure"===p?g.modifyStructure(d.getCurrentStructure(),j.chosenStructure,i,r.downAtomCoords):f():c(),"undefined"!=typeof h&&(d.addStructure(h),g.drawStructure(h)),void g.resetMouseFlags(r))}function o(a){function b(){var a=d.getCurrentStructure();return g.modifyStructure(a,j.chosenStructure,f,r.downAtomCoords,!0)}function c(){var a=angular.copy(j.chosenStructure.getStructure(f,r.downMouseCoords));return a.setOrigin(r.downMouseCoords),r.movedOnEmpty=!0,a}var e,f=g.innerCoords(k,a);return"structure"!==p?void 0:void(r.downOnAtom?(e=b(),g.drawStructure(e)):r.mouseDown&&(e=c(),g.drawStructure(e)))}var p,q=h.Label,r={downAtomCoords:void 0,downMouseCoords:void 0,movedOnEmpty:!1,mouseDown:!1,downOnAtom:!1};j.pathToSvg=a.getPathToSvg(),j.dialogStyle={},l.width&&(j.dialogStyle.width=l.width),l.height&&(j.dialogStyle.height=l.height),j.content=function(){var a=i.trustAsHtml(d.getCurrentSvg());return a},j.actions=[],angular.forEach(f.actions,function(a){"close"===a.name&&(j[a.name]=a.action),j.actions.push({name:a.name,action:a.action})}),j.chosenLabel,j.customLabel="",j.chooseCustomLabel=function(){p="customLabel"},j.labels=[],angular.forEach(c.labels,function(a){j.labels.push({name:a.getLabelName(),choose:function(){j.chosenLabel=a,p="label"}})}),j.chosenStructure,j.customButtons=[],angular.forEach(c.custom,function(a){var b=a();j.customButtons.push({name:b.name,choose:function(){j.chosenStructure=b,p="structure"}})}),j.doOnMouseDown=function(a){try{m(a)}catch(b){console.log(b)}},j.lolo=function(){console.log("lolo")},j.doOnMouseUp=function(a){try{n(a)}catch(b){console.log(b)}},j.doOnMouseMove=function(a){try{o(a)}catch(b){console.log(b)}}}}}angular.module("mmAngularDrawChem").directive("drawChemEditor",a),a.$inject=["DrawChemPaths","DrawChemShapes","DrawChemStructures","DrawChemCache","DrawChemConst","DrawChemDirectiveActions","DrawChemDirectiveUtils","DCLabel","$sce","$compile"]}(),function(){"use strict";function a(){var a={},b=[{structure:null,svg:""}],c=0;return a.addStructure=function(d){c<b.length-1&&(b=b.slice(0,c+1)),b.push({structure:d,svg:""}),b.length>10&&b.shift(),a.moveRightInStructures()},a.getCurrentPosition=function(){return c},a.getStructureLength=function(){return b.length},a.getCurrentStructure=function(){return b[c].structure},a.getCurrentSvg=function(){return b[c].svg},a.setCurrentSvg=function(a){b[c].svg=a},a.moveLeftInStructures=function(){c>0&&(c-=1)},a.moveRightInStructures=function(){c<b.length-1&&(c+=1)},a}angular.module("mmAngularDrawChem").factory("DrawChemCache",a)}(),function(){"use strict";function a(){function a(){var a,c,d,e;b.BOND_LENGTH=b.SET_BOND_LENGTH||20,a=parseFloat((b.BOND_LENGTH*Math.sqrt(3)/2).toFixed(2)),c=parseFloat((b.BOND_LENGTH*Math.sin(Math.PI/12)).toFixed(2)),d=parseFloat((b.BOND_LENGTH*Math.cos(Math.PI/12)).toFixed(2)),e=parseFloat((b.BOND_LENGTH*Math.sin(Math.PI/4)).toFixed(2)),b.WIDTH_TO_LENGTH=.04,b.AROMATIC_R=.45*b.BOND_LENGTH,b.BETWEEN_DBL_BONDS=.065,b.BETWEEN_TRP_BONDS=.1,b.BOND_WIDTH=(b.BOND_LENGTH*b.WIDTH_TO_LENGTH).toFixed(2),b.CIRC_R=.12*b.BOND_LENGTH,b.BOND_N=[0,-b.BOND_LENGTH],b.BOND_N_NE1=[c,-d],b.BOND_NE1=[b.BOND_LENGTH/2,-a],b.BOND_NE1_NE2=[e,-e],b.BOND_NE2=[a,-b.BOND_LENGTH/2],b.BOND_NE2_E=[d,-c],b.BOND_E=[b.BOND_LENGTH,0],b.BOND_E_SE1=[d,c],b.BOND_SE1=[a,b.BOND_LENGTH/2],b.BOND_SE1_SE2=[e,e],b.BOND_SE2=[b.BOND_LENGTH/2,a],b.BOND_SE2_S=[c,d],b.BOND_S=[0,b.BOND_LENGTH],b.BOND_S_SW1=[-c,d],b.BOND_SW1=[-b.BOND_LENGTH/2,a],b.BOND_SW1_SW2=[-e,e],b.BOND_SW2=[-a,b.BOND_LENGTH/2],b.BOND_SW2_W=[-d,c],b.BOND_W=[-b.BOND_LENGTH,0],b.BOND_W_NW1=[-d,-c],b.BOND_NW1=[-a,-b.BOND_LENGTH/2],b.BOND_NW1_NW2=[-e,-e],b.BOND_NW2=[-b.BOND_LENGTH/2,-a],b.BOND_NW2_N=[-c,-d],b.BONDS=[{direction:"N",bond:b.BOND_N},{direction:"NE1",bond:b.BOND_NE1},{direction:"NE2",bond:b.BOND_NE2},{direction:"E",bond:b.BOND_E},{direction:"SE1",bond:b.BOND_SE1},{direction:"SE2",bond:b.BOND_SE2},{direction:"S",bond:b.BOND_S},{direction:"SW1",bond:b.BOND_SW1},{direction:"SW2",bond:b.BOND_SW2},{direction:"W",bond:b.BOND_W},{direction:"NW1",bond:b.BOND_NW1},{direction:"NW2",bond:b.BOND_NW2}],b.BONDS_AUX=[{direction:"N_NE1",bond:b.BOND_N_NE1},{direction:"NE1_NE2",bond:b.BOND_NE1_NE2},{direction:"NE2_E",bond:b.BOND_NE2_E},{direction:"E_SE1",bond:b.BOND_E_SE1},{direction:"SE1_SE2",bond:b.BOND_SE1_SE2},{direction:"SE2_S",bond:b.BOND_SE2_S},{direction:"S_SW1",bond:b.BOND_S_SW1},{direction:"SW1_SW2",bond:b.BOND_SW1_SW2},{direction:"SW2_W",bond:b.BOND_SW2_W},{direction:"W_NW1",bond:b.BOND_W_NW1},{direction:"NW1_NW2",bond:b.BOND_NW1_NW2},{direction:"NW2_N",bond:b.BOND_NW2_N}],b.getBondByDirection=function(a){var c;for(c=0;c<b.BONDS.length;c+=1)if(b.BONDS[c].direction===a)return b.BONDS[c]}}var b={};return b.SET_BOND_LENGTH,b.setBondLength=function(c){b.SET_BOND_LENGTH=c,a()},a(),b}angular.module("mmAngularDrawChem").factory("DrawChemConst",a)}(),function(){"use strict";function a(a,b,c,d,e,f){function g(b){function c(c){function d(a,b,c){var f,g=e(b.nextDirection);return 1===c?a.addBond(new k("single",new j(b.nextBond,[],""))):(f=new j(b.nextBond,[],"",g.current),a.addBond(new k("single",f)),void d(f,g,c-1))}function e(a){function b(a,b,c){return 0>b-c?b-c+a.length:b-c}function c(a,b,c){return b+c>a.length-1?b+c-a.length:b+c}var d,e,f,g;for(d=0;d<o.length;d+=1)if(o[d].direction===a){e=b(o,d,4),f=c(o,d,4),g=c(o,d,2);break}return{current:[o[e].direction,o[f].direction],nextBond:o[f].bond,nextDirection:o[g].direction}}var f,g,h,i=e(c),l=j.getOppositeDirection(c);return f=new j([0,0],[],"",i.current),d(f,i,6),g=new m(l,[f]),"undefined"!=typeof b&&(h=a.getBondByDirection(l).bond,g.addDecorate(b,[h[0],h[1]])),g}var d,e,f=[];for(d=0;d<o.length;d+=1)e=o[d].direction,f.push(c(e));return f}function h(a){var b,c,d,e=[];for(b=0;b<o.length;b+=1)c=o[b].bond,d=o[b].direction,e.push(new m(d,[new j([0,0],[new k(a,new j(c,[],"",[j.getOppositeDirection(d)]))],"",[d])]));return e}var i={},j=d.Atom,k=e.Bond,l=f.Label,m=b.Structure,n=c.StructureCluster,o=a.BONDS;return i.benzene=function(){var a,b="benzene",c=g("aromatic");return a=new n(b,c)},i.cyclohexane=function(){var a,b="cyclohexane",c=g();return a=new n(b,c)},i.singleBond=function(){var a,b="single-bond",c=h("single");return a=new n(b,c)},i.doubleBond=function(){var a,b="double-bond",c=h("double");return a=new n(b,c)},i.tripleBond=function(){var a,b="triple-bond",c=h("triple");return a=new n(b,c)},i.wedgeBond=function(){var a,b="wedge-bond",c=h("wedge");return a=new n(b,c)},i.dashBond=function(){var a,b="dash-bond",c=h("dash");return a=new n(b,c)},i.labels=[new l("O",2),new l("S",2),new l("P",3),new l("N",3),new l("F",1),new l("Cl",1),new l("Br",1),new l("I",1),new l("H",1)],i.custom=[i.benzene,i.cyclohexane,i.singleBond,i.doubleBond,i.tripleBond,i.wedgeBond,i.dashBond],i}angular.module("mmAngularDrawChem").factory("DrawChemStructures",a),a.$inject=["DrawChemConst","DCStructure","DCStructureCluster","DCAtom","DCBond","DCLabel"]}(),function(){"use strict";function a(){function a(a){for(var b=0;b<g.length;b++)if(g[b].name===a)return!0;return!1}function b(a){for(var b=0;b<g.length;b++)if(g[b].name===a)return g[b]}function c(a,b){var c;for(c=0;c<g.length;c++)if(g[c].name===b)return g[c].content=a;g.push({name:b,content:a})}function d(a,b){var c;for(c=0;c<g.length;c++)if(g[c].name===b)return g[c].structure=a;g.push({name:b,structure:a})}var e={},f=!1,g=[],h={};return e.showEditor=function(){return f},e.runEditor=function(c){var d;f=!0,a(c)||g.push({name:c,content:"",structure:null}),d=b(c),h.name=d.name,h.content=d.content,h.structure=d.structure},e.getContent=function(a){if("string"==typeof a){var c=b(a);return"undefined"==typeof c?"":c.content}return h.content},e.getInstance=function(a){return"undefined"==typeof a?h:b(a)},e.setContent=function(a,b){"undefined"==typeof b?h.content=a:c(a,b)},e.setStructure=function(a,b){"undefined"==typeof b?h.structure=a:d(a,b)},e.transferContent=function(){c(h.content,h.name),d(h.structure,h.name)},e.closeEditor=function(){f=!1,h={}},e.clearContent=function(a){"string"==typeof a?c("",a):h.content=""},e.beautifySvg=function(a){var b,c=e.getContent(a),d="<!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'>\n";return b=c.match(/<svg.*?>|<g.*?>|<style.*?<\/style>|<path.*?><\/path>|<circle.*?><\/circle>|<polygon.*?><\/polygon>|<text.*?<\/text>|<\/g>|<\/svg>|/g),b.forEach(function(a){d+=a+"\n"}),d},e}angular.module("mmAngularDrawChem").factory("DrawChem",a)}(),function(){"use strict";function a(a,b,c,d){function e(a,c){var d=b.CIRC_R;return Math.abs(a[0]-c[0])<d&&Math.abs(a[1]-c[1])<d}function f(a){var b,c,d,e,f,g=[];for(b=0;b<a.length;b+=1){for(d=a[b],f={line:""},c=0;c<d.length;c+=1)e=d[c],"string"==typeof e?"wedge"===e?f["class"]="wedge":f.line+=e+" ":f.line+=e[0]+" "+e[1]+" ";g.push(f)}return g}function g(a,b,c){return"undefined"==typeof c?[(a[0]+b[0]).toFixed(2),(a[1]+b[1]).toFixed(2)]:[(a[0]+c*b[0]).toFixed(2),(a[1]+c*b[1]).toFixed(2)]}function h(a,b,c){return"undefined"==typeof c?[a[0]+b[0],a[1]+b[1]]:[a[0]+c*b[0],a[1]+c*b[1]]}function i(a){return a-parseFloat(a)>=0}function j(a){var b,c=a.match(/[A-Z][a-z\d]*/g),d="";if(null===c)return a;for(b=c.length-1;b>=0;b-=1)d+=c[b];return d}var k={},l=b.BOND_LENGTH,m=b.BONDS_AUX,n=b.BETWEEN_DBL_BONDS,o=b.BETWEEN_TRP_BONDS,p=c.Atom;return k.modifyStructure=function(a,c,d,f,g){function h(c,q){function r(c,d){var e;return null!==c&&"undefined"!=typeof c.getDecorate("aromatic")?(e=b.getBondByDirection(c.getName()).bond,a.addDecorate("aromatic",[e[0]+d[0],e[1]+d[1]])):void 0}function s(a,b,c){null!==b&&(t(b,c),a.addBonds(b.getStructure(0).getBonds()))}function t(b,c){var d,e,f,g,h=b.getStructure(0).getBonds();for(d=0;d<h.length;d+=1)if(e=[h[d].getAtom().getCoords("x")+c[0],h[d].getAtom().getCoords("y")+c[1]],f=k.isWithin(a,e).foundAtom,"undefined"!=typeof f)return g=p.getOppositeDirection(b.getName()),f.attachBond(g),f.calculateNext()}var u,v,w;for(u=0;u<c.length&&(w=c[u]instanceof p?c[u]:c[u].getAtom(),v=[w.getCoords("x")+q[0],w.getCoords("y")+q[1]],!o);u+=1){if(n=e(v,d),n&&!g)return m=l(w),s(w,m,v),r(m,v),o=!0,a;if(!n&&i(f,v,5))return m=j(w),s(w,m,v),r(m,v),o=!0,a;h(w.getBonds(),v)}}function i(a,b,c){return"undefined"==typeof a||"undefined"==typeof b?!1:a[0].toFixed(c)===b[0].toFixed(c)&&a[1].toFixed(c)===b[1].toFixed(c)}function j(a){return l(a,k.getDirection(d,f))}function l(a,b){var d,e,f,g,h;if(1===c.defs.length)return c.getDefault().getStructure(0).getBonds();for(d=0;d<c.defs.length;d+=1){if(e=c.defs[d],h=a.getNext(),"max"===h)return null;if(f=e.getName(),g=b||h,g===f)return a.attachBond(f),a.calculateNext(),e}}var m,n,o=!1,q=a.getOrigin();return h(a.getStructure(),q),a},k.isWithin=function(a,b){function c(a,g){var h,i,j;for(h=0;h<a.length;h+=1)j=a[h]instanceof p?a[h]:a[h].getAtom(),i=[j.getCoords("x")+g[0],j.getCoords("y")+g[1]],!d&&e(i,b)?(d=!0,f.foundAtom=j,f.absPos=i):c(j.getBonds(),i)}var d=!1,f={},g=a.getOrigin();return c(a.getStructure(),g),f},k.draw=function(c,d){function e(){function d(a){return"rl"===a?"end":"start"}function e(b){var c,d,e=!1,f="";for(c=0;c<b.length;c+=1)d=b.substr(c,1),i(d)?(f+="<tspan class='sub' dy='"+.25*a.fontSize+"' >"+d+"</tspan>",e=!0):e?(f+="<tspan dy='-"+.25*a.fontSize+"' >"+d+"</tspan>",e=!1):f+="<tspan>"+d+"</tspan>";return f}function h(a){var b,c,d,e,h,i=[];for(e=1===a.length?.58:.5,h=e*a.height/l,b=0;b<m.length;b+=1)c=m[b].bond[0],d=m[b].bond[1],i=i.concat(g([a.atomX,a.atomY],[c,d],h));return"<polygon class='text' points='"+f([i])[0].line+"'></polygon>"}var j="",k="",n="";return r.forEach(function(a){n="undefined"!=typeof a["class"]?"<path class='"+a["class"]+"' d='"+a.line+"'></path>":"<path d='"+a.line+"'></path>",j+=n,k+=n}),s.forEach(function(a){j+="<circle class='atom' cx='"+a[0]+"' cy='"+a[1]+"' r='"+a[2]+"' ></circle>"}),t.forEach(function(a){n=h(a)+"<text dy='0.2125em' x='"+a.labelX+"' y='"+a.labelY+"' text-anchor='"+d(a.mode)+"' >"+e(a.label)+"</text>",j+=n,k+=n}),c.getDecorate("aromatic")&&c.getDecorate("aromatic").forEach(function(a){n="<circle class='arom' cx='"+a[0]+"' cy='"+a[1]+"' r='"+b.AROMATIC_R+"' ></circle>",j+=n,k+=n}),{full:j,mini:k}}function k(c){function d(a,b,c){var d,f,g,h;for(d=0;d<b.length;d+=1)g=b[d].getAtom(),h=b[d].getType(),f=[a[0]+g.getCoords("x"),a[1]+g.getCoords("y")],r(f),q(f,g),w.push([f[0],f[1],A]),0===d?e(a,f,h,g,"continue"):e(a,f,h,g,"begin")}function e(a,b,c,e,f){var g=v.length;"single"===c?"continue"===f?(v[g-1].push("L"),v[g-1].push(b)):"begin"===f&&(g=v.push(["M",a,"L",b])):"double"===c?(v.push(i(a,b)),g=v.push(["M",b])):"triple"===c?(v.push(k(a,b)),g=v.push(["M",b])):"wedge"===c?(v.push(m(a,b)),g=v.push(["M",b])):"dash"===c&&(v.push(p(a,b)),g=v.push(["M",b])),d(b,e.getBonds(),v[g-1])}function i(a,b){var c=[b[0]-a[0],b[1]-a[1]],d=[-c[1],c[0]],e=[c[1],-c[0]],f=g(a,d,n),h=g(b,d,n),i=g(a,e,n),j=g(b,e,n);return["M",f,"L",h,"M",i,"L",j]}function k(a,b){var c=[b[0]-a[0],b[1]-a[1]],d=[-c[1],c[0]],e=[c[1],-c[0]],f=g(a,d,o),h=g(b,d,o),i=g(a,e,o),j=g(b,e,o);return["M",f,"L",h,"M",a,"L",b,"M",i,"L",j]}function m(a,b){var c=[b[0]-a[0],b[1]-a[1]],d=[-c[1],c[0]],e=[c[1],-c[0]],f=g(b,d,n),h=g(b,e,n);return["wedge","M",a,"L",f,"L",h,"Z"]}function p(a,b){var c,d,e,f=7,h=n/f,i=a,j=[],k=[b[0]-a[0],b[1]-a[1]],l=[-k[1],k[0]],m=[k[1],-k[0]];for(c=f;c>0;c-=1)h+=n/f,i=[i[0]+k[0]/f,i[1]+k[1]/f],d=g(i,l,h),e=g(i,m,h),j=j.concat(["M",d,"L",e]);return j}function q(b,c){function d(){function d(){function a(){var a=0;return c.getAttachedBonds().forEach(function(b){a=b.indexOf("E")<0?a:a+1}),a>0}function b(){return"rl"===h?.175:"lr"===h?-.175:void 0}var d,h=f.getMode(),i=0;for(d=0;e>d;d+=1)i+=1;g.hydrogens=i,i>0?"rl"===h||"tb"===h||a()?(g.name=1===i?"H"+g.name:"H"+i+g.name,"undefined"==typeof h&&(f.setMode("rl"),h="rl")):(g.name=1===i?g.name+"H":g.name+"H"+i,"undefined"==typeof h&&(f.setMode("lr"),h="lr")):"undefined"==typeof h?(f.setMode("lr"),h="lr"):"rl"===h&&(g.name=j(g.name),f.setMode("rl"),h="rl"),g.correctX=b()*l}var e=f.getMaxBonds()-c.getAttachedBonds().length,g={name:f.getLabelName()};return d(),{length:g.name.length,label:g.name,mode:f.getMode(),atomX:b[0],atomY:b[1],labelX:b[0]+g.correctX,labelY:b[1]+.013*Math.abs(b[1]),width:a.fontSize*g.name.length,height:a.fontSize}}var e,f=c.getLabel();"undefined"!=typeof f&&(e=d(),x.push(e),r([e.atomX-e.width/2,e.atomY-e.height/2]),r([e.atomX+e.width/2,e.atomY+e.height/2]))}function r(a){a[0]>z.maxX&&(z.maxX=a[0]),a[0]<z.minX&&(z.minX=a[0]),a[1]>z.maxY&&(z.maxY=a[1]),a[1]<z.minY&&(z.minY=a[1])}var s,t,u,v=[],w=[],x=[],y=c.getOrigin(),z={minX:y[0],maxX:y[0],minY:y[1],maxY:y[1]},A=b.CIRC_R;for(s=0;s<c.getStructure().length;s+=1)t=h(y,c.getStructure(s).getCoords()),q(t,c.getStructure(s)),r(t),u=v.push(["M",t]),w.push([t[0],t[1],A]),d(t,c.getStructure(s).getBonds(),v[u-1]);return{paths:f(v),circles:w,labels:x,minMax:z}}var p,q=k(c),r=q.paths,s=q.circles,t=q.labels,u=q.minMax;return p=new a.Shape(e().full,e().mini,d),p.elementFull=p.generateStyle("expanded")+p.elementFull,p.elementMini=p.generateStyle("base")+p.elementMini,p.setMinMax(u),p},k.getDirection=function(a,b){function c(c,d,e,f){return a[0]>=b[0]+c&&a[0]<=b[0]+d&&a[1]>=b[1]+e&&a[1]<=b[1]+f}var d=Math.PI/6,e=Math.sqrt(Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2)),f=Math.sin(d/2)*e,g=Math.cos(3*d/2)*e,h=Math.cos(d/2)*e,i=Math.sin(3*d/2)*e;return c(-f,f,-e,-h)?"N":c(f,g,-h,-i)?"NE1":c(g,h,-i,-f)?"NE2":c(h,e,-f,f)?"E":c(g,h,f,i)?"SE1":c(f,g,i,h)?"SE2":c(-f,f,h,e)?"S":c(-g,-f,i,h)?"SW1":c(-h,-g,f,i)?"SW2":c(-e,-h,-f,f)?"W":c(-h,-g,-i,-f)?"NW1":c(-g,-f,-h,-i)?"NW2":void 0},k}angular.module("mmAngularDrawChem").factory("DrawChemShapes",a),a.$inject=["DCShape","DrawChemConst","DCAtom","DCBond"]}(),function(){"use strict";function a(){var a="",b=a+"svg";return{setPath:function(b){a=b},setPathSvg:function(a){b=a},$get:function(){return{getPath:function(){return a},getPathToSvg:function(){return b}}}}}angular.module("mmAngularDrawChem").provider("DrawChemPaths",a)}();