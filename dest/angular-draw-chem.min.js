!function(){"use strict";angular.module("mmAngularDrawChem",["ngSanitize"]).config(["$sanitizeProvider",function(a){a.enableSvg()}])}(),function(){"use strict";function a(a){function b(a,b,c,d){this.coords=a,this.bonds=b,this.info=c,this.attachedBonds=d||[],this.next="",this.label="",this.calculateNext()}var c={};return b.getOppositeDirection=function(a){switch(a){case"N":return"S";case"NE1":return"SW1";case"NE2":return"SW2";case"E":return"W";case"SE1":return"NW1";case"SE2":return"NW2";case"S":return"N";case"SW1":return"NE1";case"SW2":return"NE2";case"W":return"E";case"NW1":return"SE1";case"NW2":return"SE2"}},b.prototype.attachBond=function(a){this.attachedBonds.push(a)},b.prototype.calculateNext=function(){function b(){var a=this.attachedBonds[0];switch(a){case"N":return"SE1";case"NE1":return"SE2";case"NE2":return"S";case"E":return"SW1";case"SE1":return"SW2";case"SE2":return"W";case"S":return"NW1";case"SW1":return"NW2";case"SW2":return"N";case"W":return"NE1";case"NW1":return"NE2";case"NW2":return"E"}}function c(){function a(a,b){return this.attachedBonds[0]===a&&this.attachedBonds[1]===b||this.attachedBonds[0]===b&&this.attachedBonds[1]===a}return a.call(this,"N","SE1")?"SW2":a.call(this,"NE1","SE2")?"W":a.call(this,"NE2","S")?"NW1":a.call(this,"E","SW1")?"NW2":a.call(this,"SE1","SW2")?"N":a.call(this,"SE2","W")?"NE1":a.call(this,"S","NW1")?"NE2":a.call(this,"SW1","NW2")?"E":a.call(this,"SW2","N")?"SE1":a.call(this,"W","NE1")?"SE2":a.call(this,"NW1","NE2")?"S":a.call(this,"NW2","E")?"SW1":void d.call(this)}function d(){var b,c=a.BONDS;for(b=0;b<c.length;b+=1)if(this.attachedBonds.indexOf(c[b].direction)<0)return c[b].direction}1===this.attachedBonds.length?this.next=b.call(this):2===this.attachedBonds.length?this.next=c.call(this):this.attachedBonds.length>2&&this.attachedBonds.length<12?this.next=d.call(this):this.attachedBonds.length>=12?this.next="max":this.next=""},b.prototype.setCoords=function(a){this.coords=a},b.prototype.getInfo=function(){return this.info},b.prototype.getAttachedBonds=function(){return this.attachedBonds},b.prototype.setPreceding=function(a){this.preceding=a},b.prototype.getPreceding=function(a){return"x"===a?this.preceding[0]:"y"===a?this.preceding[1]:this.preceding},b.prototype.getNext=function(){return this.next},b.prototype.setLabel=function(a){this.label=a},b.prototype.getLabel=function(){return this.label},b.prototype.setNext=function(a){this.next=a},b.prototype.getCoords=function(a){return"x"===a?this.coords[0]:"y"===a?this.coords[1]:this.coords},b.prototype.getBonds=function(a){return 0===arguments.length?this.bonds:this.bonds[a]},b.prototype.addBond=function(a){this.bonds.push(a)},b.prototype.addBonds=function(a){a.forEach(function(a){this.bonds.push(a)},this)},c.Atom=b,c}angular.module("mmAngularDrawChem").factory("DCAtom",a),a.$inject=["DrawChemConst"]}(),function(){"use strict";function a(a){function b(b,c,d){this.elementFull=b,this.elementMini=c,this.id=d,this.scale=1,this.transformAttr="",this.styleFull={path:{stroke:"black","stroke-width":a.BOND_WIDTH*this.scale,fill:"none"},"circle.atom:hover":{opacity:"0.3",stroke:"black","stroke-width":a.BOND_WIDTH*this.scale},"circle.atom":{opacity:"0"},"circle.arom":{stroke:"black","stroke-width":a.BOND_WIDTH*this.scale,fill:"none"},text:{"font-family":"Times New Roman","stroke-width":.5,stroke:"black"}},this.styleMini={path:{stroke:"black","stroke-width":a.BOND_WIDTH*this.scale,fill:"none"},"circle.arom":{stroke:"black","stroke-width":a.BOND_WIDTH*this.scale,fill:"none"},text:{"font-family":"Times New Roman","stroke-width":.5,stroke:"black"}}}var c={};return c.initialDefsFull='<defs><filter id="solid1"><feFlood flood-color="#ffffff"/ result="white" /><feComposite operator="over" in2="white" in="SourceGraphic"/></filter></defs>',c.initialDefsMini='<defs><filter id="solid2"><feFlood flood-color="#ffffff"/ result="white" /><feComposite operator="over" in2="white" in="SourceGraphic"/></filter></defs>',b.prototype.setMinMax=function(a){this.minMax=a},b.prototype.wrap=function(a,b,c){var d,e={};return"g"!==b||c||(c=e,c.id=this.id),c?(d="<"+b+" ",angular.forEach(c,function(a,b){d+=b+"='"+a+"' "}),"full"===a?this.elementFull=d+">"+this.elementFull+"</"+b+">":"mini"===a&&(this.elementMini=d+">"+this.elementMini+"</"+b+">")):"full"===a?this.elementFull="<"+b+">"+this.elementFull+"</"+b+">":"mini"===a&&(this.elementMini="<"+b+">"+this.elementMini+"</"+b+">"),this},b.prototype.transform=function(a,b){return this.transformAttr&&(this.transformAttr+=" "),this.transformAttr+=a+"("+b[0],b.length>1&&(this.transformAttr+=","+b[1]),this.transformAttr+=")",this},b.prototype.generateUse=function(){return"<use xmlns:xlink='http://www.w3.org/1999/xlink' xlink:href='#"+this.id+"' transform='"+this.transformAttr+"'></use>"},b.prototype.generateStyle=function(a){var b='<style type="text/css">';return"full"===a?a=this.styleFull:"mini"===a&&(a=this.styleMini),angular.forEach(a,function(a,c){b+=c+"{",angular.forEach(a,function(a,c){b+=c+":"+a+";"}),b+="}"}),b+"</style>"},b.prototype.getElementFull=function(){return this.elementFull},b.prototype.getElementMini=function(){return this.elementMini},c.Shape=b,c}angular.module("mmAngularDrawChem").factory("DCShape",a),a.$inject=["DrawChemConst"]}(),function(){"use strict";function a(a){function b(a,b){this.name=a,this.defs=b,this.defaultStructure=b[0]}var c={};return b.prototype.getDefs=function(){return this.defs},b.prototype.getDefault=function(){return this.defaultStructure},b.prototype.getStructure=function(b,c){var d,e=a.getDirection(b,c);for(d=0;d<this.defs.length;d+=1)if(this.defs[d].getName()===e)return this.defs[d]},c.StructureCluster=b,c}angular.module("mmAngularDrawChem").factory("DCStructureCluster",a),a.$inject=["DrawChemShapes"]}(),function(){"use strict";function a(){function a(a,b,c){this.name=a,this.structure=b,this.transform=[],this.origin=[],this.decorate=c||{}}var b={};return a.prototype.setTransform=function(a,b){this.transform.push({name:a,content:b})},a.prototype.getTransform=function(a){var b,c=this.transform;for(b=0;b<c.length;b+=1)if(c[b].name===a)return c[b].content},a.prototype.setOrigin=function(a){this.origin=a,angular.forEach(this.decorate,function(b,c){b.forEach(function(b){b[0]+=a[0],b[1]+=a[1]})})},a.prototype.getOrigin=function(a){return"x"===a?this.origin[0]:"y"===a?this.origin[1]:this.origin},a.prototype.setStructure=function(a){this.structure=a},a.prototype.getStructure=function(a){return 0===arguments.length?this.structure:this.structure[a]},a.prototype.getName=function(){return this.name},a.prototype.getDecorate=function(a){return this.decorate[a]},a.prototype.addDecorate=function(a,b){"undefined"==typeof this.decorate[a]&&(this.decorate[a]=[]),this.decorate[a].push(b)},b.Structure=a,b}angular.module("mmAngularDrawChem").factory("DCStructure",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g){return{templateUrl:"draw-chem-editor.html",scope:{showEditor:"="},link:function(d,g,h){function i(a){var b=g.find("dc-content")[0],c=[parseFloat((a.clientX-b.getBoundingClientRect().left-2).toFixed(2)),parseFloat((a.clientY-b.getBoundingClientRect().top-2).toFixed(2))];return c}function j(){q=!1,r=!1,p=!1,o=!1,m=void 0,n=void 0}function k(b){var c="";c=a.draw(b,"cmpd1"),e.setCurrentSvg(c.wrap("full","svg").getElementFull())}function l(b,c,e){return a.modifyStructure(angular.copy(b),angular.copy(d.chosenStructure),c,m,e)}var m,n,o=!1,p=!1,q=!1,r=!1;d.label="",d.changeLabel=function(){o=!0,d.chosenStructure=void 0},d.dialogStyle={},h.width&&(d.dialogStyle.width=h.width),h.height&&(d.dialogStyle.height=h.height),d.closeEditor=function(){c.closeEditor()},d.content=function(){return f.trustAsHtml(e.getCurrentSvg())},d.undo=function(){e.moveLeftInStructures(),null===e.getCurrentStructure()?c.clearContent():k(e.getCurrentStructure())},d.forward=function(){e.moveRightInStructures(),k(e.getCurrentStructure())},d.clear=function(){e.addStructure(null),e.setCurrentSvg("")},d.transfer=function(){var b,d,f=e.getCurrentStructure(),g="";null!==f&&(b=a.draw(f,"cmpd1"),d={viewBox:b.minMax.minX-20+" "+(b.minMax.minY-20)+" "+(b.minMax.maxX-b.minMax.minX+40)+" "+(b.minMax.maxY-b.minMax.minY+40),height:"100%",width:"100%"},g=b.wrap("mini","svg",d).getElementMini()),c.setContent(g),c.setStructure(f),c.transferContent()},d.chosenStructure,d.customButtons=[],angular.forEach(b.custom,function(a){var b=a();d.customButtons.push({name:b.name,choose:function(){d.chosenStructure=b}})}),d.doOnMouseDown=function(b){n=i(b),q=!0,null!==e.getCurrentStructure()&&(m=a.isWithin(e.getCurrentStructure(),n).absPos,"undefined"!=typeof m&&(r=!0))},d.doOnMouseUp=function(b){var c,f,g=i(b),h=e.getCurrentStructure();o?(c=angular.copy(h),f=a.isWithin(c,g).foundAtom,f.setLabel(d.label)):null!==e.getCurrentStructure()?c=l(h,g):"undefined"!=typeof d.chosenStructure&&(p?(c=angular.copy(d.chosenStructure.getStructure(g,n)),c.setOrigin(n)):(c=angular.copy(d.chosenStructure.getDefault()),c.setOrigin(g))),"undefined"!=typeof c&&(e.addStructure(angular.copy(c)),k(c),j())},d.doOnMouseMove=function(a){var b,c,f,g=i(a);r&&"undefined"!=typeof d.chosenStructure?(c=e.getCurrentStructure(),b=l(c,g,!0),k(b)):q&&"undefined"!=typeof d.chosenStructure&&null===e.getCurrentStructure()&&(f=angular.copy(d.chosenStructure.getStructure(g,n)),f.setOrigin(n),p=!0,k(f))}}}}angular.module("mmAngularDrawChem").directive("drawChemEditor",a),a.$inject=["DrawChemShapes","DrawChemStructures","DrawChem","DrawChemConst","DrawChemCache","$sce","$window"]}(),function(){"use strict";function a(){var a={},b=[{structure:null,svg:""}],c=0;return a.addStructure=function(d){c<b.length-1&&(b=b.slice(0,c+1)),b.push({structure:d,svg:""}),b.length>10&&b.shift(),a.moveRightInStructures()},a.getCurrentPosition=function(){return c},a.getStructureLength=function(){return b.length},a.getCurrentStructure=function(){return b[c].structure},a.getCurrentSvg=function(){return b[c].svg},a.setCurrentSvg=function(a){b[c].svg=a},a.moveLeftInStructures=function(){c>0&&(c-=1)},a.moveRightInStructures=function(){c<b.length-1&&(c+=1)},a}angular.module("mmAngularDrawChem").factory("DrawChemCache",a)}(),function(){"use strict";function a(){function a(){var a;b.BOND_LENGTH=b.SET_BOND_LENGTH||20,a=parseFloat((b.BOND_LENGTH*Math.sqrt(3)/2).toFixed(2)),b.WIDTH_TO_LENGTH=.04,b.AROMATIC_R=.45*b.BOND_LENGTH,b.BOND_WIDTH=parseFloat((b.BOND_LENGTH*b.WIDTH_TO_LENGTH).toFixed(2)),b.CIRC_R=.12*b.BOND_LENGTH,b.BOND_N=[0,-b.BOND_LENGTH],b.BOND_S=[0,b.BOND_LENGTH],b.BOND_E=[b.BOND_LENGTH,0],b.BOND_W=[-b.BOND_LENGTH,0],b.BOND_NE1=[b.BOND_LENGTH/2,-a],b.BOND_NE2=[a,-b.BOND_LENGTH/2],b.BOND_SE1=[a,b.BOND_LENGTH/2],b.BOND_SE2=[b.BOND_LENGTH/2,a],b.BOND_SW1=[-b.BOND_LENGTH/2,a],b.BOND_SW2=[-a,b.BOND_LENGTH/2],b.BOND_NW1=[-a,-b.BOND_LENGTH/2],b.BOND_NW2=[-b.BOND_LENGTH/2,-a],b.BONDS=[{direction:"N",bond:b.BOND_N},{direction:"NE1",bond:b.BOND_NE1},{direction:"NE2",bond:b.BOND_NE2},{direction:"E",bond:b.BOND_E},{direction:"SE1",bond:b.BOND_SE1},{direction:"SE2",bond:b.BOND_SE2},{direction:"S",bond:b.BOND_S},{direction:"SW1",bond:b.BOND_SW1},{direction:"SW2",bond:b.BOND_SW2},{direction:"W",bond:b.BOND_W},{direction:"NW1",bond:b.BOND_NW1},{direction:"NW2",bond:b.BOND_NW2}],b.getBondByDirection=function(a){var c;for(c=0;c<b.BONDS.length;c+=1)if(b.BONDS[c].direction===a)return b.BONDS[c]}}var b={};return b.SET_BOND_LENGTH,b.setBondLength=function(c){b.SET_BOND_LENGTH=c,a()},a(),b}angular.module("mmAngularDrawChem").factory("DrawChemConst",a)}(),function(){"use strict";function a(a,b,c,d){function e(b){function c(c){function d(a,b,c){var f,g=e(b.nextDirection);return 1===c?a.addBond(new h(b.nextBond,[],"")):(f=new h(b.nextBond,[],"",g.current),a.addBond(f),void d(f,g,c-1))}function e(a){function b(a,b,c){return 0>b-c?b-c+a.length:b-c}function c(a,b,c){return b+c>a.length-1?b+c-a.length:b+c}var d,e,f,g;for(d=0;d<k.length;d+=1)if(k[d].direction===a){e=b(k,d,4),f=c(k,d,4),g=c(k,d,2);break}return{current:[k[e].direction,k[f].direction],nextBond:k[f].bond,nextDirection:k[g].direction}}var f,g,j,l=e(c),m=h.getOppositeDirection(c);return f=new h([0,0],[],"",l.current),d(f,l,6),g=new i(m,[f]),"undefined"!=typeof b&&(j=a.getBondByDirection(m).bond,g.addDecorate(b,[j[0],j[1]])),g}var d,e,f=[];for(d=0;d<k.length;d+=1)e=k[d].direction,f.push(c(e));return f}function f(){var a,b,c,d=[];for(a=0;a<k.length;a+=1)b=k[a].bond,c=k[a].direction,d.push(new i(c,[new h([0,0],[new h(b,[],"",[h.getOppositeDirection(c)])],"",[c])]));return d}var g={},h=d.Atom,i=b.Structure,j=c.StructureCluster,k=a.BONDS;return g.benzene=function(){var a,b="benzene",c=e("aromatic");return a=new j(b,c)},g.cyclohexane=function(){var a,b="cyclohexane",c=e();return a=new j(b,c)},g.singleBond=function(){var a,b="single-bond",c=f();return a=new j(b,c)},g.custom=[g.benzene,g.cyclohexane,g.singleBond],g}angular.module("mmAngularDrawChem").factory("DrawChemStructures",a),a.$inject=["DrawChemConst","DCStructure","DCStructureCluster","DCAtom"]}(),function(){"use strict";function a(){function a(a){for(var b=0;b<g.length;b++)if(g[b].name===a)return!0;return!1}function b(a){for(var b=0;b<g.length;b++)if(g[b].name===a)return g[b]}function c(a,b){var c;for(c=0;c<g.length;c++)if(g[c].name===b)return g[c].content=a;g.push({name:b,content:a})}function d(a,b){var c;for(c=0;c<g.length;c++)if(g[c].name===b)return g[c].structure=a;g.push({name:b,structure:a})}var e={},f=!1,g=[],h={};return e.showEditor=function(){return f},e.runEditor=function(c){var d;f=!0,a(c)||g.push({name:c,content:"",structure:null}),d=b(c),h.name=d.name,h.content=d.content,h.structure=d.structure},e.getContent=function(a){if("string"==typeof a){var c=b(a);return"undefined"==typeof c?"":c.content}return h.content},e.getInstance=function(a){return"undefined"==typeof a?h:b(a)},e.setContent=function(a,b){"undefined"==typeof b?h.content=a:c(a,b)},e.setStructure=function(a,b){"undefined"==typeof b?h.structure=a:d(a,b)},e.transferContent=function(){c(h.content,h.name),d(h.structure,h.name)},e.closeEditor=function(){f=!1,h={}},e.clearContent=function(a){"string"==typeof a?c("",a):h.content=""},e}angular.module("mmAngularDrawChem").factory("DrawChem",a)}(),function(){"use strict";function a(a,b,c){function d(a,c){var d=b.CIRC_R;return Math.abs(a[0]-c[0])<d&&Math.abs(a[1]-c[1])<d}var e={},f=c.Atom;return e.modifyStructure=function(a,c,g,h,i){function j(c,q){function r(c,d){var e;return null!==c&&"undefined"!=typeof c.getDecorate("aromatic")?(e=b.getBondByDirection(c.getName()).bond,a.addDecorate("aromatic",[e[0]+d[0],e[1]+d[1]])):void 0}function s(a,b,c){null!==b&&(t(b,c),a.addBonds(b.getStructure(0).getBonds()))}function t(b,c){var d,g,h,i,j=b.getStructure(0).getBonds();for(d=0;d<j.length;d+=1)if(g=[j[d].getCoords("x")+c[0],j[d].getCoords("y")+c[1]],h=e.isWithin(a,g).foundAtom,"undefined"!=typeof h)return i=f.getOppositeDirection(b.getName()),h.attachBond(i),h.calculateNext()}var u,v;for(u=0;u<c.length;u+=1)if(v=[c[u].getCoords("x")+q[0],c[u].getCoords("y")+q[1]],!p){if(o=d(v,g),o&&!i)return n=m(c[u]),s(c[u],n,v),r(n,v),p=!0,a;if(!o&&k(h,v,5))return n=l(c[u]),s(c[u],n,v),r(n,v),p=!0,a;j(c[u].getBonds(),v)}}function k(a,b,c){return"undefined"==typeof a||"undefined"==typeof b?!1:a[0].toFixed(c)===b[0].toFixed(c)&&a[1].toFixed(c)===b[1].toFixed(c)}function l(a){return m(a,e.getDirection(g,h))}function m(a,b){var d,e,f,g,h;if(1===c.defs.length)return c.getDefault().getStructure(0).getBonds();for(d=0;d<c.defs.length;d+=1){if(e=c.defs[d],h=a.getNext(),"max"===h)return null;if(f=e.getName(),g=b||h,g===f)return a.attachBond(f),a.calculateNext(),e}}var n,o,p=!1,q=a.getOrigin();return j(a.getStructure(),q),a},e.isWithin=function(a,b){function c(a,g){var h,i;for(h=0;h<a.length;h+=1)i=[a[h].getCoords("x")+g[0],a[h].getCoords("y")+g[1]],!e&&d(i,b)?(e=!0,f.foundAtom=a[h],f.absPos=i):c(a[h].getBonds(),i)}var e=!1,f={},g=a.getOrigin();return c(a.getStructure(),g),f},e.draw=function(c,d){function e(){var a="",d="",e="";return i.forEach(function(b){e="<path d='"+b+"'></path>",a+=e,d+=e}),j.forEach(function(b){a+="<circle class='atom' cx='"+b[0]+"' cy='"+b[1]+"' r='"+b[2]+"' ></circle>"}),k.forEach(function(b){e="<text filter='url(#solid1)' x='"+b.x+"' y='"+b.y+"'>"+b.label+"</text>",a+=e,e="<text filter='url(#solid2)' x='"+b.x+"' y='"+b.y+"'>"+b.label+"</text>",d+=e}),c.getDecorate("aromatic")&&c.getDecorate("aromatic").forEach(function(c){e="<circle class='arom' cx='"+c[0]+"' cy='"+c[1]+"' r='"+b.AROMATIC_R+"' ></circle>",a+=e,d+=e}),{full:a,mini:d}}function f(a){function c(a,d,h){function k(a,c){var d=c.getLabel();""!==d&&g.push({x:a[0]-.15*b.BOND_LENGTH,y:a[1]+.15*b.BOND_LENGTH,label:d})}function l(a){a[0]>i.maxX&&(i.maxX=a[0]),a[0]<i.minX&&(i.minX=a[0]),a[1]>i.maxY&&(i.maxY=a[1]),a[1]<i.minY&&(i.minY=a[1])}var m,n,o,p=[f[f.length-1][0],f[f.length-1][1]];if(d.length>0)for(o=[p[0]+d[0].getCoords("x"),p[1]+d[0].getCoords("y")],l(o),k(o,d[0]),f.push([o[0],o[1],j]),h.push("L"),h.push(o),c(d[0].getCoords(),d[0].getBonds(),h),m=1;m<d.length;m+=1)o=[p[0]+d[m].getCoords("x"),p[1]+d[m].getCoords("y")],l(o),k(o,d[m]),f.push([o[0],o[1],j]),n=e.push(["M",p,"L",o]),c(o,d[m].getBonds(),e[n-1])}function d(){var a,b,c,d,f,g=[];for(a=0;a<e.length;a+=1){for(c=e[a],f="",b=0;b<c.length;b+=1)d=c[b],f+="string"==typeof d?d+" ":d[0]+" "+d[1]+" ";g.push(f)}return g}var e=[],f=[],g=[],h=a.getOrigin(),i={minX:h[0],minY:h[1],maxX:h[0],maxY:h[1]},j=b.CIRC_R,k=e.push(["M",h]);return f.push([a.getOrigin("x"),a.getOrigin("y"),j]),c(h,a.getStructure(0).getBonds(),e[k-1]),{paths:d(),circles:f,labels:g,minMax:i}}var g,h=f(c),i=h.paths,j=h.circles,k=h.labels,l=h.minMax;return g=new a.Shape(e().full,e().mini,d),g.elementFull=g.generateStyle("full")+g.elementFull,g.elementMini=g.generateStyle("mini")+g.elementMini,g.setMinMax(l),g.elementMini=a.initialDefsMini+g.elementMini,g.elementFull=a.initialDefsFull+g.elementFull,g},e.getDirection=function(a,b){function c(c,d,e,f){return a[0]>b[0]+c&&a[0]<=b[0]+d&&a[1]>=b[1]+e&&a[1]<=b[1]+f}var d=Math.PI/6,e=Math.sqrt(Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2)),f=Math.sin(d/2)*e,g=Math.cos(3*d/2)*e,h=Math.cos(d/2)*e,i=Math.sin(3*d/2)*e;return c(-f,f,-e,-h)?"N":c(f,g,-h,-i)?"NE1":c(g,h,-i,-f)?"NE2":c(h,e,-f,f)?"E":c(g,h,f,i)?"SE1":c(f,g,i,h)?"SE2":c(-f,f,h,e)?"S":c(-g,-f,i,h)?"SW1":c(-h,-g,f,i)?"SW2":c(-e,-h,-f,f)?"W":c(-h,-g,-i,-f)?"NW1":c(-g,-f,-h,-i)?"NW2":void 0},e}angular.module("mmAngularDrawChem").factory("DrawChemShapes",a),a.$inject=["DCShape","DrawChemConst","DCAtom"]}();