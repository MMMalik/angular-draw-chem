!function(){"use strict";angular.module("mmAngularDrawChem",["ngSanitize","ui.bootstrap"]).config(["$sanitizeProvider",function(a){a.enableSvg()}])}(),function(){"use strict";function a(a,b,c){function d(a,b){this.name=a,this.defs=b,this.defaultStructure=this.getDefault()}var e={},f=c.Arrow;return d.prototype.getDefault=function(){var c;for(c=0;c<this.defs.length;c+=1)if(a.compareVectors(this.defs[c].getRelativeEnd(),b.BOND_E,5))return this.defs[c]},d.prototype.getArrow=function(c,d){var e,g,h=[];if(a.insideCircle(c,d,b.CIRC_R))return this.defaultStructure;for(g=0;g<this.defs.length;g+=1)h.push(this.defs[g].getRelativeEnd());return e=a.getClosestVector(c,d,h),new f(this.name,e)},e.ArrowCluster=d,e}angular.module("mmAngularDrawChem").factory("DCArrowCluster",a),a.$inject=["DrawChemUtils","DrawChemConst","DCArrow"]}(),function(){"use strict";function a(){function a(a,b){this.type=a,this.relativeEnd=b}var b={};return a.prototype.isSelected=function(){return!!this.selected},a.prototype.select=function(){this.selected=!0},a.prototype.deselect=function(){this.selected=!1},a.prototype.getType=function(){return this.type},a.prototype.getRelativeEnd=function(){return this.relativeEnd},a.prototype.getEnd=function(a){return"x"===a?this.end[0]:"y"===a?this.end[1]:this.end},a.prototype.setOrigin=function(a){this.origin=a,"undefined"!=typeof this.relativeEnd&&(this.end=[a[0]+this.relativeEnd[0],a[1]+this.relativeEnd[1]])},a.prototype.addToCoords=function(a){this.origin[0]+=a[0],this.origin[1]+=a[1]},a.prototype.getOrigin=function(a){return"x"===a?this.origin[0]:"y"===a?this.origin[1]:this.origin},a.prototype.updateEnd=function(){"undefined"!=typeof this.relativeEnd&&(this.end=[this.origin[0]+this.relativeEnd[0],this.origin[1]+this.relativeEnd[1]])},b.Arrow=a,b}angular.module("mmAngularDrawChem").factory("DCArrow",a)}(),function(){"use strict";function a(a,b){function c(a,b,c){this.coords=a,this.bonds=b||[],this.attachedBonds=c||{}}var d={};return c.prototype.isSelected=function(){return!!this.selected},c.prototype.select=function(){this.selected=!0},c.prototype.deleteBond=function(a){var b,c=[];for(b=0;b<this.bonds.length;b+=1)a!==this.bonds[b]&&c.push(this.bonds[b]);this.bonds=c},c.prototype.changeMode=function(){function a(){var a=0,b=0;return"undefined"!=typeof c&&c.forEach(function(c){c.vector[0]>0?a+=1:b+=1}),"undefined"!=typeof d&&d.forEach(function(c){c.vector[0]<0?a+=1:b+=1}),a>b?"lr":"rl"}var b,c=this.getAttachedBonds("in"),d=this.getAttachedBonds("out");"undefined"!=typeof this.label&&(b=a(),this.label.setMode(b))},c.prototype.setAsOrphan=function(){this.orphan=!0},c.prototype.isOrphan=function(){return!!this.orphan},c.prototype.deselect=function(){this.selected=!1},c.getOppositeDirection=function(c){var d=a.DIRECTIONS,e=d.indexOf(c),f=b.moveToRight(d,e,d.length/2);return d[f]},c.prototype.attachBond=function(a,b){"undefined"==typeof this.attachedBonds[a]&&(this.attachedBonds[a]=[]),this.attachedBonds[a].push(b)},c.prototype.setCoords=function(a){this.coords=a},c.prototype.addToCoords=function(a){this.coords[0]+=a[0],this.coords[1]+=a[1]},c.prototype.doOnEach=function(a,b){var c,d,e=this.getBonds();for(a.apply(this,b),c=0;c<e.length;c+=1)d=e[c].getAtom(),a.apply(d,b),d.doOnEach(a,b)},c.prototype.getCoords=function(a){return"x"===a?this.coords[0]:"y"===a?this.coords[1]:this.coords},c.prototype.getAttachedBonds=function(a,c){var d=[];return"undefined"!=typeof a&&"undefined"!=typeof c?(this.attachedBonds[a].forEach(function(a){b.compareVectors(a.vector,c,2)&&d.push(a)}),d):"undefined"!=typeof a&&"undefined"==typeof c?this.attachedBonds[a]:"undefined"==typeof a?this.attachedBonds:void 0},c.prototype.removeAttachedBonds=function(a,c){var d=[];"undefined"!==this.attachedBonds[a]&&(this.attachedBonds[a].forEach(function(a){b.compareVectors(a.vector,c,2)||d.push(a)}),this.attachedBonds[a]=d.length>0?d:void 0)},c.prototype.resetAttachedBonds=function(){this.attachedBonds={}},c.prototype.setLabel=function(a){this.label=a},c.prototype.getLabel=function(){return this.label},c.prototype.removeLabel=function(){this.label=void 0},c.prototype.hasLabel=function(){return!!this.label},c.prototype.getBonds=function(a){return"undefined"==typeof a?this.bonds:this.bonds[a]},c.prototype.setBonds=function(a){this.bonds=a},c.prototype.addBond=function(a){this.bonds.push(a)},c.prototype.addBonds=function(a){a.forEach(function(a){this.bonds.push(a)},this)},d.Atom=c,d}angular.module("mmAngularDrawChem").factory("DCAtom",a),a.$inject=["DrawChemConst","DrawChemUtils"]}(),function(){"use strict";function a(){function a(a,b){this.name=a,this.multiplicity=b}var b={};return a.prototype.getName=function(){return this.name},a.prototype.getMultiplicity=function(){return this.multiplicity},b.BondStructure=a,b}angular.module("mmAngularDrawChem").factory("DCBondStructure",a)}(),function(){"use strict";function a(){function a(a,b){this.type=a,this.atom=b}var b={};return a.prototype.setType=function(a){this.type=a},a.prototype.getType=function(){return this.type},a.prototype.setAtom=function(a){this.atom=a},a.prototype.getAtom=function(){return this.atom},a.prototype.calcMultiplicity=function(){function a(a,b){var c=!1;return b.forEach(function(b){a.indexOf(b)>=0&&(c=!0)}),c}return a(this.type,["single","wedge","dash","undefined"])?1:a(this.type,["double"])?2:a(this.type,["triple"])?3:void 0},b.Bond=a,b}angular.module("mmAngularDrawChem").factory("DCBond",a)}(),function(){"use strict";function a(){function a(a,b,c,d,e){this.name=a,this.ringSize=b,this.angle=c,this.mult=d,this.aromatic=e}var b={};return a.prototype.getName=function(){return this.name},a.prototype.getRingSize=function(){return this.ringSize},a.prototype.getMult=function(){return this.mult},a.prototype.getAngle=function(){return this.angle},a.prototype.isAromatic=function(){return!!this.aromatic},b.CyclicStructure=a,b}angular.module("mmAngularDrawChem").factory("DCCyclicStructure",a)}(),function(){"use strict";function a(){function a(a,b,c){this.labelName=a,this.bonds=b,this.mode=c}var b={};return a.prototype.getLabelName=function(){return this.labelName},a.prototype.setLabelName=function(a){this.labelName=a},a.prototype.getMaxBonds=function(){return this.bonds},a.prototype.setMaxBonds=function(a){this.bonds=a},a.prototype.getMode=function(){return this.mode},a.prototype.setMode=function(a){this.mode=a},b.Label=a,b}angular.module("mmAngularDrawChem").factory("DCLabel",a)}(),function(){"use strict";function a(){function a(a,b){this.origin=a,this.current=b}var b={};return a.prototype.getOrigin=function(a){return"x"===a?this.origin[0]:"y"===a?this.origin[1]:this.origin},a.prototype.setOrigin=function(a){this.origin=a},a.prototype.getCurrent=function(a){return"x"===a?this.current[0]:"y"===a?this.current[1]:this.current},a.prototype.setCurrent=function(a){this.current=a},b.Selection=a,b}angular.module("mmAngularDrawChem").factory("DCSelection",a)}(),function(){"use strict";function a(a,b){function c(a,b,c,d,e,f){this.name=a,this.defs=b,this.ringSize=c,this.angle=d,this.aromatic=f,this.multiplicity=e,this.defaultStructure=b[0]}var d={};return c.prototype.getDefs=function(){return this.defs},c.prototype.getName=function(){return this.name},c.prototype.getRingSize=function(){return this.ringSize},c.prototype.getMult=function(){return this.multiplicity},c.prototype.isAromatic=function(){return!!this.aromatic},c.prototype.getAngle=function(){return this.angle},c.prototype.getDefault=function(){return this.defaultStructure},c.prototype.getStructure=function(c,d){var e,f,g,h=[];if(a.insideCircle(c,d,b.CIRC_R))return this.defaultStructure;for(e=0;e<b.BONDS.length;e+=1)h.push(b.BONDS[e].bond);for(f=a.getClosestVector(c,d,h),e=0;e<this.defs.length;e+=1)if(g=b.getBondByDirection(this.defs[e].getName()).bond,a.compareVectors(g,f,5))return this.defs[e]},d.StructureCluster=c,d}angular.module("mmAngularDrawChem").factory("DCStructureCluster",a),a.$inject=["DrawChemUtils","DrawChemConst"]}(),function(){"use strict";function a(a,b,c,d,e){function f(a,b,c){this.name=a||"",this.structure=b||[],this.origin=[],this.decorate=c||{}}function g(a,b){var c=f.prototype.findMinMax.call(this,a);return i.call(this,b,c.minY)&&i.call(this,b,c.maxY)&&j.call(this,b,c.minX)&&j.call(this,b,c.maxX)}function h(a,b){var c=f.prototype.findMinMax.call(this,a);return i.call(this,b,c.minY)&&i.call(this,b,c.maxY)&&j.call(this,b,c.minX)&&j.call(this,b,c.maxX)}function i(a,b){var c=e.addVectors(this.origin,a.getOrigin()),d=a.getCurrent(),f=e.getQuadrant(c,d);return 1===f||2===f?b<=c[1]&&b>=d[1]:3===f||4===f?b>=c[1]&&b<=d[1]:void 0}function j(a,b){var c=e.addVectors(this.origin,a.getOrigin()),d=a.getCurrent(),f=e.getQuadrant(c,d);return 1===f||4===f?b>=c[0]&&b<=d[0]:2===f||3===f?b<=c[0]&&b>=d[0]:void 0}function k(a,b){var c,d=!1;for(c=0;c<this.structure.length;c+=1){var e,f=this.structure[c];f.selected&&(f instanceof u?(e=p.call(this,f,a,b),d=d?!0:e):f instanceof v&&(e=q.call(this,f,a,b),d=d?!0:e))}return d}function l(a,b){("undefined"==typeof b.minY||a[1]<b.minY)&&(b.minY=a[1])}function m(a,b){("undefined"==typeof b.maxY||a[1]>b.maxY)&&(b.maxY=a[1])}function n(a,b){("undefined"==typeof b.maxX||a[0]>b.maxX)&&(b.maxX=a[0])}function o(a,b){("undefined"==typeof b.minX||a[0]<b.minX)&&(b.minX=a[0])}function p(a,b,c){var d,f=e.addVectors(this.origin,a.getOrigin()),g=e.addVectors(this.origin,a.getEnd()),h={minX:f[0],minY:f[1],maxX:f[0],maxY:f[1]};return"up"===b?(l(g,h),d=c-h.minY,s(a,[0,d])):"down"===b?(m(g,h),d=c-h.maxY,s(a,[0,d])):"left"===b?(o(g,h),d=c-h.minX,s(a,[d,0])):"right"===b&&(n(g,h),d=c-h.maxX,s(a,[d,0])),!e.compareFloats(d,0,5)}function q(a,b,c){function d(a,b){var c,f,g;for(l(a,p),c=0;c<b.getBonds().length;c+=1)g=b.getBonds(c).getAtom(),f=e.addVectors(a,g.getCoords()),d(f,g)}function f(a,b){var c,d,g;for(m(a,p),c=0;c<b.getBonds().length;c+=1)g=b.getBonds(c).getAtom(),d=e.addVectors(a,g.getCoords()),f(d,g)}function g(a,b){var c,d,f;for(n(a,p),c=0;c<b.getBonds().length;c+=1)f=b.getBonds(c).getAtom(),d=e.addVectors(a,f.getCoords()),g(d,f)}function h(a,b){var c,d,f;for(o(a,p),c=0;c<b.getBonds().length;c+=1)f=b.getBonds(c).getAtom(),d=e.addVectors(a,f.getCoords()),h(d,f)}var i,j=a.getCoords(),k=e.addVectors(this.origin,j),p={};return"up"===b?(d(k,a),i=c-p.minY,r.call(this,[0,i],a),s(a,[0,i])):"down"===b?(f(k,a),i=c-p.maxY,r.call(this,[0,i],a),s(a,[0,i])):"left"===b?(h(k,a),i=c-p.minX,r.call(this,[i,0],a),s(a,[i,0])):"right"===b&&(g(k,a),i=c-p.maxX,r.call(this,[i,0],a),s(a,[i,0])),!e.compareFloats(i,0,5)}function r(a,b){angular.forEach(this.decorate.aromatic,function(c){var d=e.compareFloats(c.fromWhich[0],b.getCoords("x"),3)&&e.compareFloats(c.fromWhich[1],b.getCoords("y"),3);d&&(c.fromWhich=e.addVectors(c.fromWhich,a),c.coords=e.addVectors(c.coords,a))})}function s(a,b){var c;a instanceof v?(c=a.getCoords(),a.setCoords([c[0]+b[0],c[1]+b[1]])):a instanceof u&&(c=a.getOrigin(),a.setOrigin([c[0]+b[0],c[1]+b[1]]))}var t={},u=a.Arrow,v=(d.Selection,c.Label,b.Atom);return f.prototype.setAromatic=function(){this.aromatic=!0},f.prototype.isAromatic=function(){return!!this.aromatic},f.prototype.moveStructureTo=function(a,b){function c(a,b,c,d,e){var b=b||5;"left"===c?("undefined"!=typeof d&&r.call(d,[-b,0],e),a[0]-=b):"right"===c?("undefined"!=typeof d&&r.call(d,[b,0],e),a[0]+=b):"up"===c?("undefined"!=typeof d&&r.call(d,[0,-b],e),a[1]-=b):"down"===c?("undefined"!=typeof d&&r.call(d,[0,b],e),a[1]+=b):"mouse"===c&&("undefined"!=typeof d&&r.call(d,b,e),a[0]+=b[0],a[1]+=b[1])}var d,e,f;for(e=0;e<this.structure.length;e+=1)f=this.structure[e],f.selected&&(f instanceof v?(d=f.getCoords(),c(d,b,a,this,f)):f instanceof u&&(d=f.getOrigin(),c(d,b,a),f.updateEnd()))},f.prototype.doOnEach=function(a,b,c){function d(a){var e,f=a.getBonds();for(e=0;e<f.length;e+=1)a=f[e].getAtom(),b.apply(a,c),d(a)}var e,f;for(e=0;e<this.structure.length;e+=1)f=this.structure[e],f instanceof v&&"atom"===a?(b.apply(f,c),d(f)):f instanceof u&&"arrow"===a&&b.apply(f,c)},f.prototype.selectAll=function(){this.selectedAll=!0,this.doOnEach("atom",v.prototype.select),this.doOnEach("arrow",u.prototype.select)},f.prototype.select=function(a){var b,c,d;for(b=0;b<this.structure.length;b+=1)c=this.structure[b],c instanceof u?(d=g.call(this,c,a),d&&c.select()):c instanceof v&&(d=h.call(this,c,a),d&&c.doOnEach(v.prototype.select))},f.prototype.deleteSelected=function(){var a,b,c,d,f,g,h=[];for(a=0;a<this.structure.length;a+=1)if(d=this.structure[a],d.selected){if(d instanceof v&&this.aromatic){for(c=[],b=0;b<this.decorate.aromatic.length;b+=1)g=this.decorate.aromatic[b],f=e.compareFloats(g.fromWhich[0],d.getCoords("x"),3)&&e.compareFloats(g.fromWhich[1],d.getCoords("y"),3),f||c.push(g);this.decorate.aromatic=c}}else h.push(d);this.structure=h},f.prototype.deselectAll=function(){this.selectedAll=!1,this.doOnEach("atom",v.prototype.deselect),this.doOnEach("arrow",u.prototype.deselect)},f.prototype.alignUp=function(a){return k.call(this,"up",a)},f.prototype.alignDown=function(a){return k.call(this,"down",a)},f.prototype.alignRight=function(a){return k.call(this,"right",a)},f.prototype.alignLeft=function(a){return k.call(this,"left",a)},f.prototype.setOrigin=function(a){this.origin=a},f.prototype.getOrigin=function(a){return"x"===a?this.origin[0]:"y"===a?this.origin[1]:this.origin},f.prototype.getSelected=function(){var a,b,c=[];for(a=0;a<this.structure.length;a+=1)b=this.structure[a],b.selected&&c.push(b);return c},f.prototype.setStructure=function(a){this.structure=a},f.prototype.addToStructures=function(a){a instanceof Array?this.structure=this.structure.concat(a):this.structure.push(a)},f.prototype.getStructure=function(a){return 0===arguments.length?this.structure:this.structure[a]},f.prototype.getName=function(){return this.name},f.prototype.getDecorate=function(a){return this.decorate[a]},f.prototype.setDecorate=function(a,b){this.decorate[a]=b},f.prototype.findMinMax=function(a){function b(a){var b,f,g,h;a instanceof v?(b=a.getCoords(),f=e.addVectors(this.origin,b),c(f,a)):a instanceof u&&(g=e.addVectors(this.origin,a.getOrigin()),h=e.addVectors(this.origin,a.getEnd()),d(g),d(h))}function c(a,b){var d,f,h;for(l(a,g),o(a,g),m(a,g),n(a,g),d=0;d<b.getBonds().length;d+=1)h=b.getBonds(d).getAtom(),f=e.addVectors(a,h.getCoords()),c(f,h)}function d(a){l(a,g),o(a,g),m(a,g),n(a,g)}var f,g={};if("undefined"==typeof a)for(f=0;f<this.structure.length;f+=1)a=this.structure[f],a.selected&&b.call(this,a);else b.call(this,a);return g},f.prototype.addDecorate=function(a,b){"undefined"==typeof this.decorate[a]&&(this.decorate[a]=[]),this.decorate[a].push(b)},t.Structure=f,t}angular.module("mmAngularDrawChem").factory("DCStructure",a),a.$inject=["DCArrow","DCAtom","DCLabel","DCSelection","DrawChemUtils"]}(),function(){"use strict";function a(a){function b(a,b,c){this.elementFull=a,this.elementMini=b,this.id=c}var c={};return c.fontSize=18,c.subFontSize=14,c.font="Arial",b.prototype.getElementFull=function(){return this.elementFull},b.prototype.setElementFull=function(a){this.elementFull=a},b.prototype.getElementMini=function(){return this.elementMini},b.prototype.setElementMini=function(a){this.elementMini=a},b.prototype.setMinMax=function(a){this.minMax=a},b.prototype.wrap=function(a,b,c){var d,e={};return"g"!==b||c||(c=e,c.id=this.id),c?(d="<"+b+" ",angular.forEach(c,function(a,b){d+=b+"='"+a+"' "}),"full"===a?this.elementFull=d+">"+this.elementFull+"</"+b+">":"mini"===a&&(this.elementMini=d+">"+this.elementMini+"</"+b+">")):"full"===a?this.elementFull="<"+b+">"+this.elementFull+"</"+b+">":"mini"===a&&(this.elementMini="<"+b+">"+this.elementMini+"</"+b+">"),this},b.generateStyle=function(b){var d={expanded:{"circle.atom:hover":{opacity:"0.3"},"circle.arom:hover":{opacity:"0.3",stroke:"black","stroke-width":a.BOND_WIDTH,fill:"black"},"rect.focus":{opacity:"0",stroke:"black"},"rect.focus:hover":{opacity:"0.3"},"text.edit:hover":{opacity:"0.3"},"circle.atom":{opacity:"0",stroke:"black","stroke-width":a.BOND_WIDTH},"circle.edit":{stroke:"black",fill:"none"},"circle.label":{opacity:"0"},"rect.selection":{stroke:"black","stroke-dasharray":"10 5",fill:"none"}},base:{path:{stroke:"black","stroke-width":a.BOND_WIDTH,fill:"none"},"path.wedge":{fill:"black"},"path.arrow":{fill:"black"},"path.arrow-eq":{fill:"none"},"circle.arom":{stroke:"black","stroke-width":a.BOND_WIDTH,fill:"none"},"circle.tr-arom":{stroke:"black","stroke-width":a.BOND_WIDTH,fill:"none"},text:{"font-family":c.font,cursor:"default","font-size":c.fontSize+"px"},"tspan.sub":{"font-size":c.subFontSize+"px"},"polygon.text":{fill:"white"}}},e='<style type="text/css">';return"expanded"===b?b={base:d.base,expanded:d.expanded}:"base"===b&&(b={base:d.base,expanded:{}}),angular.forEach(b,function(a,b){angular.forEach(a,function(a,b){e+=b+"{",angular.forEach(a,function(a,b){e+=b+":"+a+";"}),e+="}"})}),e+"</style>"},c.Svg=b,c}angular.module("mmAngularDrawChem").factory("DCSvg",a),a.$inject=["DrawChemConst"]}(),function(){"use strict";function a(){var a={};return a.mouseFlags={movedOnEmpty:!1,mouseDown:!1,downOnAtom:!1,downOnBond:!1,downOnNothing:!1},a.customLabel="",a.focused=!1,a.selected="",a}angular.module("mmAngularDrawChem").factory("DrawChemDirectiveFlags",a),a.$inject=[]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h){var i={},j=(f.Label,h.Selection,g.Structure,a.mouseFlags),k=null;return i.doOnMouseDown=function(a,e,f){function g(){var a=c.isWithinAtom(k,j.downMouseCoords);"undefined"!=typeof a.foundAtom&&(j.downOnAtom=!0,j.downAtomObject=a.foundAtom,j.downAtomCoords=a.absPos,j.downAtomPrevAtom=a.prevAtom,j.downAtomLeadingBond=a.leadingBond,j.downAtomFirst=a.firstAtom,j.downAtomHasDuplicate=a.hasDuplicate)}function h(){var a=c.isWithinBond(k,j.downMouseCoords);"undefined"!=typeof a.foundBond&&(j.downOnBond=!0,j.downBondObject=a.foundBond,j.downBondEndAtomPos=a.endAtomAbsPos,j.downBondStartAtom=a.startAtom)}var i;1===a.which&&(j.downMouseCoords=b.innerCoords(f,a),j.mouseDown=!0,k=angular.copy(d.getCurrentStructure()),null!==k&&b.performSearch(["label","removeLabel","customLabel","structure","delete"])&&("tspan"===a.target.nodeName&&(i=angular.element(a.target).parent(),j.downMouseCoords=[parseFloat(i.attr("atomx")),parseFloat(i.attr("atomy"))]),g(),j.downOnAtom||h()))},i.doOnMouseUp=function(e,f,g){var h,i,l=b.innerCoords(g,e),m=!0;return 1!==e.which||""===a.selected?void b.resetMouseFlags():("undefined"!=typeof f.chosenStructure&&(i=f.chosenStructure.getRingSize()),null!==k&&"select"===a.selected?(k=c.makeSelection(k,l,j.downMouseCoords),k.getStructure().pop()):null!==k&&"moveStructure"===a.selected?c.moveStructure(k,l,j.downMouseCoords):"arrow"===a.selected?k=c.addArrowOnEmptySpace(k,l,j.downMouseCoords,f.chosenArrow):j.downOnAtom&&"removeLabel"===a.selected?c.removeLabel(j.downAtomObject,a.selected,f.chosenLabel,a.customLabel):j.downOnAtom&&"delete"===a.selected?(c.deleteAtom(k,j.downAtomObject,j.downAtomCoords,j.downAtomLeadingBond,j.downAtomPrevAtom,j.downAtomHasDuplicate),c.labelSingleAtoms(k)):j.downOnAtom&&b.performSearch(["label","customLabel"])?c.modifyLabel(j.downAtomObject,a.selected,f.chosenLabel,a.customLabel):0===i&&j.downOnAtom&&"structure"===a.selected&&e.ctrlKey?c.modifyAtom(k,j.downAtomObject,j.downAtomFirst,j.downAtomCoords,l,f.chosenStructure,!0):j.downOnAtom&&"structure"===a.selected?c.modifyAtom(k,j.downAtomObject,j.downAtomFirst,j.downAtomCoords,l,f.chosenStructure):j.downOnBond&&"structure"===a.selected?m=c.modifyBond(j.downBondObject,j.downBondStartAtom,f.chosenStructure):j.downOnBond&&"delete"===a.selected?(c.deleteBond(k,j.downBondObject,j.downBondStartAtom,j.downBondEndAtomPos),c.labelSingleAtoms(k)):0===i&&"structure"===a.selected&&e.ctrlKey?k=c.addStructureOnEmptySpace(k,l,j.downMouseCoords,f.chosenStructure,!0):"structure"===a.selected&&(k=c.addStructureOnEmptySpace(k,l,j.downMouseCoords,f.chosenStructure)),null!==k&&m&&(d.addStructure(angular.copy(k)),h=b.drawStructure(k),d.setCurrentSvg(h.wrap("full","g").wrap("full","svg").elementFull)),void b.resetMouseFlags())},i.doOnMouseMove=function(e,f,g){var h,i,l,m=b.innerCoords(g,e),n={};1!==e.which||b.performSearch(["label","labelCustom","delete",""])||("undefined"!=typeof f.chosenStructure&&(l=f.chosenStructure.getRingSize()),i=angular.copy(k),null!==i&&(n=c.isWithinAtom(i,j.downMouseCoords)),"select"===a.selected?c.makeSelection(i,m,j.downMouseCoords):"moveStructure"===a.selected?c.moveStructure(i,m,j.downMouseCoords):"arrow"===a.selected?i=c.addArrowOnEmptySpace(i,m,j.downMouseCoords,f.chosenArrow):0===l&&"undefined"!=typeof n.foundAtom&&e.ctrlKey?c.modifyAtom(i,n.foundAtom,n.firstAtom,n.absPos,m,f.chosenStructure,!0):"undefined"!=typeof n.foundAtom?c.modifyAtom(i,n.foundAtom,n.firstAtom,n.absPos,m,f.chosenStructure):0===l&&"structure"===a.selected&&e.ctrlKey?i=c.addStructureOnEmptySpace(i,m,j.downMouseCoords,f.chosenStructure,!0):"structure"===a.selected&&(i=c.addStructureOnEmptySpace(i,m,j.downMouseCoords,f.chosenStructure)),null!==i&&(h=b.drawStructure(angular.copy(i)),d.setCurrentSvg(h.wrap("full","g").wrap("full","svg").elementFull)))},i}angular.module("mmAngularDrawChem").factory("DrawChemDirectiveMouseActions",a),a.$inject=["DrawChemDirectiveFlags","DrawChemDirectiveUtils","DrawChemModStructure","DrawChemCache","DrawChemConst","DCLabel","DCStructure","DCSelection"]}(),function(){"use strict";function a(a,b,c,d){var e={};return e.drawStructure=function(a){return b.draw(a,"cmpd1")},e.resetMouseFlags=function(){angular.forEach(d.mouseFlags,function(a,b){"boolean"==typeof a?d.mouseFlags[b]=!1:d.mouseFlags[b]=void 0})},e.subtractVectors=function(a,b){return[a[0]-b[0],a[1]-b[1]]},e.isContentEmpty=function(){return null===c.getCurrentStructure()},e.innerCoords=function(a,b){var c=a.find("dc-content")[0],d=[parseFloat((b.clientX-c.getBoundingClientRect().left-2).toFixed(2)),parseFloat((b.clientY-c.getBoundingClientRect().top-2).toFixed(2))];return d},e.performSearch=function(a){var b=!1;return a.forEach(function(a){a===d.selected&&(b=!0)}),b},e}angular.module("mmAngularDrawChem").factory("DrawChemDirectiveUtils",a),a.$inject=["DrawChemModStructure","DrawChemSvgRenderer","DrawChemCache","DrawChemDirectiveFlags"]}(),function(){"use strict";function a(a,b,c,d,e,f,g){return{template:'<div ng-include="getEditorUrl()"></div>',scope:{showEditor:"="},link:function(h,i,j){h.getEditorUrl=function(){var b=""===j.dcModal?"draw-chem-editor-modal.html":"draw-chem-editor.html";return a.getPath()+b},h.pathToSvg=a.getPathToSvg(),h.dialogStyle={},j.width&&(h.dialogStyle.width=j.width),j.height&&(h.dialogStyle.height=j.height),h.setFocus=function(){c.focused=!0},h.unsetFocus=function(){c.focused=!1},h.content=function(){return g.trustAsHtml(b.getCurrentSvg())},f.addButtonsToScope(h),h.doOnMouseDown=function(a){try{e.doOnMouseDown(a,h,i)}catch(b){d.resetMouseFlags(),console.log(b,b.name,b.message)}},h.doOnMouseUp=function(a){try{e.doOnMouseUp(a,h,i)}catch(b){d.resetMouseFlags(),console.log(b,b.name,b.message)}},h.doOnMouseMove=function(a){try{e.doOnMouseMove(a,h,i)}catch(b){d.resetMouseFlags(),console.log(b,b.name,b.message)}}}}}angular.module("mmAngularDrawChem").directive("drawChemEditor",a),a.$inject=["DrawChemPaths","DrawChemCache","DrawChemDirectiveFlags","DrawChemDirectiveUtils","DrawChemDirectiveMouseActions","DrawChemMenuButtons","$sce"]}(),function(){"use strict";function a(){var a={},b=[{structure:null,svg:""}],c=0;return a.addStructure=function(d){c<b.length-1&&(b=b.slice(0,c+1)),b.push({structure:d,svg:""}),b.length>10&&b.shift(),a.moveRightInStructures()},a.getCurrentPosition=function(){return c},a.getStructureLength=function(){return b.length},a.getCurrentStructure=function(){return b[c].structure},a.getCurrentSvg=function(){return b[c].svg},a.setCurrentSvg=function(a){b[c].svg=a},a.moveLeftInStructures=function(){c>0&&(c-=1)},a.moveRightInStructures=function(){c<b.length-1&&(c+=1)},a}angular.module("mmAngularDrawChem").factory("DrawChemCache",a)}(),function(){"use strict";function a(a){function b(){function b(){var b=[0,-c.BOND_LENGTH];c.DIRECTIONS.forEach(function(d){var e="BOND_"+d;c[e]=b,c.BONDS.push({direction:d,bond:b}),b=a.rotVectCW(b,c.FREQ)})}c.BOND_LENGTH=c.SET_BOND_LENGTH||20,c.WIDTH_TO_LENGTH=.04,c.FREQ=15,c.PUSH=.3,c.ANGLE=120,c.MAX_BONDS=10,c.AROMATIC_R=.45*c.BOND_LENGTH,c.BETWEEN_DBL_BONDS=.065,c.BOND_FOCUS=.15,c.DBL_BOND_CORR=.05,c.UNDEF_BOND=1.5*c.BETWEEN_DBL_BONDS,c.BETWEEN_TRP_BONDS=.1,c.ARROW_SIZE=.065,c.ARROW_START=.85,c.BOND_WIDTH=(c.BOND_LENGTH*c.WIDTH_TO_LENGTH).toFixed(2),c.CIRC_R=.17*c.BOND_LENGTH,c.DIRECTIONS=["N","NE1","NE2","NE3","NE4","NE5","E","SE1","SE2","SE3","SE4","SE5","S","SW1","SW2","SW3","SW4","SW5","W","NW1","NW2","NW3","NW4","NW5"],c.BONDS=[],b(),c.getBondByDirection=function(a){var b;for(b=0;b<c.BONDS.length;b+=1)if(c.BONDS[b].direction===a)return c.BONDS[b]}}var c={};return c.SET_BOND_LENGTH,c.setBondLength=function(a){c.SET_BOND_LENGTH=a,b()},b(),c}angular.module("mmAngularDrawChem").factory("DrawChemConst",a),a.$inject=["DrawChemUtils"]}(),function(){"use strict";function a(){var a={};return a.getQuadrant=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return c>0&&0>d?1:0>c&&0>d?2:0>c&&d>0?3:4},a.addVectors=function(a,b,c){return"undefined"==typeof c?[a[0]+b[0],a[1]+b[1]]:[a[0]+c*b[0],a[1]+c*b[1]]},a.multVectByScalar=function(a,b){return[a[0]*b,a[1]*b]},a.compareVectors=function(a,b,c){return"undefined"==typeof a||"undefined"==typeof b?!1:a[0].toFixed(c)===b[0].toFixed(c)&&a[1].toFixed(c)===b[1].toFixed(c)},a.isNumeric=function(a){return a-parseFloat(a)>=0},a.isSmallLetter=function(a){return a.length>1?!1:a>="a"&&"z">=a},a.compareFloats=function(a,b,c){return a.toFixed(c)===b.toFixed(c)},a.invertGroup=function(a){var b,c,d="";if(c="undefined"==typeof a?"":a.match(/[A-Z][a-z\d]*/g),null===c)return a;for(b=c.length-1;b>=0;b-=1)d+=c[b];return d},a.moveToLeft=function(a,b,c){return 0>b-c?b-c+a.length:b-c},a.moveToRight=function(a,b,c){return b+c>a.length-1?b+c-a.length:b+c},a.calcPossibleVectors=function(b,c){var d,e=[];for(d=0;360/c>d;d+=1)b=a.rotVectCW(b,c),e.push(b);return e},a.getClosestVector=function(b,c,d){var e,f,g,h=[c[0]-b[0],c[1]-b[1]],i=Math.PI,j=0;for(f=0;f<d.length;f+=1)g=d[f],e=Math.acos(a.dotProduct(a.norm(g),a.norm(h))),Math.abs(e)<i&&(i=Math.abs(e),j=f);return d[j]},a.checkAttachedBonds=function(b,c,d,e){function f(c){function e(e,g){var h,i;for(h=0;h<e.length;h+=1)i="in"===g?a.rotVectCW(e[h].vector,180):e[h].vector,a.compareVectors(i,c,5)&&(b=a.rotVectCW(c,d),f(b))}e(g,"in"),e(h,"out")}var g=c.getAttachedBonds("in")||[],h=c.getAttachedBonds("out")||[];return g.length+h.length>=e?"full atom":(f(b),b)},a.dotProduct=function(a,b){return a[0]*b[0]+a[1]*b[1]},a.norm=function(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]);return[a[0]/b,a[1]/b]},a.rotVectCCW=function(a,b){var c=b*(Math.PI/180),d=a[0]*Math.cos(c)+a[1]*Math.sin(c),e=a[1]*Math.cos(c)-a[0]*Math.sin(c);return[d,e]},a.rotVectCW=function(a,b){var c=b*(Math.PI/180),d=a[0]*Math.cos(c)-a[1]*Math.sin(c),e=a[0]*Math.sin(c)+a[1]*Math.cos(c);return[d,e]},a.insideCircle=function(a,b,c){var d=Math.sqrt(Math.pow(b[0]-a[0],2)+Math.pow(b[1]-a[1],2));return c>=d},a.insideFocus=function(b,c,d,e,f){var g,h,i=c.getAtom().getCoords(),j=0,k=a.addVectors(b,i),l=a.multVectByScalar(a.norm(i),f),m=a.getPerpVectorCCW(l),n=a.getPerpVectorCW(l),o=[a.addVectors(b,m,e),a.addVectors(b,n,e),a.addVectors(k,n,e),a.addVectors(k,m,e)];for(g=0;g<o.length;g+=1)h=a.moveToRight(o,g,1),j+=a.getTriangleArea(d,o[g],o[h]);return j.toFixed(2)===a.getRectArea(o).toFixed(2)},a.subtractVectors=function(a,b){return[a[0]-b[0],a[1]-b[1]]},a.getTriangleArea=function(a,b,c){var d=a[0]*(b[1]-c[1]),e=b[0]*(c[1]-a[1]),f=c[0]*(a[1]-b[1]);return Math.abs((d+e+f)/2)},a.getRectArea=function(b){var c=a.subtractVectors(b[1],b[0]),d=a.subtractVectors(b[2],b[1]);return a.getLength(c)*a.getLength(d)},a.getLength=function(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])},a.calcAngle=function(a,b){var c;return"undefined"==typeof b&&(b=[1,0]),c=Math.atan2(b[1],b[0])-Math.atan2(a[1],a[0]),180*c/Math.PI},a.doWithManyVectors=function(b,c,d){var e;c.forEach(function(c){"add"===b?(e=a.addVectors(c,d),c[0]=e[0],c[1]=e[1]):"subtract"===b&&(e=a.subtractVectors(c,d),c[0]=e[0],c[1]=e[1])})},a.getPerpVectorCCW=function(a){return[-a[1],a[0]]},a.getPerpVectorCW=function(a){return[a[1],-a[0]]},a.vect=function(b){function c(b){return a.getLength(e.vectorInit)<a.getLength(b)}function d(b){return a.getLength(e.vectorInit)>a.getLength(b)}var e={vectorInit:b,isLongerThan:d,isShorterThan:c};return e},a}angular.module("mmAngularDrawChem").factory("DrawChemUtils",a)}(),function(){"use strict";function a(a,b,c,d){return{restrict:"A",link:function(e,f){f.bind("keydown",function(d){!a.showEditor()||c.focused&&!d.ctrlKey||(d.preventDefault(),b.down(d.keyCode))}),f.bind("keyup",function(e){!a.showEditor()||c.focused&&!e.ctrlKey||(e.preventDefault(),b.released(e.keyCode),d.$digest())})}}}angular.module("mmAngularDrawChem").directive("dcShortcuts",a),a.$inject=["DrawChem","DrawChemKeyShortcuts","DrawChemDirectiveFlags","$rootScope"]}(),function(){"use strict";function a(a,b,c){function d(a,b){var c,d,e={cb:b,keys:{}};if(a.indexOf(" + ")>=0)for(d=a.split(" + "),c=0;c<d.length;c+=1)e.keys[d[c]]=!1;else d=a,e.keys[d]=!1;h[a]=e}function e(a,b){var c=g[a];"undefined"!=typeof c&&angular.forEach(h,function(a,d){"undefined"!=typeof a.keys[c]&&(a.keys[c]=b)})}function f(a){function b(a){var b="undefined"!=typeof a;return angular.forEach(a,function(a,c){a||(b=!1)}),b}angular.forEach(h,function(a,c){b(a.keys)&&a.cb()})}for(var g={16:"shift",17:"ctrl",37:"leftarrow",38:"uparrow",39:"rightarrow",40:"downarrow",46:"del"},h={},i={},j=65;90>=j;j+=1)g[j]=String.fromCharCode(j).toLowerCase();return angular.forEach(a.actions,function(a){"undefined"!=typeof a.shortcut&&d(a.shortcut,a.action)}),angular.forEach(b.edits,function(a){"undefined"!=typeof a.shortcut&&("arrows / ctrl + b"===a.shortcut?(d("leftarrow",a.shortcutBind.left),d("uparrow",a.shortcutBind.up),d("rightarrow",a.shortcutBind.right),d("downarrow",a.shortcutBind.down),d("ctrl + b",a.action)):d(a.shortcut,a.action))}),i.down=function(a){e(a,!0)},i.released=function(a){f(),e(a,!1)},i}angular.module("mmAngularDrawChem").factory("DrawChemKeyShortcuts",a),a.$inject=["DrawChemActions","DrawChemEdits"]}(),function(){"use strict";function a(){function a(a){for(var b=0;b<g.length;b++)if(g[b].name===a)return!0;return!1}function b(a){for(var b=0;b<g.length;b++)if(g[b].name===a)return g[b]}function c(a,b){var c;for(c=0;c<g.length;c++)if(g[c].name===b)return g[c].content=a;g.push({name:b,content:a})}function d(a,b){var c;for(c=0;c<g.length;c++)if(g[c].name===b)return g[c].structure=a;g.push({name:b,structure:a})}var e={},f=!1,g=[],h={};return e.showEditor=function(){return f},e.runEditor=function(c){var d;f=!0,a(c)||g.push({name:c,content:"",structure:null}),d=b(c),h.name=d.name,h.content=d.content,h.structure=d.structure},e.getContent=function(a){if("string"==typeof a){var c=b(a);return"undefined"==typeof c?"":c.content}return h.content},e.getInstance=function(a){return"undefined"==typeof a?h:b(a)},e.setContent=function(a,b){"undefined"==typeof b?h.content=a:c(a,b)},e.setStructure=function(a,b){"undefined"==typeof b?h.structure=a:d(a,b)},e.transferContent=function(){c(h.content,h.name),d(h.structure,h.name)},e.closeEditor=function(){f=!1,h={}},e.clearContent=function(a){"string"==typeof a?c("",a):h.content=""},e.beautifySvg=function(a){var b,c=e.getContent(a),d="<!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'>\n";return b=c.match(/<svg.*?>|<g.*?>|<style.*?<\/style>|<path.*?><\/path>|<circle.*?><\/circle>|<polygon.*?><\/polygon>|<text.*?<\/text>|<\/g>|<\/svg>|/g),b.forEach(function(a){d+=a+"\n"}),d},e}angular.module("mmAngularDrawChem").factory("DrawChem",a)}(),function(){"use strict";function a(a,b,c){var d={};return d.close=function(){b.closeEditor()},d.transfer=function(){var d,e,f=a.getCurrentStructure(),g="";null!==f&&(d=c.draw(f,"transfer"),e={viewBox:(d.minMax.minX-30).toFixed(2)+" "+(d.minMax.minY-30).toFixed(2)+" "+(d.minMax.maxX-d.minMax.minX+60).toFixed(2)+" "+(d.minMax.maxY-d.minMax.minY+60).toFixed(2),
height:"100%",width:"100%",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},g=d.wrap("mini","g").wrap("mini","svg",e).elementMini),b.setContent(g),b.setStructure(f),b.transferContent()},d.actions={transfer:{shortcut:"ctrl + t",id:"transfer",action:d.transfer},close:{shortcut:"ctrl + q",id:"close",action:d.close}},d}angular.module("mmAngularDrawChem").factory("DrawChemActions",a),a.$inject=["DrawChemCache","DrawChem","DrawChemSvgRenderer","DrawChemDirectiveUtils"]}(),function(){"use strict";function a(a,b,c,d,e){function f(b){function c(){var a=g(b),c=new j(b,a);return c}return function(b){b.chosenArrow=c(),a.selected="arrow"}}function g(a){var d,e=c.BOND_N,f=[],g=b.calcPossibleVectors(e,c.FREQ);for(g.push(e),d=0;d<g.length;d+=1)f.push(new i(a,g[d]));return f}var h={},i=(c.BONDS,d.Arrow),j=e.ArrowCluster;return h.arrows={"one way arrow":{action:f("one-way-arrow"),id:"one-way-arrow",thumbnail:!0},"two way arrow":{action:f("two-way-arrow"),id:"two-way-arrow",thumbnail:!0},"equilibrium arrow":{action:f("equilibrium-arrow"),id:"equilibrium-arrow",thumbnail:!0}},h}angular.module("mmAngularDrawChem").factory("DrawChemArrows",a),a.$inject=["DrawChemDirectiveFlags","DrawChemUtils","DrawChemConst","DCArrow","DCArrowCluster"]}(),function(){"use strict";function a(a,b,c,d){var e={};return e.deleteFromStructure=function(){d.selected="delete"},e.deleteSelected=function(){var a,d=angular.copy(b.getCurrentStructure());null!==d&&(d.deleteSelected(),b.addStructure(d),a=c.drawStructure(d),b.setCurrentSvg(a.wrap("full","g").wrap("full","svg").elementFull))},e.select=function(){e.deselectAll(),d.selected="select"},e.selectAll=function(){var a,d=angular.copy(b.getCurrentStructure());null!==d&&(d.selectAll(),b.addStructure(d),a=c.drawStructure(d),b.setCurrentSvg(a.wrap("full","g").wrap("full","svg").elementFull))},e.deselectAll=function(){var a,d=angular.copy(b.getCurrentStructure());null!==d&&(d.deselectAll(),b.addStructure(d),a=c.drawStructure(d),b.setCurrentSvg(a.wrap("full","g").wrap("full","svg").elementFull))},e.copy=function(){var a,c=angular.copy(b.getCurrentStructure());null!==c&&(a=c.getSelected(),c.setStructure(a),d.copy=c)},e.cut=function(){var a,e,f=angular.copy(b.getCurrentStructure()),g=angular.copy(b.getCurrentStructure());null!==f&&(e=g.getSelected(),g.setStructure(e),d.copy=g,f.deleteSelected(),b.addStructure(f),a=c.drawStructure(f),b.setCurrentSvg(a.wrap("full","g").wrap("full","svg").elementFull))},e.paste=function(){function a(a){a.forEach(function(a){a.addToCoords([50,50])})}var e,f=angular.copy(b.getCurrentStructure()),g=angular.copy(d.copy);null!==f&&"undefined"!=typeof g&&(f.deselectAll(),a(g.getStructure()),f.addToStructures(g.getStructure()),b.addStructure(f),e=c.drawStructure(f),b.setCurrentSvg(e.wrap("full","g").wrap("full","svg").elementFull))},e.alignUp=function(){var a,d,e=angular.copy(b.getCurrentStructure()),f=!1;null!==e&&(d=e.findMinMax(),f=e.alignUp(d.minY),f&&(b.addStructure(e),a=c.drawStructure(e),b.setCurrentSvg(a.wrap("full","g").wrap("full","svg").elementFull)))},e.alignDown=function(){var a,d,e=angular.copy(b.getCurrentStructure()),f=!1;null!==e&&(a=e.findMinMax(),f=e.alignDown(a.maxY),f&&(b.addStructure(e),d=c.drawStructure(e),b.setCurrentSvg(d.wrap("full","g").wrap("full","svg").elementFull)))},e.alignRight=function(){var a,d,e=angular.copy(b.getCurrentStructure()),f=!1;null!==e&&(d=e.findMinMax(),f=e.alignRight(d.maxX),f&&(b.addStructure(e),a=c.drawStructure(e),b.setCurrentSvg(a.wrap("full","g").wrap("full","svg").elementFull)))},e.alignLeft=function(){var a,d,e=angular.copy(b.getCurrentStructure()),f=!1;null!==e&&(d=e.findMinMax(),f=e.alignLeft(d.minX),f&&(b.addStructure(e),a=c.drawStructure(e),b.setCurrentSvg(a.wrap("full","g").wrap("full","svg").elementFull)))},e.moveStructure=function(){function a(a){return function(){var d,e=angular.copy(b.getCurrentStructure());null!==e&&(e.moveStructureTo(a),b.addStructure(e),d=c.drawStructure(e),b.setCurrentSvg(d.wrap("full","g").wrap("full","svg").elementFull))}}return d.selected="moveStructure",{left:a("left"),up:a("up"),right:a("right"),down:a("down")}},e.undo=function(){var d;b.moveLeftInStructures(),null===b.getCurrentStructure()?a.clearContent():(d=c.drawStructure(b.getCurrentStructure()),b.setCurrentSvg(d.wrap("full","g").wrap("full","svg").elementFull))},e.forward=function(){var d;b.moveRightInStructures(),null===b.getCurrentStructure()?a.clearContent():(d=c.drawStructure(b.getCurrentStructure()),b.setCurrentSvg(d.wrap("full","g").wrap("full","svg").elementFull))},e.deleteAll=function(){b.addStructure(null),b.setCurrentSvg("")},e.edits={move:{action:e.moveStructure,id:"move",shortcut:"arrows / ctrl + b",shortcutBind:{left:e.moveStructure().left,up:e.moveStructure().up,right:e.moveStructure().right,down:e.moveStructure().down}},select:{action:e.select,id:"select",shortcut:"shift + s"},"select all":{action:e.selectAll,id:"select-all",shortcut:"ctrl + a"},"deselect all":{action:e.deselectAll,id:"deselect-all",shortcut:"ctrl + d",separate:!0},copy:{action:e.copy,id:"copy",shortcut:"ctrl + c"},cut:{action:e.cut,id:"cut",shortcut:"ctrl + x"},undo:{action:e.undo,id:"undo",shortcut:"ctrl + z"},forward:{action:e.forward,id:"forward",shortcut:"ctrl + f"},paste:{action:e.paste,id:"paste",shortcut:"ctrl + v",separate:!0},"align up":{action:e.alignUp,id:"align-up",shortcut:"shift + q"},"align down":{action:e.alignDown,id:"align-down",shortcut:"shift + w"},"align right":{action:e.alignRight,id:"align-right",shortcut:"shift + r"},"align left":{action:e.alignLeft,id:"align-left",separate:!0,shortcut:"shift + e"},"delete all":{shortcut:"ctrl + e",id:"clear",action:e.deleteAll},"delete selected":{action:e.deleteSelected,id:"delete-selected",shortcut:"del"},erase:{action:e.deleteFromStructure,id:"delete"}},e}angular.module("mmAngularDrawChem").factory("DrawChemEdits",a),a.$inject=["DrawChem","DrawChemCache","DrawChemDirectiveUtils","DrawChemDirectiveFlags"]}(),function(){"use strict";function a(){var a={};return a.todo=function(){},a.shapes={dummy:{action:a.todo}},a}angular.module("mmAngularDrawChem").factory("DrawChemGeomShapes",a),a.$inject=[]}(),function(){"use strict";function a(a,b){function c(){return function(a){b.selected="removeLabel"}}function d(a,c){return function(d){d.chosenLabel=new f(a,c),b.selected="label"}}var e={},f=a.Label;return e.labels={oxygen:{action:d("O",2),id:"oxygen"},sulfur:{action:d("S",2),id:"sulfur"},phosphorus:{action:d("P",3),id:"phosphorus"},nitrogen:{action:d("N",3),id:"nitrogen"},carbon:{action:d("C",4),id:"carbon"},fluorine:{action:d("F",1),id:"fluorine"},chlorine:{action:d("Cl",1),id:"chlorine"},bromine:{action:d("Br",1),id:"bromine"},iodine:{action:d("I",1),id:"iodine"},hydrogen:{action:d("H",1),id:"hydrogen",separate:!0},"remove label":{action:c(),id:"remove-label"}},e}angular.module("mmAngularDrawChem").factory("DrawChemLabels",a),a.$inject=["DCLabel","DrawChemDirectiveFlags"]}(),function(){"use strict";function a(a,b,c,d,e,f,g){var h={};return h.addButtonsToScope=function(f){var h={Actions:{actions:c.actions},Edit:{actions:d.edits},Arrows:{actions:e.arrows},Structures:{actions:a.structures},Labels:{actions:b.labels}};f.menu={},f.quickMenu={},angular.forEach(h,function(a,b){f.menu[b]={actions:a.actions,scope:f}}),angular.forEach(h.Structures.actions,function(a,b){a.quick&&(f.quickMenu[b]=a,a.scope=f)}),f.chooseCustomLabel=function(a){g.customLabel=a,g.selected="customLabel"}},h}angular.module("mmAngularDrawChem").factory("DrawChemMenuButtons",a),a.$inject=["DrawChemStructures","DrawChemLabels","DrawChemActions","DrawChemEdits","DrawChemArrows","DrawChemGeomShapes","DrawChemDirectiveFlags"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i){function j(a){return function(b){b.chosenStructure=a(),i.selected="structure"}}function k(){n.forEach(function(a){var b=a.getName(),c=a.getMultiplicity();o[b+"Bond"]=function(){var a=o.generateBonds(b,c),d=new u(b,a,0,0,c);return d}})}function l(){m.forEach(function(a){var b=a.getName(),c=a.getRingSize(),d=a.getAngle(),e=a.isAromatic(),f=a.getMult();o[b]=function(){var a=o.generateRings(d,c,e,f),g=new u(b,a,c,d,f,e);return g}})}var m,n,o={},p=e.Atom,q=f.Bond,r=g.CyclicStructure,s=h.BondStructure,t=c.Structure,u=d.StructureCluster,v=a.BONDS;return m=[new r("cyclopropane",3,60),new r("cyclobutane",4,90),new r("cyclopentane",5,108),new r("cyclopentadiene",5,108,{every:2}),new r("cyclohexane",6,120),new r("benzene",6,120,{every:2},!0),new r("benzeneAlt",6,120,{every:2}),new r("cycloheptane",7,128.57),new r("cyclooctane",8,135),new r("cyclononane",9,140)],n=[new s("single",1),new s("wedge",1),new s("dash",1),new s("undefined",1),new s("double",2),new s("triple",3)],l(),k(),o.structures={cyclopropane:{action:j(o.cyclopropane),id:"cyclopropane",thumbnail:!0},cyclobutane:{action:j(o.cyclobutane),id:"cyclobutane",thumbnail:!0},benzene:{action:j(o.benzene),id:"benzene",thumbnail:!0},"benzene alt":{action:j(o.benzeneAlt),id:"benzene-alt",thumbnail:!0,quick:!0},cyclohexane:{action:j(o.cyclohexane),id:"cyclohexane",thumbnail:!0,quick:!0},cyclopentane:{action:j(o.cyclopentane),id:"cyclopentane",thumbnail:!0,quick:!0},cyclopentadiene:{action:j(o.cyclopentadiene),id:"cyclopentadiene",thumbnail:!0},cycloheptane:{action:j(o.cycloheptane),id:"cycloheptane",thumbnail:!0},cyclooctane:{action:j(o.cyclooctane),id:"cyclooctane",thumbnail:!0},cyclononane:{action:j(o.cyclononane),id:"cyclononane",separate:!0,thumbnail:!0},"single bond":{action:j(o.singleBond),id:"single-bond",thumbnail:!0,quick:!0},"wedge bond":{action:j(o.wedgeBond),id:"wedge-bond",thumbnail:!0,quick:!0},"dash bond":{action:j(o.dashBond),id:"dash-bond",thumbnail:!0,quick:!0},"undefined bond":{action:j(o.undefinedBond),id:"undefined-bond",thumbnail:!0},"double bond":{action:j(o.doubleBond),id:"double-bond",thumbnail:!0,quick:!0},"triple bond":{action:j(o.tripleBond),id:"triple-bond",thumbnail:!0,quick:!0}},o.generateBonds=function(a,b){var c,d,e,f=[];for(c=0;c<v.length;c+=1)d=v[c].bond,e=v[c].direction,f.push(new t(e,[new p([0,0],[o.generateBond(d,a,b)],{out:[{vector:d,multiplicity:b}]})]));return f},o.generateBond=function(a,b,c){return new q(b,new p(a,[],{"in":[{vector:angular.copy(a),multiplicity:c}]}))},o.generateRings=function(c,d,e,f){function g(c,d,g){var h,i,j,k=p.getOppositeDirection(c),l=a.getBondByDirection(k).bond,m=b.rotVectCCW(l,d/2);return h=new p([0,0],[],{out:[{vector:angular.copy(m),multiplicity:1}]}),i=new p(m,[],{"in":[{vector:angular.copy(m),multiplicity:1}]}),h.addBond(new q("single",i)),o.generateRing(i,g,d,h,f,2,e),j=new t(k,[h]),e&&j.setAromatic(),j}var h,i,j=[];for(h=0;h<v.length;h+=1)i=v[h].direction,j.push(g(i,c,d));return j},o.generateRing=function(a,c,d,e,f,g,h){var i=b.rotVectCW(a.getCoords(),180-d),j=1,k="single",l=new p(i,[]);return"undefined"==typeof f||g%f.every!==0&&1!==c||(j=2,k=h?"single":"double-left"),a.attachBond("out",{vector:angular.copy(i),multiplicity:j}),1===c?(a.setAsOrphan(),void e.attachBond("in",{vector:angular.copy(a.getCoords()),multiplicity:j})):(l.attachBond("in",{vector:angular.copy(i),multiplicity:j}),a.addBond(new q(k,l)),void o.generateRing(l,c-1,d,e,f,g+1,h))},o}angular.module("mmAngularDrawChem").factory("DrawChemStructures",a),a.$inject=["DrawChemConst","DrawChemUtils","DCStructure","DCStructureCluster","DCAtom","DCBond","DCCyclicStructure","DCBondStructure","DrawChemDirectiveFlags"]}(),function(){"use strict";function a(){var a="",b=a+"svg";return{setPath:function(b){a=b},setPathSvg:function(a){b=a},$get:function(){return{getPath:function(){return a},getPathToSvg:function(){return b}}}}}angular.module("mmAngularDrawChem").provider("DrawChemPaths",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j){var k={},l=a.BOND_LENGTH,m=a.BOND_FOCUS,n=(a.BONDS_AUX,a.CIRC_R),o=(a.AROMATIC_R,d.Atom),p=(f.Arrow,e.Bond),q=(h.Svg,i.Label),r=j.Structure,s=g.Selection;return k.isWithinAtom=function(a,c){function d(a,h,i){var j,k,l,m;for(j=0;j<a.length;j+=1)m=a[j],(m instanceof o||m instanceof p)&&(m instanceof o?(l=m,e=m):l=m.getAtom(),k=b.addVectors(l.getCoords(),h),b.insideCircle(k,c,n)&&(f?g.hasDuplicate=!0:(g.foundAtom=l,g.leadingBond=m instanceof p?m:void 0,g.prevAtom=i,g.absPos=k,g.firstAtom=e),f=!0),d(l.getBonds(),k,l))}var e,f=!1,g={},h=a.getOrigin();return d(a.getStructure(),h),g},k.isWithinBond=function(a,c){function d(a,c){var d,f,g;for(d=0;d<a.length;d+=1)f=a[d],f instanceof o&&(g=b.addVectors(f.getCoords(),c),e(f,g))}function e(a,d){var h,i,j;for(i=a.getBonds(),h=0;h<i.length;h+=1)j=b.addVectors(i[h].getAtom().getCoords(),d),!f&&b.insideFocus(d,i[h],c,m,l)&&(f=!0,g.foundBond=i[h],g.startAtom=a,g.endAtomAbsPos=j),e(i[h].getAtom(),j)}var f=!1,g={},h=a.getOrigin();return d(a.getStructure(),h),g},k.deleteBond=function(a,c,d,e){var f=c.getAtom(),g=b.subtractVectors(e,a.getOrigin());f.removeAttachedBonds("in",f.getCoords()),d.removeAttachedBonds("out",f.getCoords()),d.deleteBond(c),f.setCoords(g),a.addToStructures(f)},k.deleteAtom=function(a,c,d,e,f,g){function h(a,c){var d,e,f,g=[];for(d=0;d<a.length;d+=1)e=a[d].getAtom(),e.removeAttachedBonds("in",e.getCoords()),f=b.addVectors(c,e.getCoords()),e.setCoords(f),g.push(e);return g}var i,j,l,m,n,o=c.getBonds(),p=[],q=[];if("undefined"!=typeof e){for(l=0;l<o.length;l+=1)i=o[l].getAtom(),i.removeAttachedBonds("in",i.getCoords()),j=b.addVectors(d,i.getCoords()),i.setCoords(b.subtractVectors(j,a.getOrigin())),p.push(i);a.addToStructures(p),f.removeAttachedBonds("out",c.getCoords()),f.deleteBond(e)}else{for(m=a.getStructure(),l=0;l<m.length;l+=1)m[l]!==c?q.push(m[l]):q=q.concat(h(m[l].getBonds(),m[l].getCoords()));a.setStructure(q)}g&&(n=k.isWithinAtom(a,d),k.deleteAtom(a,n.foundAtom,n.absPos,n.leadingBond,n.prevAtom,n.hasDuplicate))},k.moveStructure=function(a,c,d){var e;null!==a&&(e=b.subtractVectors(c,d),a.moveStructureTo("mouse",e))},k.labelSingleAtoms=function(a){var c,d,e,f,g=a.getStructure();for(c=0;c<g.length;c+=1)d=g[c],d instanceof o&&!d.isOrphan()&&0===d.getBonds().length&&(f=b.addVectors(a.getOrigin(),d.getCoords()),e=k.isWithinAtom(a,f).hasDuplicate,e||(d.setLabel(new q("C",4,"lr")),d.resetAttachedBonds()))},k.removeLabel=function(a){a.removeLabel()},k.modifyLabel=function(a,b,c,d){var e=a.getLabel();"label"===b?a.setLabel(angular.copy(c)):"customLabel"===b&&(d="undefined"==typeof d?"":d,a.setLabel(new q(d,0))),a.changeMode(),"undefined"!=typeof e&&("lr"===e.getMode()?a.getLabel().setMode("rl"):"rl"===e.getMode()&&a.getLabel().setMode("lr"))},k.modifyAtom=function(d,e,f,g,h,i,j){function m(a){var f,h,j,l,m,n=i.getName(),q=i.getRingSize(),r=i.getMult();q>0?(h=i.getAngle(),l=b.rotVectCCW(a,h/2),j=new o(l,[],{"in":[{vector:angular.copy(l),multiplicity:1}]}),e.addBond(new p("single",j)),e.attachBond("out",{vector:angular.copy(l),multiplicity:1}),c.generateRing(j,q,h,e,i.getMult(),2,i.isAromatic())):(f=c.generateBond(a,n,r),m=k.isWithinAtom(d,b.addVectors(g,a)),"undefined"!=typeof m.foundAtom&&(a=b.subtractVectors(m.absPos,g),f.getAtom().setCoords(a),f.getAtom().setAsOrphan(),m.foundAtom.attachBond("in",{vector:a,multiplicity:r})),e.addBond(f),e.attachBond("out",{vector:angular.copy(a),multiplicity:r})),e.changeMode()}function q(a){i.isAromatic()&&"undefined"!=typeof f&&(d.setAromatic(),d.addDecorate("aromatic",{fromWhich:f.getCoords(),coords:b.addVectors(a,g)}))}function r(){var c,d,f,g,h,j=e.getAttachedBonds("in"),k=e.getAttachedBonds("out"),m=i.getRingSize();return"undefined"!=typeof j&&"undefined"!=typeof k?(c=b.multVectByScalar(b.norm(j[0].vector),l),d=b.multVectByScalar(b.norm(k[0].vector),l),f=180*Math.acos(b.dotProduct(b.norm(c),b.norm(d)))/Math.PI,h=b.rotVectCCW(c,(180-f)/2),g=b.compareVectors(h,d,5)?b.rotVectCW(c,(180-f)/2):h):"undefined"!=typeof j?(c=b.multVectByScalar(b.norm(j[0].vector),l),g=m>0?angular.copy(c):b.rotVectCCW(c,a.ANGLE/2)):"undefined"!=typeof k?(d=b.multVectByScalar(b.norm(k[0].vector),l),g=b.rotVectCCW(d,a.ANGLE)):g=a.BOND_S,b.checkAttachedBonds(g,e,a.FREQ,a.MAX_BONDS)}function s(){var c,d,f,i,k,m=e.getAttachedBonds("in"),n=e.getAttachedBonds("out");return j?b.subtractVectors(h,g):("undefined"!=typeof m&&"undefined"!=typeof n?(d=b.multVectByScalar(b.norm(m[0].vector),l),f=b.multVectByScalar(b.norm(n[0].vector),l),i=180*Math.acos(b.dotProduct(b.norm(d),b.norm(f)))/Math.PI,k=b.rotVectCCW(d,(180-i)/2)):k="undefined"!=typeof m?b.multVectByScalar(b.norm(m[0].vector),l):"undefined"!=typeof n?b.multVectByScalar(b.norm(n[0].vector),l):a.BOND_S,c=b.calcPossibleVectors(k,a.FREQ),b.getClosestVector(g,h,c))}var t;t=b.insideCircle(g,h,n)?r():s(),m(t),q(t)},k.addArrowOnEmptySpace=function(a,c,d,e){var f,g;return null===a?(a=new r,a.setOrigin(d),f=angular.copy(e.getArrow(d,c)),f.setOrigin([0,0])):(f=angular.copy(e.getArrow(d,c)),g=b.subtractVectors(d,a.getOrigin()),f.setOrigin(g)),a.addToStructures(f),a},k.makeSelection=function(a,c,d){var e,f;return null===a?(a=new r,a.setOrigin(d),e=new s([0,0],c)):(f=b.subtractVectors(d,a.getOrigin()),e=new s(f,c)),a.select(e),a.addToStructures(e),a},k.modifyBond=function(a,c,d){function e(a){var b=[],d=[];b=o.getAttachedBonds("in",o.getCoords()),b.forEach(function(b){b.multiplicity=a}),d=c.getAttachedBonds("out",o.getCoords()),d.forEach(function(b){b.multiplicity=a})}var f,g,h,i,j,k=d.getRingSize(),l=-1,m=[{name:"single",mult:1},{name:"double",mult:2},{name:"triple",mult:3}],n=["double","double-left","double-right"],o=a.getAtom(),p=a.getType();return k>0?void 0:(f=d.getDefault().getStructure(0).getBonds(0).getType(),"single"===f?(m.forEach(function(a,b){a.name===p&&(l=b)}),h=0>l?0:b.moveToRight(m,l,1),g=m[h],f=g.name,e(g.mult)):"double"===f?(l=n.indexOf(p),h=0>l?0:b.moveToRight(n,l,1),f=n[h],e(2)):"triple"===f?e(3):"undefined"===f?e(1):("wedge"===f||"dash"===f)&&(i=p.indexOf("inverted")>=0,j=p!==f,f=i||j?f:f+"-inverted",e(1)),f===p?!1:(a.setType(f),!0))},k.addStructureOnEmptySpace=function(c,d,e,f,g){var h,i,j;return null===c?(c=angular.copy(f.getStructure(e,d)),c.setOrigin(e),g&&c.getStructure(0).getBonds(0).getAtom().setCoords(b.subtractVectors(d,e)),c.isAromatic()&&(i=a.getBondByDirection(c.getName()).bond,c.addDecorate("aromatic",{fromWhich:[0,0],coords:b.addVectors(e,i)}))):(h=b.subtractVectors(e,c.getOrigin()),j=new o(h),c.addToStructures(j),k.modifyAtom(c,j,j,e,d,f,g)),c},k}angular.module("mmAngularDrawChem").factory("DrawChemModStructure",a),a.$inject=["DrawChemConst","DrawChemUtils","DrawChemStructures","DCAtom","DCBond","DCArrow","DCSelection","DCSvg","DCLabel","DCStructure"]}(),function(){"use strict";function a(a,b){var c={},d=a.BOND_LENGTH,e=a.BETWEEN_DBL_BONDS,f=a.BETWEEN_TRP_BONDS,g=a.ARROW_START,h=a.ARROW_SIZE,i=a.UNDEF_BOND,j=a.PUSH,k=a.DBL_BOND_CORR;return c.calcArrow=function(a,c,d){var f,i,j,k,l,m,n,o,p=[c[0]-a[0],c[1]-a[1]],q=[-p[1],p[0]],r=[p[1],-p[0]];return"one-way-arrow"===d?(f=[a[0]+p[0]*g,a[1]+p[1]*g],l=b.addVectors(f,r,h),m=b.addVectors(f,q,h),["arrow","M",a,"L",c,"M",f,"L",l,"L",c,"L",m,"Z"]):"two-way-arrow"===d?(f=[a[0]+p[0]*g,a[1]+p[1]*g],i=[a[0]+p[0]*(1-g),a[1]+p[1]*(1-g)],l=b.addVectors(f,r,h),m=b.addVectors(f,q,h),n=b.addVectors(i,r,h),o=b.addVectors(i,q,h),["arrow","M",a,"L",c,"M",f,"L",l,"L",c,"L",m,"Z","M",i,"L",n,"L",a,"L",o,"Z"]):"equilibrium-arrow"===d?(j=b.addVectors(a,r,e),l=b.addVectors(c,r,e),f=[parseFloat(j[0])+p[0]*g,parseFloat(j[1])+p[1]*g],m=b.addVectors(f,r,h),k=b.addVectors(c,q,e),n=b.addVectors(a,q,e),i=[parseFloat(n[0])+p[0]*(1-g),parseFloat(n[1])+p[1]*(1-g)],o=b.addVectors(i,q,h),["arrow-eq","M",j,"L",l,"L",m,"M",k,"L",n,"L",o]):void 0},c.calcDoubleBondCoords=function(a,c,f,g,h){var i,l=b.subtractVectors(f,c),l=b.multVectByScalar(b.norm(l),d),m=b.multVectByScalar(l,j),n=b.getPerpVectorCCW(l),o=b.getPerpVectorCW(l),p=b.addVectors(c,n,e),q=b.addVectors(f,n,e),r=b.addVectors(c,o,e),s=b.addVectors(f,o,e);return"right"===a?(r=b.addVectors(c,o,2*e),s=b.addVectors(f,o,2*e)):"left"===a&&(r=b.addVectors(c,n,2*e),s=b.addVectors(f,n,2*e)),"middle"!==a&&(p=angular.copy(c),q=angular.copy(f),l=[s[0]-r[0],s[1]-r[1]],i=b.multVectByScalar(l,k),r=b.addVectors(r,i),s=b.subtractVectors(s,i)),g&&("middle"!==a?(p=b.addVectors(p,m),r=b.addVectors(r,b.multVectByScalar(i,1.5))):b.doWithManyVectors("add",[p,r],m)),h&&("middle"!==a?(q=b.subtractVectors(q,m),s=b.subtractVectors(s,b.multVectByScalar(i,1.5))):b.doWithManyVectors("subtract",[q,s],m)),["M",p,"L",q,"M",r,"L",s]},c.calcTripleBondCoords=function(a,c,e,g){var h=b.subtractVectors(c,a),h=b.multVectByScalar(b.norm(h),d),i=b.multVectByScalar(h,j),k=b.getPerpVectorCCW(h),l=b.getPerpVectorCW(h),m=b.addVectors(a,k,f),n=b.addVectors(c,k,f),o=b.addVectors(a,l,f),p=b.addVectors(c,l,f);return e&&b.doWithManyVectors("add",[m,o,a],i),g&&b.doWithManyVectors("subtract",[n,p,c],i),["M",m,"L",n,"M",a,"L",c,"M",o,"L",p]},c.calcWedgeBondCoords=function(a,c,f,g,h){var i=b.subtractVectors(c,a),i=b.multVectByScalar(b.norm(i),d),k=b.multVectByScalar(i,j),l=b.getPerpVectorCCW(i),m=b.getPerpVectorCW(i),n=b.addVectors(c,l,e),o=b.addVectors(a,l,e),p=b.addVectors(c,m,e),q=b.addVectors(a,m,e);return f&&(a=b.addVectors(a,k),o=b.addVectors(a,l,e),q=b.addVectors(a,m,e)),g&&(c=b.subtractVectors(c,k),n=b.addVectors(c,l,e),p=b.addVectors(c,m,e)),"inverted"===h?["wedge","M",o,"L",q,"L",c,"Z"]:["wedge","M",a,"L",n,"L",p,"Z"]},c.calcDashBondCoords=function(a,c,f,g,h){var i,k,l,m,n,o,p,q=b.subtractVectors(c,a),r=b.multVectByScalar(b.norm(q),d),s=10*b.getLength(q)/d,t=s,u=e/t,v=e,w=a,x=b.getPerpVectorCCW(r),y=b.getPerpVectorCW(r),z=b.multVectByScalar(r,j);for(f&&(w=b.addVectors(a,z),q=b.subtractVectors(q,z),t-=.2*s),g&&(q=b.subtractVectors(q,z),t-=.2*s),o=["M",b.addVectors(w,x,u),"L",b.addVectors(w,y,u)],p=["M",b.addVectors(w,x,v),"L",b.addVectors(w,y,v)],t=parseFloat(t.toFixed(0)),i=t;i>0;i-=1)u+=e/t,v-=e/t,w=b.addVectors(w,q,1/t),k=b.addVectors(w,x,u),l=b.addVectors(w,x,v),m=b.addVectors(w,y,u),n=b.addVectors(w,y,v),o=o.concat(["M",k,"L",m]),p=p.concat(["M",l,"L",n]);return"inverted"===h?p:o},c.calcUndefinedBondCoords=function(a,c,e,f){var g,h,k,l,m,n,o,p=b.subtractVectors(c,a),q=b.multVectByScalar(b.norm(p),d),r=b.getPerpVectorCCW(q),s=b.getPerpVectorCW(q),t=b.multVectByScalar(q,j);for(k=10*b.getLength(p)/d,k=parseFloat(k.toFixed(0)),k%2!==0&&(k+=1),l=k,m=b.addVectors(a,p,1/l),n=b.addVectors(a,s,i),o=b.addVectors(m,s,i),e&&(a=b.addVectors(a,t),p=b.subtractVectors(p,t),l-=.2*k,l%2!==0&&(l+=1),m=b.addVectors(a,p,1/l),n=b.addVectors(a,s,i),o=b.addVectors(m,s,i)),f&&(p=b.subtractVectors(p,t),l-=.2*k,l%2!==0&&(l+=1),m=b.addVectors(a,p,1/l),n=b.addVectors(a,s,i),o=b.addVectors(m,s,i)),h=["M",a,"C",n,",",o,",",m],l=parseFloat(l.toFixed(0)),g=l-1;g>0;g-=1)m=b.addVectors(m,p,1/l),o=g%2===0?b.addVectors(m,s,i):b.addVectors(m,r,i),h=h.concat(["S",o,",",m]);return h},c.calcRect=function(a,c){var d,e,f,g,h=b.getQuadrant(a,c);return 1===h?(d=a[0],e=c[1],f=c[0]-d,g=a[1]-e):2===h?(d=c[0],e=c[1],f=a[0]-d,g=a[1]-e):3===h?(d=c[0],e=a[1],f=a[0]-d,g=c[1]-e):4===h&&(d=a[0],e=a[1],f=c[0]-d,g=c[1]-e),0>f&&(f=0),0>g&&(g=0),{"class":"selection",rect:[d,e,f,g]}},c}angular.module("mmAngularDrawChem").factory("DrawChemSvgBonds",a),a.$inject=["DrawChemConst","DrawChemUtils"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j){var k={},l=(f.BETWEEN_DBL_BONDS,f.BETWEEN_TRP_BONDS,f.BOND_LENGTH),m=(f.ARROW_START,f.ARROW_SIZE,f.UNDEF_BOND,f.PUSH),n=(f.DBL_BOND_CORR,c.Atom),o=d.Arrow,p=e.Selection,q=a.Svg;return k.draw=function(a,b){function c(){var b={full:"",mini:""};return h.generateRects(v,b),h.generatePaths(s,b),h.generateBondFocus(w,b),h.generateCircles(t,b),h.generateLabels(u,b),a.isAromatic()&&h.generateAromatics(a,b),b}function d(a){function b(a,b,e,f){var g,i,j,k;for(g=0;g<b.length;g+=1)j=b[g].getAtom(),k=b[g].getType(),i=[a[0]+j.getCoords("x"),a[1]+j.getCoords("y")],d(i),h.updateBondFocus(C,a,i,f,"undefined"!=typeof j.getLabel()),h.updateLabel(A,i,j),z.push({isSelected:j.isSelected(),hasLabel:j.hasLabel(),isOrphan:j.isOrphan(),circle:[i[0],i[1],F]}),0===g?c(a,i,k,j,"continue",f):c(a,i,k,j,"begin",f)}function c(c,d,e,f,h,k){var n,o=y.length,p=g.subtractVectors(d,c),q=g.multVectByScalar(g.norm(p),l),r=g.addVectors(c,g.multVectByScalar(q,m)),s="undefined"!=typeof f.getLabel(),t=g.subtractVectors(d,g.multVectByScalar(q,m));f.isOrphan()&&(n=j.isWithinAtom(a,d).foundAtom,s="undefined"!=typeof n.getLabel()),"single"===e?"continue"===h?(k&&(y[o-1].push("M"),y[o-1].push(r)),y[o-1].push("L"),s?y[o-1].push(t):y[o-1].push(d)):"begin"===h&&(o=k&&s?y.push(["M",r,"L",t]):k?y.push(["M",r,"L",d]):s?y.push(["M",c,"L",t]):y.push(["M",c,"L",d])):"double"===e?(y.push(i.calcDoubleBondCoords("middle",c,d,k,s)),o=y.push(["M",d])):"double-right"===e?(y.push(i.calcDoubleBondCoords("right",c,d,k,s)),o=y.push(["M",d])):"double-left"===e?(y.push(i.calcDoubleBondCoords("left",c,d,k,s)),o=y.push(["M",d])):"triple"===e?(y.push(i.calcTripleBondCoords(c,d,k,s)),o=y.push(["M",d])):"wedge"===e?(y.push(i.calcWedgeBondCoords(c,d,k,s)),o=y.push(["M",d])):"wedge-inverted"===e?(y.push(i.calcWedgeBondCoords(c,d,k,s,"inverted")),o=y.push(["M",d])):"dash"===e?(y.push(i.calcDashBondCoords(c,d,k,s)),o=y.push(["M",d])):"dash-inverted"===e?(y.push(i.calcDashBondCoords(c,d,k,s,"inverted")),o=y.push(["M",d])):"undefined"===e&&(y.push(i.calcUndefinedBondCoords(c,d,k,s)),o=y.push(["M",d])),b(d,f.getBonds(),y[o-1],s)}function d(a){a[0]>E.maxX&&(E.maxX=a[0]),a[0]<E.minX&&(E.minX=a[0]),a[1]>E.maxY&&(E.maxY=a[1]),a[1]<E.minY&&(E.minY=a[1])}var e,k,q,r,s,t,u,v,w,x,y=[],z=[],A=[],B=[],C=[],D=a.getOrigin(),E={minX:D[0],maxX:D[0],minY:D[1],maxY:D[1]},F=f.CIRC_R;for(e=0;e<a.getStructure().length;e+=1)w=a.getStructure(e),w instanceof p?(t=w,q=g.addVectors(D,t.getOrigin()),r=t.getCurrent(),B.push(i.calcRect(q,r))):w instanceof n?(u=w,k=g.addVectors(D,u.getCoords()),h.updateLabel(A,k,u),d(k),x="undefined"!=typeof u.getLabel(),s=y.push(["M",k]),z.push({isSelected:u.isSelected(),hasLabel:u.hasLabel(),isOrphan:u.isOrphan(),circle:[k[0],k[1],F]}),b(k,u.getBonds(),y[s-1],x)):w instanceof o&&(v=w,q=g.addVectors(D,v.getOrigin()),r=g.addVectors(D,v.getEnd()),d(q),d(r),z.push({isSelected:v.isSelected(),circle:[q[0],q[1],F]}),z.push({isSelected:v.isSelected(),circle:[r[0],r[1],F]}),y.push(i.calcArrow(q,r,v.getType())));return{paths:h.stringifyPaths(y),rects:B,circles:z,labels:A,bondFocus:C,minMax:E}}var e=q.generateStyle("base"),k=q.generateStyle("expanded"),r=d(a),s=r.paths,t=r.circles,u=r.labels,v=r.rects,w=r.bondFocus,x=r.minMax,y=new q(k+c().full,e+c().mini,b);return y.setMinMax(x),y},k}angular.module("mmAngularDrawChem").factory("DrawChemSvgRenderer",a),a.$inject=["DCSvg","DCBond","DCAtom","DCArrow","DCSelection","DrawChemConst","DrawChemUtils","DrawChemSvgUtils","DrawChemSvgBonds","DrawChemModStructure"]}(),function(){"use strict";function a(a,b,c){var d={},e=(a.BONDS,a.BOND_FOCUS),f=a.BOND_LENGTH,g=a.AROMATIC_R;return d.generateRects=function(a,b){a.forEach(function(a){var c="<rect class='"+a["class"]+"' x='"+a.rect[0].toFixed(2)+"' y='"+a.rect[1].toFixed(2)+"' width='"+a.rect[2].toFixed(2)+"' height='"+a.rect[3].toFixed(2)+"'></rect>";b.full+=c,b.mini+=c})},d.generateBondFocus=function(a,b){a.forEach(function(a){b.full+="<rect class='focus' x='"+a.start[0].toFixed(2)+"' y='"+a.start[1].toFixed(2)+"' rx='"+(.1*f).toFixed(2)+"' ry='"+(.1*f).toFixed(2)+"' width='"+a.width.toFixed(2)+"' height='"+a.height.toFixed(2)+"' transform='rotate("+a.rotate.toFixed(2)+", "+a.start[0].toFixed(2)+", "+a.start[1].toFixed(2)+")'></rect>"})},d.generatePaths=function(a,b){a.forEach(function(a){var c;c="undefined"!=typeof a["class"]?"<path class='"+a["class"]+"' d='"+a.line+"'></path>":"<path d='"+a.line+"'></path>",b.full+=c,b.mini+=c})},d.generateCircles=function(a,b){a.forEach(function(a){var c;c=a.hasLabel?"label":a.isSelected?"edit":"atom",a.isOrphan||(b.full+="<circle class='"+c+"' cx='"+a.circle[0].toFixed(2)+"' cy='"+a.circle[1].toFixed(2)+"' r='"+a.circle[2].toFixed(2)+"'></circle>")})},d.generateLabels=function(a,d){function e(a,b){return"<text class='"+a+"' dy='0.2125em' x='"+b.labelX.toFixed(2)+"' y='"+b.labelY.toFixed(2)+"' atomx='"+b.atomX.toFixed(2)+"' atomy='"+b.atomY.toFixed(2)+"' text-anchor='"+f(b.mode)+"' >"+g(b.label)+"</text>"}function f(a){return"rl"===a?"end":"start"}function g(a){var d,e,f=!1,g="";for(d=0;d<a.length;d+=1)e=a.substr(d,1),b.isNumeric(e)?(g+="<tspan class='sub' dy='"+.25*c.fontSize+"' >"+e+"</tspan>",f=!0):f?(g+="<tspan dy='-"+.25*c.fontSize+"' >"+e+"</tspan>",f=!1):g+="<tspan>"+e+"</tspan>";return g}a.forEach(function(a){d.full+=e("edit",a),d.mini+=e("tr",a)})},d.generateAromatics=function(a,b){function c(a,b){return"<circle class='"+b+"' cx='"+a.coords[0].toFixed(2)+"' cy='"+a.coords[1].toFixed(2)+"' r='"+g.toFixed(2)+"' ></circle>"}var d=a.getDecorate("aromatic");d.forEach(function(a){b.full+=c(a,"arom"),b.mini+=c(a,"tr-arom")})},d.stringifyPaths=function(a){function b(a){return"M"!==a&&"L"!==a&&"C"!==a&&"S"!==a&&"Z"!==a&&","!==a}var c,d,e,f,g,h=[];for(c=0;c<a.length;c+=1){for(e=a[c],g={line:""},d=0;d<e.length;d+=1)f=e[d],"string"==typeof f?b(f)?g["class"]=f:g.line+=f+" ":"number"==typeof f[0]&&(g.line+=f[0].toFixed(2)+" "+f[1].toFixed(2)+" ");h.push(g)}return h},d.updateBondFocus=function(a,c,d,g,h){var i=b.subtractVectors(d,c),j=b.multVectByScalar(b.norm(i),f),k=b.getPerpVectorCW(j);a.push({start:b.addVectors(c,k,e),rotate:-b.calcAngle(j),height:b.getLength(b.multVectByScalar(j,2*e)),width:b.getLength(i)})},d.updateLabel=function(a,d,e){function g(){function a(a){var b,c=0;if("undefined"==typeof a)return 0;for(b=0;b<a.length;b+=1)c+=a[b].multiplicity;return c}function e(a,b){return"rl"===a?"I"===b?.07:.2:"lr"===a?"I"===b?-.07:-.2:void 0}function g(){return.09}function h(){function a(){"rl"===e?m.name=1===f?"H"+m.name:"H"+f+m.name:"lr"===e&&(m.name=1===f?m.name+"H":m.name+"H"+f)}function c(){"rl"===e&&(m.name=b.invertGroup(m.name))}var d,e=i.getMode(),f=0;for(d=0;l>d;d+=1)f+=1;m.hydrogens=f,m.mode=e,f>0?a():c()}var l=i.getMaxBonds()-a(j)-a(k),m={name:i.getLabelName()};return h(),{length:m.name.length,label:m.name,mode:m.mode,atomX:d[0],atomY:d[1],labelX:d[0]+e(m.mode,m.name)*f,labelY:d[1]+g()*f,width:c.fontSize*m.name.length,height:c.fontSize}}var h,i=e.getLabel(),j=e.getAttachedBonds("in"),k=e.getAttachedBonds("out");"undefined"!=typeof i&&(h=g(),a.push(h))},d}angular.module("mmAngularDrawChem").factory("DrawChemSvgUtils",a),a.$inject=["DrawChemConst","DrawChemUtils","DCSvg"]}();