!function(){"use strict";angular.module("mmAngularDrawChem",["ngSanitize","ui.bootstrap"]).config(["$sanitizeProvider",function(a){a.enableSvg()}])}(),function(){"use strict";function a(a){function b(a,b){this.name=a,this.defs=b}var c={};return b.prototype.getDefault=function(){var a;for(a=0;a<this.defs.length;a+=1)if("E"===this.defs[a].getDirection())return this.defs[a]},b.prototype.getArrow=function(b,c){var d,e=a.getDirection(b,c);for(d=0;d<this.defs.length;d+=1)if(this.defs[d].getDirection()===e)return this.defs[d]},c.ArrowCluster=b,c}angular.module("mmAngularDrawChem").factory("DCArrowCluster",a),a.$inject=["DrawChemShapes"]}(),function(){"use strict";function a(){function a(a,b,c){this.type=a,this.selected=!1,this.direction=b,this.relativeEnd=c}var b={};return a.prototype.select=function(){this.selected=!0},a.prototype.deselect=function(){this.selected=!1},a.prototype.getType=function(){return this.type},a.prototype.getRelativeEnd=function(){return this.relativeEnd},a.prototype.getEnd=function(a){return"x"===a?this.end[0]:"y"===a?this.end[1]:this.end},a.prototype.getDirection=function(){return this.direction},a.prototype.setOrigin=function(a){this.origin=a,"undefined"!=typeof this.relativeEnd&&(this.end=[a[0]+this.relativeEnd[0],a[1]+this.relativeEnd[1]])},a.prototype.getOrigin=function(a){return"x"===a?this.origin[0]:"y"===a?this.origin[1]:this.origin},b.Arrow=a,b}angular.module("mmAngularDrawChem").factory("DCArrow",a)}(),function(){"use strict";function a(a){function b(a,b,c,d){this.coords=a,this.bonds=b,this.info=c,this.attachedBonds=d||[],this.next="",this.selected=!1,this.label,this.calculateNext()}var c={};return b.prototype.select=function(){this.selected=!0},b.prototype.deselect=function(){this.selected=!1},b.getOppositeDirection=function(a){switch(a){case"N":return"S";case"NE1":return"SW1";case"NE2":return"SW2";case"E":return"W";case"SE1":return"NW1";case"SE2":return"NW2";case"S":return"N";case"SW1":return"NE1";case"SW2":return"NE2";case"W":return"E";case"NW1":return"SE1";case"NW2":return"SE2"}},b.prototype.attachBond=function(a){this.attachedBonds.push(a)},b.prototype.calculateNext=function(){function b(){var a=this.attachedBonds[0].direction;switch(a){case"N":return"SE1";case"NE1":return"SE2";case"NE2":return"S";case"E":return"SW1";case"SE1":return"SW2";case"SE2":return"W";case"S":return"NW1";case"SW1":return"NW2";case"SW2":return"N";case"W":return"NE1";case"NW1":return"NE2";case"NW2":return"E"}}function c(){function a(a,b){return this.attachedBonds[0].direction===a&&this.attachedBonds[1].direction===b||this.attachedBonds[0].direction===b&&this.attachedBonds[1].direction===a}return a.call(this,"N","SE1")?"SW2":a.call(this,"NE1","SE2")?"W":a.call(this,"NE2","S")?"NW1":a.call(this,"E","SW1")?"NW2":a.call(this,"SE1","SW2")?"N":a.call(this,"SE2","W")?"NE1":a.call(this,"S","NW1")?"NE2":a.call(this,"SW1","NW2")?"E":a.call(this,"SW2","N")?"SE1":a.call(this,"W","NE1")?"SE2":a.call(this,"NW1","NE2")?"S":a.call(this,"NW2","E")?"SW1":void d.call(this)}function d(){var b,c,d,e,f=a.BONDS;for(b=0;b<f.length;b+=1){for(d=f[b].direction,e="",c=0;c<this.attachedBonds.length;c+=1)this.attachedBonds[c].direction===d&&(e=d);if(""===e)return d}}1===this.attachedBonds.length?this.next=b.call(this):2===this.attachedBonds.length?this.next=c.call(this):this.attachedBonds.length>2&&this.attachedBonds.length<12?this.next=d.call(this):this.attachedBonds.length>=12?this.next="max":this.next=""},b.prototype.setCoords=function(a){this.coords=a},b.prototype.getInfo=function(){return this.info},b.prototype.getAttachedBonds=function(){return this.attachedBonds},b.prototype.setPreceding=function(a){this.preceding=a},b.prototype.getPreceding=function(a){return"x"===a?this.preceding[0]:"y"===a?this.preceding[1]:this.preceding},b.prototype.getNext=function(){return this.next},b.prototype.setLabel=function(a){this.label=a},b.prototype.getLabel=function(){return this.label},b.prototype.setNext=function(a){this.next=a},b.prototype.getCoords=function(a){return"x"===a?this.coords[0]:"y"===a?this.coords[1]:this.coords},b.prototype.getBonds=function(a){return 0===arguments.length?this.bonds:this.bonds[a]},b.prototype.setBonds=function(a){this.bonds=a},b.prototype.addBond=function(a){this.bonds.push(a)},b.prototype.addBonds=function(a){a.forEach(function(a){this.bonds.push(a)},this)},c.Atom=b,c}angular.module("mmAngularDrawChem").factory("DCAtom",a),a.$inject=["DrawChemConst"]}(),function(){"use strict";function a(){function a(a,b){this.type=a,this.atom=b}var b={};return a.prototype.setType=function(a){this.type=a},a.prototype.getType=function(){return this.type},a.prototype.setAtom=function(a){this.atom=a},a.prototype.getAtom=function(){return this.atom},b.Bond=a,b}angular.module("mmAngularDrawChem").factory("DCBond",a)}(),function(){"use strict";function a(){function a(a,b,c){this.labelName=a,this.bonds=b,this.mode=c}var b={};return a.prototype.getLabelName=function(){return this.labelName},a.prototype.setLabelName=function(a){this.labelName=a},a.prototype.getMaxBonds=function(){return this.bonds},a.prototype.setMaxBonds=function(a){this.bonds=a},a.prototype.getMode=function(){return this.mode},a.prototype.setMode=function(a){this.mode=a},b.Label=a,b}angular.module("mmAngularDrawChem").factory("DCLabel",a)}(),function(){"use strict";function a(){function a(a,b){this.origin=a,this.current=b,this.quarter=4}var b={};return a.prototype.getOrigin=function(a){return"x"===a?this.origin[0]:"y"===a?this.origin[1]:this.origin},a.prototype.setOrigin=function(a){this.origin=a},a.prototype.getCurrent=function(a){return"x"===a?this.current[0]:"y"===a?this.current[1]:this.current},a.prototype.setCurrent=function(a){this.current=a},a.prototype.getQuarter=function(){return this.quarter},a.prototype.setQuarter=function(a){this.quarter=a},b.Selection=a,b}angular.module("mmAngularDrawChem").factory("DCSelection",a)}(),function(){"use strict";function a(a){function b(b,d,e){this.elementFull=b,this.elementMini=d,this.id=e,this.scale=1,this.transformAttr="",this.style={expanded:{"circle.atom:hover":{opacity:"0.3",stroke:"black","stroke-width":a.BOND_WIDTH*this.scale},"text:hover":{opacity:"0.3"},"circle.atom":{opacity:"0"},"circle.edit":{stroke:"black",fill:"none"},"rect.selection":{stroke:"black","stroke-dasharray":"10 5",fill:"none"}},base:{path:{stroke:"black","stroke-width":a.BOND_WIDTH*this.scale,fill:"none"},"path.wedge":{fill:"black"},"path.arrow":{fill:"black"},"path.arrow-eq":{fill:"none"},"circle.arom":{stroke:"black","stroke-width":a.BOND_WIDTH*this.scale,fill:"none"},text:{"font-family":c.font,cursor:"default","font-size":c.fontSize+"px"},"tspan.sub":{"font-size":c.subFontSize+"px"},"polygon.text":{fill:"white"}}}}var c={};return c.fontSize=18,c.subFontSize=14,c.font="Arial",b.prototype.setMinMax=function(a){this.minMax=a},b.prototype.wrap=function(a,b,c){var d,e={};return"g"!==b||c||(c=e,c.id=this.id),c?(d="<"+b+" ",angular.forEach(c,function(a,b){d+=b+"='"+a+"' "}),"full"===a?this.elementFull=d+">"+this.elementFull+"</"+b+">":"mini"===a&&(this.elementMini=d+">"+this.elementMini+"</"+b+">")):"full"===a?this.elementFull="<"+b+">"+this.elementFull+"</"+b+">":"mini"===a&&(this.elementMini="<"+b+">"+this.elementMini+"</"+b+">"),this},b.prototype.generateStyle=function(a){var b='<style type="text/css">';return"expanded"===a?a={base:this.style.base,expanded:this.style.expanded}:"base"===a&&(a={base:this.style.base,expanded:{}}),angular.forEach(a,function(a,c){angular.forEach(a,function(a,c){b+=c+"{",angular.forEach(a,function(a,c){b+=c+":"+a+";"}),b+="}"})}),b+"</style>"},c.Shape=b,c}angular.module("mmAngularDrawChem").factory("DCShape",a),a.$inject=["DrawChemConst"]}(),function(){"use strict";function a(a){function b(a,b,c){this.name=a,this.defs=b,this.multiplicity=c,this.defaultStructure=b[0]}var c={};return b.prototype.getDefs=function(){return this.defs},b.prototype.getBondsMultiplicity=function(){return this.multiplicty},b.prototype.getDefault=function(){return this.defaultStructure},b.prototype.getStructure=function(b,c){var d,e=a.getDirection(b,c);for(d=0;d<this.defs.length;d+=1)if(this.defs[d].getName()===e)return this.defs[d]},c.StructureCluster=b,c}angular.module("mmAngularDrawChem").factory("DCStructureCluster",a),a.$inject=["DrawChemShapes"]}(),function(){"use strict";function a(a,b,c,d){function e(a,b,c){this.name=a||"",this.structure=b||[],this.origin=[],this.selectedAll=!1,this.decorate=c||{},this.aromatic=!1}function f(a,b){var c=e.prototype.findMinMax.call(this,a);return h.call(this,b,c.minY)&&h.call(this,b,c.maxY)&&i.call(this,b,c.minX)&&i.call(this,b,c.maxX)}function g(a,b){var c=e.prototype.findMinMax.call(this,a);return h.call(this,b,c.minY)&&h.call(this,b,c.maxY)&&i.call(this,b,c.minX)&&i.call(this,b,c.maxX)}function h(a,b){var c=d.addCoordsNoPrec(this.origin,a.getOrigin()),e=a.getCurrent(),f=a.getQuarter();return 1===f||2===f?b<=c[1]&&b>=e[1]:3===f||4===f?b>=c[1]&&b<=e[1]:void 0}function i(a,b){var c=d.addCoordsNoPrec(this.origin,a.getOrigin()),e=a.getCurrent(),f=a.getQuarter();return 1===f||4===f?b>=c[0]&&b<=e[0]:2===f||3===f?b<=c[0]&&b>=e[0]:void 0}function j(a,b){var c,d=!1;for(c=0;c<this.structure.length;c+=1){var e,f=this.structure[c];f.selected&&(f instanceof s?(e=o.call(this,f,a,b),d=d?!0:e):f instanceof t&&(e=p.call(this,f,a,b),d=d?!0:e))}return d}function k(a,b){("undefined"==typeof b.minY||a[1]<b.minY)&&(b.minY=a[1])}function l(a,b){("undefined"==typeof b.maxY||a[1]>b.maxY)&&(b.maxY=a[1])}function m(a,b){("undefined"==typeof b.maxX||a[0]>b.maxX)&&(b.maxX=a[0])}function n(a,b){("undefined"==typeof b.minX||a[0]<b.minX)&&(b.minX=a[0])}function o(a,b,c){var e,f=d.addCoordsNoPrec(this.origin,a.getOrigin()),g=d.addCoordsNoPrec(this.origin,a.getEnd()),h={minX:f[0],minY:f[1],maxX:f[0],maxY:f[1]};return"up"===b?(k(g,h),e=c-h.minY,q(a,[0,e])):"down"===b?(l(g,h),e=c-h.maxY,q(a,[0,e])):"left"===b?(n(g,h),e=c-h.minX,q(a,[e,0])):"right"===b&&(m(g,h),e=c-h.maxX,q(a,[e,0])),!d.compareFloats(e,0,5)}function p(a,b,c){function e(a,b){var c,f,g;for(k(a,r),c=0;c<b.getBonds().length;c+=1)g=b.getBonds(c).getAtom(),f=d.addCoordsNoPrec(a,g.getCoords()),e(f,g)}function f(a,b){var c,e,g;for(l(a,r),c=0;c<b.getBonds().length;c+=1)g=b.getBonds(c).getAtom(),e=d.addCoordsNoPrec(a,g.getCoords()),f(e,g)}function g(a,b){var c,e,f;for(m(a,r),c=0;c<b.getBonds().length;c+=1)f=b.getBonds(c).getAtom(),e=d.addCoordsNoPrec(a,f.getCoords()),g(e,f)}function h(a,b){var c,e,f;for(n(a,r),c=0;c<b.getBonds().length;c+=1)f=b.getBonds(c).getAtom(),e=d.addCoordsNoPrec(a,f.getCoords()),h(e,f)}function i(b){angular.forEach(this.decorate.aromatic,function(c){var e=d.compareFloats(c.fromWhich[0],a.getCoords("x"),3)&&d.compareFloats(c.fromWhich[1],a.getCoords("y"),3);e&&(c.fromWhich=d.addCoordsNoPrec(c.fromWhich,b),c.coords=d.addCoordsNoPrec(c.coords,b))})}var j,o=a.getCoords(),p=d.addCoordsNoPrec(this.origin,o),r={};return"up"===b?(e(p,a),j=c-r.minY,i.call(this,[0,j]),q(a,[0,j])):"down"===b?(f(p,a),j=c-r.maxY,i.call(this,[0,j]),q(a,[0,j])):"left"===b?(h(p,a),j=c-r.minX,i.call(this,[j,0]),q(a,[j,0])):"right"===b&&(g(p,a),j=c-r.maxX,i.call(this,[j,0]),q(a,[j,0])),!d.compareFloats(j,0,5)}function q(a,b){var c;a instanceof t?(c=a.getCoords(),a.setCoords([c[0]+b[0],c[1]+b[1]])):a instanceof s&&(c=a.getOrigin(),a.setOrigin([c[0]+b[0],c[1]+b[1]]))}var r={},s=a.Arrow,t=(c.Selection,b.Atom);return e.prototype.setAromatic=function(){this.aromatic=!0},e.prototype.isAromatic=function(){return this.aromatic},e.prototype.selectAll=function(){var a;for(this.selectedAll=!0,a=0;a<this.structure.length;a+=1)this.structure[a].select()},e.prototype.select=function(a){var b,c,d;for(b=0;b<this.structure.length;b+=1)c=this.structure[b],c instanceof s?(d=f.call(this,c,a),d&&c.select()):c instanceof t&&(d=g.call(this,c,a),d&&c.select())},e.prototype.deleteSelected=function(){var a,b,c,e,f,g,h=[];for(a=0;a<this.structure.length;a+=1)if(e=this.structure[a],e.selected){if(e instanceof t&&this.aromatic){for(c=[],b=0;b<this.decorate.aromatic.length;b+=1)g=this.decorate.aromatic[b],f=d.compareFloats(g.fromWhich[0],e.getCoords("x"),3)&&d.compareFloats(g.fromWhich[1],e.getCoords("y"),3),f||c.push(g);this.decorate.aromatic=c}}else h.push(e);this.structure=h},e.prototype.deselectAll=function(){var a;for(this.selectedAll=!1,a=0;a<this.structure.length;a+=1)this.structure[a].deselect()},e.prototype.alignUp=function(a){return j.call(this,"up",a)},e.prototype.alignDown=function(a){return j.call(this,"down",a)},e.prototype.alignRight=function(a){return j.call(this,"right",a)},e.prototype.alignLeft=function(a){return j.call(this,"left",a)},e.prototype.setOrigin=function(a){this.origin=a},e.prototype.getOrigin=function(a){return"x"===a?this.origin[0]:"y"===a?this.origin[1]:this.origin},e.prototype.setStructure=function(a){this.structure=a},e.prototype.addToStructures=function(a){this.structure.push(a)},e.prototype.getStructure=function(a){return 0===arguments.length?this.structure:this.structure[a]},e.prototype.getName=function(){return this.name},e.prototype.getDecorate=function(a){return this.decorate[a]},e.prototype.setDecorate=function(a,b){this.decorate[a]=b},e.prototype.findMinMax=function(a){function b(a){var b,f,g,h;a instanceof t?(b=a.getCoords(),f=d.addCoordsNoPrec(this.origin,b),c(f,a)):a instanceof s&&(g=d.addCoordsNoPrec(this.origin,a.getOrigin()),h=d.addCoordsNoPrec(this.origin,a.getEnd()),e(g),e(h))}function c(a,b){var e,f,h;for(k(a,g),n(a,g),l(a,g),m(a,g),e=0;e<b.getBonds().length;e+=1)h=b.getBonds(e).getAtom(),f=d.addCoordsNoPrec(a,h.getCoords()),c(f,h)}function e(a){k(a,g),n(a,g),l(a,g),m(a,g)}var f,g={};if("undefined"==typeof a)for(f=0;f<this.structure.length;f+=1)a=this.structure[f],a.selected&&b.call(this,a);else b.call(this,a);return g},e.prototype.addDecorate=function(a,b){"undefined"==typeof this.decorate[a]&&(this.decorate[a]=[]),this.decorate[a].push(b)},r.Structure=e,r}angular.module("mmAngularDrawChem").factory("DCStructure",a),a.$inject=["DCArrow","DCAtom","DCSelection","DrawChemUtils"]}(),function(){"use strict";function a(){var a={};return a.mouseFlags={downAtomCoords:void 0,downAtomObject:void 0,downMouseCoords:void 0,movedOnEmpty:!1,mouseDown:!1,downOnAtom:!1},a.customLabel="",a.selected="",a}angular.module("mmAngularDrawChem").factory("DrawChemDirectiveFlags",a),a.$inject=[]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h){function i(a,c,e){return b.modifyStructure(d.getCurrentStructure(),a.chosenStructure,c,o.downAtomCoords,e)}function j(a){var c,e,f,g,h;return b.isContentEmpty()?(c=new n,c.setOrigin(o.downMouseCoords),e=new m([0,0],a)):(c=angular.copy(d.getCurrentStructure()),f=b.subtractCoords(o.downMouseCoords,c.getOrigin()),e=new m(f,a)),g=a[0]-o.downMouseCoords[0],h=a[1]-o.downMouseCoords[1],g>0&&0>h&&e.setQuarter(1),0>g&&0>h&&e.setQuarter(2),0>g&&h>0&&e.setQuarter(3),c.select(e),c.addToStructures(e),c}var k={},l=f.Label,m=h.Selection,n=g.Structure,o=a.mouseFlags;return k.doOnMouseDown=function(e,f,g){function h(){var a=c.isWithin(d.getCurrentStructure(),o.downMouseCoords);o.downAtomCoords=a.absPos,o.downAtomObject=a.foundAtom,"undefined"!=typeof a.foundAtom&&(o.downOnAtom=!0)}var i;return 1!==e.which?void 0:(o.downMouseCoords=b.innerCoords(g,e),o.mouseDown=!0,void(b.isContentEmpty()||"label"!==a.selected&&"customLabel"!==a.selected&&"structure"!==a.selected||("tspan"===e.target.nodeName&&(i=angular.element(e.target).parent(),o.downMouseCoords=[i.attr("atomx"),i.attr("atomy")]),h())))},k.doOnMouseUp=function(f,g,h){function k(){return b.isContentEmpty()?void 0:b.deleteFromStructure(d.getCurrentStructure(),s)}function m(){var b=angular.copy(d.getCurrentStructure()),e=c.isWithin(b,o.downMouseCoords).foundAtom,f=e.getLabel();return"label"===a.selected?e.setLabel(angular.copy(g.chosenLabel)):"customLabel"===a.selected&&e.setLabel(new l(a.customLabel,0)),"undefined"!=typeof f&&("lr"===f.getMode()?e.getLabel().setMode("rl"):"rl"===f.getMode()&&e.getLabel().setMode("lr")),b}function p(){var a,c,e;return b.isContentEmpty()?(a=new n,o.movedOnEmpty?(a.setOrigin(o.downMouseCoords),c=angular.copy(g.chosenArrow.getArrow(s,o.downMouseCoords)),c.setOrigin([0,0])):(a.setOrigin(s),c=angular.copy(g.chosenArrow.getDefault()),e=b.subtractCoords(s,a.getOrigin()),c.setOrigin(e))):(a=angular.copy(d.getCurrentStructure()),c=o.movedOnEmpty?angular.copy(g.chosenArrow.getArrow(s,o.downMouseCoords)):angular.copy(g.chosenArrow.getDefault()),e=b.subtractCoords(o.downMouseCoords,a.getOrigin()),c.setOrigin(e)),a.addToStructures(c),a}function q(){var a,c,f,h;return b.isContentEmpty()?o.movedOnEmpty?(a=angular.copy(g.chosenStructure.getStructure(s,o.downMouseCoords)),a.setOrigin(o.downMouseCoords),a.isAromatic()&&(h=e.getBondByDirection(a.getName()).bond,a.addDecorate("aromatic",{fromWhich:[0,0],coords:[o.downMouseCoords[0]+h[0],o.downMouseCoords[1]+h[1]]}))):(a=angular.copy(g.chosenStructure.getDefault()),a.setOrigin(s),a.isAromatic()&&(h=e.getBondByDirection(a.getName()).bond,a.addDecorate("aromatic",{fromWhich:[0,0],coords:[s[0]+h[0],s[1]+h[1]]}))):(a=angular.copy(d.getCurrentStructure()),f=b.subtractCoords(o.downMouseCoords,a.getOrigin()),o.movedOnEmpty?(c=angular.copy(g.chosenStructure.getStructure(s,o.downMouseCoords)),c.isAromatic()&&(h=e.getBondByDirection(c.getName()).bond,a.addDecorate("aromatic",{fromWhich:angular.copy(f),coords:[o.downMouseCoords[0]+h[0],o.downMouseCoords[1]+h[1]]}))):(c=angular.copy(g.chosenStructure.getDefault()),c.isAromatic()&&(h=e.getBondByDirection(c.getName()).bond,a.addDecorate("aromatic",{fromWhich:angular.copy(f),coords:[s[0]+h[0],s[1]+h[1]]}))),c.getStructure(0).setCoords(f),a.addToStructures(c.getStructure(0))),a}var r,s=b.innerCoords(h,f);return 1!==f.which||""===a.selected?void b.resetMouseFlags():("delete"===a.selected?r=k():"select"===a.selected?(r=j(s),r.getStructure().pop()):r="arrow"===a.selected?p():!o.downOnAtom||"label"!==a.selected&&"customLabel"!==a.selected?o.downOnAtom&&"structure"===a.selected?i(g,s,!1):q():m(),"undefined"!=typeof r&&(d.addStructure(r),b.drawStructure(r)),void b.resetMouseFlags())},k.doOnMouseMove=function(c,f,g){function h(){var a,c,e;return b.isContentEmpty()?(a=new n,a.setOrigin(o.downMouseCoords),c=angular.copy(f.chosenArrow.getArrow(m,o.downMouseCoords)),c.setOrigin([0,0])):(a=angular.copy(d.getCurrentStructure()),c=angular.copy(f.chosenArrow.getArrow(m,o.downMouseCoords)),e=b.subtractCoords(o.downMouseCoords,a.getOrigin()),c.setOrigin(e)),a.addToStructures(c),o.movedOnEmpty=!0,a}function k(){var a,c,g,h;return b.isContentEmpty()?(a=angular.copy(f.chosenStructure.getStructure(m,o.downMouseCoords)),a.setOrigin(o.downMouseCoords),a.isAromatic()&&(h=e.getBondByDirection(a.getName()).bond,a.addDecorate("aromatic",{fromWhich:angular.copy(g),coords:[o.downMouseCoords[0]+h[0],o.downMouseCoords[1]+h[1]]}))):(a=angular.copy(d.getCurrentStructure()),g=b.subtractCoords(o.downMouseCoords,a.getOrigin()),c=angular.copy(f.chosenStructure.getStructure(m,o.downMouseCoords)),c.isAromatic()&&(h=e.getBondByDirection(c.getName()).bond,a.addDecorate("aromatic",{fromWhich:angular.copy(g),coords:[o.downMouseCoords[0]+h[0],o.downMouseCoords[1]+h[1]]})),c.getStructure(0).setCoords(g),a.addToStructures(c.getStructure(0))),o.movedOnEmpty=!0,a}var l,m=b.innerCoords(g,c);return o.mouseDown&&"label"!==a.selected&&"labelCustom"!==a.selected&&""!==a.selected?("select"===a.selected?l=j(m):"arrow"===a.selected?l=h():o.downOnAtom?l=i(f,m,!0):"structure"===a.selected&&(l=k()),void("undefined"!=typeof l&&b.drawStructure(l))):void 0},k}angular.module("mmAngularDrawChem").factory("DrawChemDirectiveMouseActions",a),a.$inject=["DrawChemDirectiveFlags","DrawChemDirectiveUtils","DrawChemShapes","DrawChemCache","DrawChemConst","DCLabel","DCStructure","DCSelection"]}(),function(){"use strict";function a(a,b,c){var d={};return d.drawStructure=function(c){var d="";return d=a.draw(c,"cmpd1"),b.setCurrentSvg(d.wrap("full","g").wrap("full","svg").elementFull),d},d.resetMouseFlags=function(){angular.forEach(c.mouseFlags,function(a,b){"boolean"==typeof a?c.mouseFlags[b]=!1:c.mouseFlags[b]=void 0})},d.subtractCoords=function(a,b){return[a[0]-b[0],a[1]-b[1]]},d.isContentEmpty=function(){return null===b.getCurrentStructure()},d.innerCoords=function(a,b){var c=a.find("dc-content")[0],d=[parseFloat((b.clientX-c.getBoundingClientRect().left-2).toFixed(2)),parseFloat((b.clientY-c.getBoundingClientRect().top-2).toFixed(2))];return d},d.modifyStructure=function(b,c,d,e,f){return a.modifyStructure(angular.copy(b),angular.copy(c),d,e,f)},d.deleteFromStructure=function(b,c){return a.deleteFromStructure(angular.copy(b),c)},d}angular.module("mmAngularDrawChem").factory("DrawChemDirectiveUtils",a),a.$inject=["DrawChemShapes","DrawChemCache","DrawChemDirectiveFlags"]}(),function(){"use strict";function a(a,b,c,d,e,f){return{template:'<div ng-include="getEditorUrl()"></div>',scope:{showEditor:"="},link:function(c,g,h){c.getEditorUrl=function(){var b=""===h.dcModal?"draw-chem-editor-modal.html":"draw-chem-editor.html";return a.getPath()+b},c.pathToSvg=a.getPathToSvg(),c.dialogStyle={},h.width&&(c.dialogStyle.width=h.width),h.height&&(c.dialogStyle.height=h.height),c.content=function(){var a=f.trustAsHtml(b.getCurrentSvg());return a},e.addButtonsToScope(c),c.doOnMouseDown=function(a){try{d.doOnMouseDown(a,c,g)}catch(b){console.log(b)}},c.doOnMouseUp=function(a){try{d.doOnMouseUp(a,c,g)}catch(b){console.log(b)}},c.doOnMouseMove=function(a){try{d.doOnMouseMove(a,c,g)}catch(b){console.log(b)}}}}}angular.module("mmAngularDrawChem").directive("drawChemEditor",a),a.$inject=["DrawChemPaths","DrawChemCache","DrawChemDirectiveUtils","DrawChemDirectiveMouseActions","DrawChemMenuButtons","$sce"]}(),function(){"use strict";function a(){var a={},b=[{structure:null,svg:""}],c=0;return a.addStructure=function(d){c<b.length-1&&(b=b.slice(0,c+1)),b.push({structure:d,svg:""}),b.length>10&&b.shift(),a.moveRightInStructures()},a.getCurrentPosition=function(){return c},a.getStructureLength=function(){return b.length},a.getCurrentStructure=function(){return b[c].structure},a.getCurrentSvg=function(){return b[c].svg},a.setCurrentSvg=function(a){b[c].svg=a},a.moveLeftInStructures=function(){c>0&&(c-=1)},a.moveRightInStructures=function(){c<b.length-1&&(c+=1)},a}angular.module("mmAngularDrawChem").factory("DrawChemCache",a)}(),function(){"use strict";function a(){function a(){var a,c,d,e;b.BOND_LENGTH=b.SET_BOND_LENGTH||20,a=parseFloat((b.BOND_LENGTH*Math.sqrt(3)/2).toFixed(2)),c=parseFloat((b.BOND_LENGTH*Math.sin(Math.PI/12)).toFixed(2)),d=parseFloat((b.BOND_LENGTH*Math.cos(Math.PI/12)).toFixed(2)),e=parseFloat((b.BOND_LENGTH*Math.sin(Math.PI/4)).toFixed(2)),b.WIDTH_TO_LENGTH=.04,b.AROMATIC_R=.45*b.BOND_LENGTH,b.BETWEEN_DBL_BONDS=.065,b.BETWEEN_TRP_BONDS=.1,b.ARROW_SIZE=.065,b.ARROW_START=.85,b.BOND_WIDTH=(b.BOND_LENGTH*b.WIDTH_TO_LENGTH).toFixed(2),b.CIRC_R=.12*b.BOND_LENGTH,b.BOND_N=[0,-b.BOND_LENGTH],b.BOND_N_NE1=[c,-d],b.BOND_NE1=[b.BOND_LENGTH/2,-a],b.BOND_NE1_NE2=[e,-e],b.BOND_NE2=[a,-b.BOND_LENGTH/2],b.BOND_NE2_E=[d,-c],b.BOND_E=[b.BOND_LENGTH,0],b.BOND_E_SE1=[d,c],b.BOND_SE1=[a,b.BOND_LENGTH/2],b.BOND_SE1_SE2=[e,e],b.BOND_SE2=[b.BOND_LENGTH/2,a],b.BOND_SE2_S=[c,d],b.BOND_S=[0,b.BOND_LENGTH],b.BOND_S_SW1=[-c,d],b.BOND_SW1=[-b.BOND_LENGTH/2,a],b.BOND_SW1_SW2=[-e,e],b.BOND_SW2=[-a,b.BOND_LENGTH/2],b.BOND_SW2_W=[-d,c],b.BOND_W=[-b.BOND_LENGTH,0],b.BOND_W_NW1=[-d,-c],b.BOND_NW1=[-a,-b.BOND_LENGTH/2],b.BOND_NW1_NW2=[-e,-e],b.BOND_NW2=[-b.BOND_LENGTH/2,-a],b.BOND_NW2_N=[-c,-d],b.BONDS=[{direction:"N",bond:b.BOND_N},{direction:"NE1",bond:b.BOND_NE1},{direction:"NE2",bond:b.BOND_NE2},{direction:"E",bond:b.BOND_E},{direction:"SE1",bond:b.BOND_SE1},{direction:"SE2",bond:b.BOND_SE2},{direction:"S",bond:b.BOND_S},{direction:"SW1",bond:b.BOND_SW1},{direction:"SW2",bond:b.BOND_SW2},{direction:"W",bond:b.BOND_W},{direction:"NW1",bond:b.BOND_NW1},{direction:"NW2",bond:b.BOND_NW2}],b.BONDS_AUX=[{direction:"N_NE1",bond:b.BOND_N_NE1},{direction:"NE1_NE2",bond:b.BOND_NE1_NE2},{direction:"NE2_E",bond:b.BOND_NE2_E},{direction:"E_SE1",bond:b.BOND_E_SE1},{direction:"SE1_SE2",bond:b.BOND_SE1_SE2},{direction:"SE2_S",bond:b.BOND_SE2_S},{direction:"S_SW1",bond:b.BOND_S_SW1},{direction:"SW1_SW2",bond:b.BOND_SW1_SW2},{direction:"SW2_W",bond:b.BOND_SW2_W},{direction:"W_NW1",bond:b.BOND_W_NW1},{direction:"NW1_NW2",bond:b.BOND_NW1_NW2},{direction:"NW2_N",bond:b.BOND_NW2_N}],b.getBondByDirection=function(a){var c;for(c=0;c<b.BONDS.length;c+=1)if(b.BONDS[c].direction===a)return b.BONDS[c]}}var b={};return b.SET_BOND_LENGTH,b.setBondLength=function(c){b.SET_BOND_LENGTH=c,a()},a(),b}angular.module("mmAngularDrawChem").factory("DrawChemConst",a)}(),function(){"use strict";function a(){var a={};return a.addCoords=function(a,b,c){return"undefined"==typeof c?[(a[0]+b[0]).toFixed(2),(a[1]+b[1]).toFixed(2)]:[(a[0]+c*b[0]).toFixed(2),(a[1]+c*b[1]).toFixed(2)]},a.addCoordsNoPrec=function(a,b,c){return"undefined"==typeof c?[a[0]+b[0],a[1]+b[1]]:[a[0]+c*b[0],a[1]+c*b[1]]},a.isNumeric=function(a){return a-parseFloat(a)>=0},a.isSmallLetter=function(a){return a>="a"&&"z">=a},a.compareFloats=function(a,b,c){return a.toFixed(c)===b.toFixed(c)},a.invertGroup=function(a){var b,c=a.match(/[A-Z][a-z\d]*/g),d="";if(null===c)return a;for(b=c.length-1;b>=0;b-=1)d+=c[b];return d},a.subtractCoords=function(a,b){return[a[0]-b[0],a[1]-b[1]]},a}angular.module("mmAngularDrawChem").factory("DrawChemUtils",a),a.$inject=[]}(),function(){"use strict";function a(a,b,c){return{restrict:"A",link:function(d,e){e.bind("keydown",function(c){a.showEditor()&&(c.preventDefault(),b.down(c.keyCode))}),e.bind("keyup",function(d){a.showEditor()&&(d.preventDefault(),b.released(d.keyCode),c.$digest())})}}}angular.module("mmAngularDrawChem").directive("dcShortcuts",a),a.$inject=["DrawChem","DrawChemKeyShortcuts","$rootScope"]}(),function(){"use strict";function a(a,b){function c(a,b){var c,d=a.split(" + "),e={cb:b,keys:{}};for(c=0;c<d.length;c+=1)e.keys[d[c]]=!1;g[a]=e}function d(a,b){var c=f[a];"undefined"!=typeof c&&angular.forEach(g,function(a,d){"undefined"!=typeof a.keys[c]&&(a.keys[c]=b)})}function e(a){function b(a){var b="undefined"!=typeof a;return angular.forEach(a,function(a,c){a||(b=!1)}),b}angular.forEach(g,function(a,c){b(a.keys)&&a.cb()})}var f={16:"shift",17:"ctrl",46:"del",65:"a",68:"d",69:"e",70:"f",81:"q",82:"r",83:"s",84:"t",87:"w",90:"z"},g={},h={};return angular.forEach(a.actions,function(a){"undefined"!=typeof a.shortcut&&c(a.shortcut,a.action)}),angular.forEach(b.edits,function(a){"undefined"!=typeof a.shortcut&&c(a.shortcut,a.action)}),h.down=function(a){d(a,!0)},h.released=function(a){e(),d(a,!1)},h}angular.module("mmAngularDrawChem").factory("DrawChemKeyShortcuts",a),a.$inject=["DrawChemActions","DrawChemEdits"]}(),function(){"use strict";function a(a,b,c,d){var e={};return e.forward=function(){a.moveRightInStructures(),null===a.getCurrentStructure()?b.clearContent():d.drawStructure(a.getCurrentStructure())},e.close=function(){b.closeEditor()},e.clear=function(){a.addStructure(null),a.setCurrentSvg("")},e.undo=function(){a.moveLeftInStructures(),null===a.getCurrentStructure()?b.clearContent():d.drawStructure(a.getCurrentStructure())},e.transfer=function(){var d,e,f=a.getCurrentStructure(),g="";null!==f&&(d=c.draw(f,"cmpd1"),e={viewBox:(d.minMax.minX-20).toFixed(2)+" "+(d.minMax.minY-20).toFixed(2)+" "+(d.minMax.maxX-d.minMax.minX+40).toFixed(2)+" "+(d.minMax.maxY-d.minMax.minY+40).toFixed(2),height:"100%",width:"100%",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},g=d.wrap("mini","g").wrap("mini","svg",e).elementMini),b.setContent(g),b.setStructure(f),b.transferContent()},e.actions={undo:{shortcut:"ctrl + z",id:"undo",action:e.undo},forward:{shortcut:"ctrl + f",id:"forward",action:e.forward},transfer:{shortcut:"ctrl + t",id:"transfer",action:e.transfer},clear:{shortcut:"ctrl + e",id:"clear",action:e.clear},close:{shortcut:"ctrl + q",id:"close",action:e.close}},e}angular.module("mmAngularDrawChem").factory("DrawChemActions",a),a.$inject=["DrawChemCache","DrawChem","DrawChemShapes","DrawChemDirectiveUtils"]}(),function(){"use strict";function a(a,b,c,d){function e(b){function c(){var a=f(b),c=new j(b,a);return c}return function(b){b.chosenArrow=c(),a.selected="arrow"}}function f(a){var b,c,d,e=[];for(b=0;b<h.length;b+=1)c=h[b].direction,d=h[b].bond,e.push(new i(a,c,d));return e}var g={},h=b.BONDS,i=c.Arrow,j=d.ArrowCluster;return g.arrows={"one way arrow":{action:e("one-way-arrow"),id:"one-way-arrow",thumbnail:!0},"two way arrow":{action:e("two-way-arrow"),id:"two-way-arrow",thumbnail:!0},"equilibrium arrow":{action:e("equilibrium-arrow"),id:"equilibrium-arrow",thumbnail:!0}},g}angular.module("mmAngularDrawChem").factory("DrawChemArrows",a),a.$inject=["DrawChemDirectiveFlags","DrawChemConst","DCArrow","DCArrowCluster"]}(),function(){"use strict";function a(a,b,c){var d={};return d.deleteFromStructure=function(){c.selected="delete"},d.deleteSelected=function(){var c=angular.copy(a.getCurrentStructure());null!==c&&(c.deleteSelected(),a.addStructure(c),b.drawStructure(c))},d.select=function(){d.deselectAll(),c.selected="select"},d.selectAll=function(){var c=angular.copy(a.getCurrentStructure());null!==c&&(c.selectAll(),a.addStructure(c),b.drawStructure(c))},d.deselectAll=function(){var c=angular.copy(a.getCurrentStructure());null!==c&&(c.deselectAll(),a.addStructure(c),b.drawStructure(c))},d.alignUp=function(){var c,d=angular.copy(a.getCurrentStructure()),e=!1;null!==d&&(c=d.findMinMax(),e=d.alignUp(c.minY),e&&(a.addStructure(d),b.drawStructure(d)))},d.alignDown=function(){var c,d=angular.copy(a.getCurrentStructure()),e=!1;null!==d&&(c=d.findMinMax(),e=d.alignDown(c.maxY),e&&(a.addStructure(d),b.drawStructure(d)))},d.alignRight=function(){var c,d=angular.copy(a.getCurrentStructure()),e=!1;null!==d&&(c=d.findMinMax(),e=d.alignRight(c.maxX),e&&(a.addStructure(d),b.drawStructure(d)))},d.alignLeft=function(){var c,d=angular.copy(a.getCurrentStructure()),e=!1;null!==d&&(c=d.findMinMax(),e=d.alignLeft(c.minX),e&&(a.addStructure(d),b.drawStructure(d)))},d.edits={select:{action:d.select,id:"select",shortcut:"shift + s"},"select all":{action:d.selectAll,id:"select-all",shortcut:"shift + a"},"deselect all":{action:d.deselectAll,id:"deselect-all",shortcut:"shift + d"},"align up":{action:d.alignUp,id:"align-up",shortcut:"shift + q"},"align down":{action:d.alignDown,id:"align-down",shortcut:"shift + w"},"align right":{action:d.alignRight,id:"align-right",shortcut:"shift + r"},"align left":{action:d.alignLeft,id:"align-left",shortcut:"shift + e"},"delete selected":{action:d.deleteSelected,id:"delete-selected",shortcut:"del"},"delete":{action:d.deleteFromStructure,id:"delete"}},d}angular.module("mmAngularDrawChem").factory("DrawChemEdits",a),a.$inject=["DrawChemCache","DrawChemDirectiveUtils","DrawChemDirectiveFlags"]}(),function(){"use strict";function a(){var a={};return a.todo=function(){},a.shapes={dummy:{action:a.todo}},a}angular.module("mmAngularDrawChem").factory("DrawChemGeomShapes",a),a.$inject=[]}(),function(){"use strict";function a(a,b){function c(a,c){return function(d){d.chosenLabel=new e(a,c),b.selected="label"}}var d={},e=a.Label;return d.labels={oxygen:{action:c("O",2),id:"oxygen"},sulfur:{action:c("S",2),id:"sulfur"},phosphorus:{action:c("P",3),id:"phosphorus"},nitrogen:{action:c("N",3),id:"nitrogen"},carbon:{action:c("C",4),id:"carbon"},fluorine:{action:c("F",1),id:"fluorine"},chlorine:{action:c("Cl",1),id:"chlorine"},bromine:{action:c("Br",1),id:"bromine"},iodine:{action:c("I",1),id:"iodine"},hydrogen:{action:c("H",1),id:"hydrogen"}},d}angular.module("mmAngularDrawChem").factory("DrawChemLabels",a),a.$inject=["DCLabel","DrawChemDirectiveFlags"]}(),function(){"use strict";function a(a,b,c,d,e,f,g){var h={};return h.addButtonsToScope=function(h){var i={Actions:{actions:c.actions},Edit:{actions:d.edits},Arrows:{actions:e.arrows},Shapes:{actions:f.shapes},Structures:{actions:a.structures},Labels:{actions:b.labels}};h.menu={},angular.forEach(i,function(a,b){h.menu[b]={actions:a.actions,scope:h}}),h.chooseCustomLabel=function(a){
g.customLabel=a,g.selected="customLabel"}},h}angular.module("mmAngularDrawChem").factory("DrawChemMenuButtons",a),a.$inject=["DrawChemStructures","DrawChemLabels","DrawChemActions","DrawChemEdits","DrawChemArrows","DrawChemGeomShapes","DrawChemDirectiveFlags"]}(),function(){"use strict";function a(a,b,c,d,e,f){function g(a){return function(b){b.chosenStructure=a(),f.selected="structure"}}function h(a){function b(b){function c(a,b,e){var f,g=d(b.nextDirection);return 1===e?a.addBond(new l("single",new k(b.nextBond,[],"",[g.current[0]]))):(f=new k(b.nextBond,[],"",g.current),a.addBond(new l("single",f)),void c(f,g,e-1))}function d(a){function b(a,b,c){return 0>b-c?b-c+a.length:b-c}function c(a,b,c){return b+c>a.length-1?b+c-a.length:b+c}var d,e,f,g;for(d=0;d<o.length;d+=1)if(o[d].direction===a){e=b(o,d,4),f=c(o,d,4),g=c(o,d,2);break}return{current:[{direction:o[e].direction,type:"single"},{direction:o[f].direction,type:"single"}],nextBond:o[f].bond,nextDirection:o[g].direction}}var e,f,g=d(b),h=k.getOppositeDirection(b);return e=new k([0,0],[],"",g.current),c(e,g,6),f=new m(h,[e]),"aromatic"===a&&f.setAromatic(),f}var c,d,e=[];for(c=0;c<o.length;c+=1)d=o[c].direction,e.push(b(d));return e}function i(a,b){var c,d,e,f=[];for(c=0;c<o.length;c+=1)d=o[c].bond,e=o[c].direction,f.push(new m(e,[new k([0,0],[new l(a,new k(d,[],"",[{direction:k.getOppositeDirection(e),type:b}]))],"")]));return f}var j={},k=d.Atom,l=e.Bond,m=b.Structure,n=c.StructureCluster,o=a.BONDS;return j.benzene=function(){var a,b="triple",c="benzene",d=h("aromatic");return a=new n(c,d,b)},j.cyclohexane=function(){var a,b="double",c="cyclohexane",d=h();return a=new n(c,d,b)},j.singleBond=function(){var a,b="single",c="single-bond",d=i("single",b);return a=new n(c,d,b)},j.doubleBond=function(){var a,b="double",c="double-bond",d=i("double",b);return a=new n(c,d,b)},j.tripleBond=function(){var a,b="triple",c="triple-bond",d=i("triple",b);return a=new n(c,d,b)},j.wedgeBond=function(){var a,b="single",c="wedge-bond",d=i("wedge",b);return a=new n(c,d,b)},j.dashBond=function(){var a,b="single",c="dash-bond",d=i("dash",b);return a=new n(c,d,b)},j.structures={benzene:{action:g(j.benzene),id:"benzene",thumbnail:!0},cyclohexane:{action:g(j.cyclohexane),id:"cyclohexane",thumbnail:!0},"single bond":{action:g(j.singleBond),id:"single-bond",thumbnail:!0},"wedge bond":{action:g(j.wedgeBond),id:"wedge-bond",thumbnail:!0},"dash bond":{action:g(j.dashBond),id:"dash-bond",thumbnail:!0},"double bond":{action:g(j.doubleBond),id:"double-bond",thumbnail:!0},"triple bond":{action:g(j.tripleBond),id:"triple-bond",thumbnail:!0}},j}angular.module("mmAngularDrawChem").factory("DrawChemStructures",a),a.$inject=["DrawChemConst","DCStructure","DCStructureCluster","DCAtom","DCBond","DrawChemDirectiveFlags"]}(),function(){"use strict";function a(){var a="",b=a+"svg";return{setPath:function(b){a=b},setPathSvg:function(a){b=a},$get:function(){return{getPath:function(){return a},getPathToSvg:function(){return b}}}}}angular.module("mmAngularDrawChem").provider("DrawChemPaths",a)}(),function(){"use strict";function a(){function a(a){for(var b=0;b<g.length;b++)if(g[b].name===a)return!0;return!1}function b(a){for(var b=0;b<g.length;b++)if(g[b].name===a)return g[b]}function c(a,b){var c;for(c=0;c<g.length;c++)if(g[c].name===b)return g[c].content=a;g.push({name:b,content:a})}function d(a,b){var c;for(c=0;c<g.length;c++)if(g[c].name===b)return g[c].structure=a;g.push({name:b,structure:a})}var e={},f=!1,g=[],h={};return e.showEditor=function(){return f},e.runEditor=function(c){var d;f=!0,a(c)||g.push({name:c,content:"",structure:null}),d=b(c),h.name=d.name,h.content=d.content,h.structure=d.structure},e.getContent=function(a){if("string"==typeof a){var c=b(a);return"undefined"==typeof c?"":c.content}return h.content},e.getInstance=function(a){return"undefined"==typeof a?h:b(a)},e.setContent=function(a,b){"undefined"==typeof b?h.content=a:c(a,b)},e.setStructure=function(a,b){"undefined"==typeof b?h.structure=a:d(a,b)},e.transferContent=function(){c(h.content,h.name),d(h.structure,h.name)},e.closeEditor=function(){f=!1,h={}},e.clearContent=function(a){"string"==typeof a?c("",a):h.content=""},e.beautifySvg=function(a){var b,c=e.getContent(a),d="<!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'>\n";return b=c.match(/<svg.*?>|<g.*?>|<style.*?<\/style>|<path.*?><\/path>|<circle.*?><\/circle>|<polygon.*?><\/polygon>|<text.*?<\/text>|<\/g>|<\/svg>|/g),b.forEach(function(a){d+=a+"\n"}),d},e}angular.module("mmAngularDrawChem").factory("DrawChem",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g){function h(a,c,d){var d=d||b.CIRC_R;return Math.abs(a[0]-c[0])<d&&Math.abs(a[1]-c[1])<d}function i(a){var b,c,d,e,f,g=[];for(b=0;b<a.length;b+=1){for(d=a[b],f={line:""},c=0;c<d.length;c+=1)e=d[c],"string"==typeof e?"arrow"===e||"arrow-eq"===e||"wedge"===e?f["class"]=e:f.line+=e+" ":f.line+=e[0]+" "+e[1]+" ";g.push(f)}return g}var j={},k=b.ARROW_START,l=b.ARROW_SIZE,m=b.BOND_LENGTH,n=b.BONDS_AUX,o=b.BETWEEN_DBL_BONDS,p=b.BETWEEN_TRP_BONDS,q=d.Atom,r=f.Arrow,s=e.Bond,t=g.Selection;return j.modifyStructure=function(a,c,d,e,f){function g(s,t){function u(c,d){var e;return null!==c&&c.isAromatic()&&"undefined"!=typeof n?(e=b.getBondByDirection(c.getName()).bond,a.addDecorate("aromatic",{fromWhich:n.getCoords(),coords:[e[0]+d[0],e[1]+d[1]]})):void 0}function v(a,b,c){null!==b&&(w(b,c),a.addBonds(b.getStructure(0).getBonds()))}function w(b,d){var e,f,g,h,i=b.getStructure(0).getBonds();for(e=0;e<i.length;e+=1)if(f=[i[e].getAtom().getCoords("x")+d[0],i[e].getAtom().getCoords("y")+d[1]],g=j.isWithin(a,f).foundAtom,"undefined"!=typeof g)return h=q.getOppositeDirection(b.getName()),g.attachBond({direction:h,type:c.getBondsMultiplicity()}),g.calculateNext()}var x,y,z;for(x=0;x<s.length;x+=1)if(!(s[x]instanceof r)){if(z=s[x]instanceof q?s[x]:s[x].getAtom(),s[x]instanceof q&&(n=s[x]),y=[z.getCoords("x")+t[0],z.getCoords("y")+t[1]],p)break;if(o=h(y,d),o&&!f)return m=l(z),v(z,m,y),u(m,y),p=!0,a;if(!o&&i(e,y,5))return m=k(z),v(z,m,y),u(m,y),p=!0,a;g(z.getBonds(),y)}}function i(a,b,c){return"undefined"==typeof a||"undefined"==typeof b?!1:a[0].toFixed(c)===b[0].toFixed(c)&&a[1].toFixed(c)===b[1].toFixed(c)}function k(a){return l(a,j.getDirection(d,e))}function l(a,b){var d,e,f,g,h;if(1===c.defs.length)return c.getDefault().getStructure(0).getBonds();for(d=0;d<c.defs.length;d+=1){if(e=c.defs[d],h=a.getNext(),"max"===h)return null;if(f=e.getName(),g=b||h,g===f)return a.attachBond({direction:f,type:c.getBondsMultiplicity()}),a.calculateNext(),e}}var m,n,o,p=!1,s=a.getOrigin();return g(a.getStructure(),s),a},j.deleteFromStructure=function(a,d){function e(a,b,f){function g(a,b){var d,e,f,g;for(d=0;d<b.getBonds().length;d+=1)g=b.getBonds(d).getAtom(),f=[g.getCoords("x")+a[0],g.getCoords("y")+a[1]],e=c.subtractCoords(f,i),j.push({obj:g,coords:e})}var k,l,m,n,o,p=[];for(k=0;k<a.length;k+=1)m=a[k],m instanceof r?(n=[m.getOrigin("x")+b[0],m.getOrigin("y")+b[1]],o=[m.getEnd("x")+b[0],m.getEnd("y")+b[1]],h(n,d)||h(o,d)||j.push({obj:m,coords:m.getOrigin()})):m instanceof q?(l=[m.getCoords("x")+b[0],m.getCoords("y")+b[1]],h(l,d)?g(l,m):j.push({obj:m,coords:m.getCoords()}),e(m.getBonds(),l,m)):m instanceof s&&(l=[m.getAtom().getCoords("x")+b[0],m.getAtom().getCoords("y")+b[1]],h(l,d)?g(l,m.getAtom()):p.push(m),e(m.getAtom().getBonds(),l,m.getAtom()));"undefined"!=typeof f&&f.setBonds(p)}var f,g,i=a.getOrigin(),j=[],k=[];return e(a.getStructure(),i),angular.forEach(j,function(a){var b=a.obj;b instanceof r?b.setOrigin(a.coords):b instanceof q&&b.setCoords(a.coords),k.push(b)}),a.isAromatic()&&(f=a.getDecorate("aromatic"),g=[],angular.forEach(f,function(a){h(a.coords,d,b.AROMATIC_R)||g.push(a)}),a.setDecorate("aromatic",g)),a.setStructure(k),a},j.isWithin=function(a,b){function c(a,f){var g,i,j;for(g=0;g<a.length;g+=1)a[g]instanceof r||(j=a[g]instanceof q?a[g]:a[g].getAtom(),i=[j.getCoords("x")+f[0],j.getCoords("y")+f[1]],!d&&h(i,b)?(d=!0,e.foundAtom=j,e.absPos=i):c(j.getBonds(),i))}var d=!1,e={},f=a.getOrigin();return c(a.getStructure(),f),e},j.draw=function(d,e){function f(){function e(a){return"rl"===a?"end":"start"}function f(b){var d,e,f=!1,g="";for(d=0;d<b.length;d+=1)e=b.substr(d,1),c.isNumeric(e)?(g+="<tspan class='sub' dy='"+.25*a.fontSize+"' >"+e+"</tspan>",f=!0):f?(g+="<tspan dy='-"+.25*a.fontSize+"' >"+e+"</tspan>",f=!1):g+="<tspan>"+e+"</tspan>";return g}function g(a){var b,d,e,f,g=[];for(f=.5*a.height/m,b=0;b<n.length;b+=1)d=n[b].bond[0],e=n[b].bond[1],g=g.concat(c.addCoords([a.atomX,a.atomY],[d,e],f));return"<polygon class='text' points='"+i([g])[0].line+"'></polygon>"}var h="",j="",k="";return w.forEach(function(a){k="<rect class='"+a["class"]+"' x='"+a.rect[0]+"' y='"+a.rect[1]+"' width='"+a.rect[2]+"' height='"+a.rect[3]+"'></rect>",h+=k,j+=k}),s.forEach(function(a){k="undefined"!=typeof a["class"]?"<path class='"+a["class"]+"' d='"+a.line+"'></path>":"<path d='"+a.line+"'></path>",h+=k,j+=k}),u.forEach(function(a){var b=a.selected?"edit":"atom";h+="<circle class='"+b+"' cx='"+a.circle[0]+"' cy='"+a.circle[1]+"' r='"+a.circle[2]+"' ></circle>"}),v.forEach(function(a){k=g(a)+"<text dy='0.2125em' x='"+a.labelX+"' atomx='"+a.atomX+"' atomy='"+a.atomY+"' y='"+a.labelY+"' text-anchor='"+e(a.mode)+"' >"+f(a.label)+"</text>",h+=k,j+=k}),d.getDecorate("aromatic")&&d.getDecorate("aromatic").forEach(function(a){k="<circle class='arom' cx='"+a.coords[0]+"' cy='"+a.coords[1]+"' r='"+b.AROMATIC_R+"' ></circle>",h+=k,j+=k}),{full:h,mini:j}}function g(d){function e(a,b,d){var e,f,g,h,i,j,m,n,p=[b[0]-a[0],b[1]-a[1]],q=[-p[1],p[0]],r=[p[1],-p[0]];return"one-way-arrow"===d?(e=[a[0]+p[0]*k,a[1]+p[1]*k],i=c.addCoords(e,r,l),j=c.addCoords(e,q,l),["arrow","M",a,"L",b,"M",e,"L",i,"L",b,"L",j,"Z"]):"two-way-arrow"===d?(e=[a[0]+p[0]*k,a[1]+p[1]*k],f=[a[0]+p[0]*(1-k),a[1]+p[1]*(1-k)],i=c.addCoords(e,r,l),j=c.addCoords(e,q,l),m=c.addCoords(f,r,l),n=c.addCoords(f,q,l),["arrow","M",a,"L",b,"M",e,"L",i,"L",b,"L",j,"Z","M",f,"L",m,"L",a,"L",n,"Z"]):"equilibrium-arrow"===d?(g=c.addCoords(a,r,o),i=c.addCoords(b,r,o),e=[parseFloat(g[0])+p[0]*k,parseFloat(g[1])+p[1]*k],j=c.addCoords(e,r,l),h=c.addCoords(b,q,o),m=c.addCoords(a,q,o),f=[parseFloat(m[0])+p[0]*(1-k),parseFloat(m[1])+p[1]*(1-k)],n=c.addCoords(f,q,l),["arrow-eq","M",g,"L",i,"L",j,"M",h,"L",m,"L",n]):void 0}function f(a,b,c,d){var e,f,h,i;for(e=0;e<b.length;e+=1)h=b[e].getAtom(),i=b[e].getType(),f=[a[0]+h.getCoords("x"),a[1]+h.getCoords("y")],v(f),u(f,h),L.push({selected:d,circle:[f[0],f[1],Q]}),0===e?g(a,f,i,h,"continue",d):g(a,f,i,h,"begin",d)}function g(a,b,c,d,e,g){var i=K.length;"single"===c?"continue"===e?(K[i-1].push("L"),K[i-1].push(b)):"begin"===e&&(i=K.push(["M",a,"L",b])):"double"===c?(K.push(h(a,b)),i=K.push(["M",b])):"triple"===c?(K.push(j(a,b)),i=K.push(["M",b])):"wedge"===c?(K.push(n(a,b)),i=K.push(["M",b])):"dash"===c&&(K.push(s(a,b)),i=K.push(["M",b])),f(b,d.getBonds(),K[i-1],g)}function h(a,b){var d=[b[0]-a[0],b[1]-a[1]],e=[-d[1],d[0]],f=[d[1],-d[0]],g=c.addCoords(a,e,o),h=c.addCoords(b,e,o),i=c.addCoords(a,f,o),j=c.addCoords(b,f,o);return["M",g,"L",h,"M",i,"L",j]}function j(a,b){var d=[b[0]-a[0],b[1]-a[1]],e=[-d[1],d[0]],f=[d[1],-d[0]],g=c.addCoords(a,e,p),h=c.addCoords(b,e,p),i=c.addCoords(a,f,p),j=c.addCoords(b,f,p);return["M",g,"L",h,"M",a,"L",b,"M",i,"L",j]}function n(a,b){var d=[b[0]-a[0],b[1]-a[1]],e=[-d[1],d[0]],f=[d[1],-d[0]],g=c.addCoords(b,e,o),h=c.addCoords(b,f,o);return["wedge","M",a,"L",g,"L",h,"Z"]}function s(a,b){var d,e,f,g=7,h=o/g,i=a,j=[],k=[b[0]-a[0],b[1]-a[1]],l=[-k[1],k[0]],m=[k[1],-k[0]];for(d=g;d>0;d-=1)h+=o/g,i=[i[0]+k[0]/g,i[1]+k[1]/g],e=c.addCoords(i,l,h),f=c.addCoords(i,m,h),j=j.concat(["M",e,"L",f]);return j}function u(b,d){function e(){function e(a){var b,c,d=0;for(b=0;b<a.length;b+=1)switch(c=a[b].type){case"single":d+=1;break;case"double":d+=2;break;case"triple":d+=3}return d}function f(a){var b,c,d=0;for(b=0;b<a.length;b+=1)switch(c=a[b].getType()){case"single":d+=1;break;case"wedge":d+=1;break;case"dash":d+=1;break;case"double":d+=2;break;case"triple":d+=3}return d}function h(){function a(){"rl"===k?j.name=1===l?"H"+j.name:"H"+l+j.name:"lr"===k&&(j.name=1===l?j.name+"H":j.name+"H"+l)}function b(){"rl"===k&&(j.name=c.invertGroup(j.name))}function e(){var a=0;return d.getAttachedBonds().forEach(function(b){a=b.direction.indexOf("E")<0?a:a+1}),a>0?"rl":"lr"}function f(){return"rl"===k?.175:"lr"===k?-.175:void 0}var h,k=g.getMode(),l=0;for(h=0;i>h;h+=1)l+=1;j.hydrogens=l,"undefined"==typeof k&&(k=e(),g.setMode(k)),l>0?a():b(),j.correctX=f()*m}var i=g.getMaxBonds()-e(d.getAttachedBonds())-f(d.getBonds()),j={name:g.getLabelName()};return h(),{length:j.name.length,label:j.name,mode:g.getMode(),atomX:b[0],atomY:b[1],labelX:b[0]+j.correctX,labelY:b[1]+.09*m,width:a.fontSize*j.name.length,height:a.fontSize}}var f,g=d.getLabel();"undefined"!=typeof g&&(f=e(),M.push(f))}function v(a){a[0]>P.maxX&&(P.maxX=a[0]),a[0]<P.minX&&(P.minX=a[0]),a[1]>P.maxY&&(P.maxY=a[1]),a[1]<P.minY&&(P.minY=a[1])}var w,x,y,z,A,B,C,D,E,F,G,H,I,J,K=[],L=[],M=[],N=[],O=d.getOrigin(),P={minX:O[0],maxX:O[0],minY:O[1],maxY:O[1]},Q=b.CIRC_R;for(w=0;w<d.getStructure().length;w+=1)E=d.getStructure(w),E instanceof t?(B=E,y=c.addCoordsNoPrec(O,B.getOrigin()),z=B.getCurrent(),H=B.getQuarter(),1===H?(I=y[0],J=z[1],F=z[0]-I,G=y[1]-J):2===H?(I=z[0],J=z[1],F=y[0]-I,G=y[1]-J):3===H?(I=z[0],J=y[1],F=y[0]-I,G=z[1]-J):4===H&&(I=y[0],J=y[1],F=z[0]-I,G=z[1]-J),N.push({"class":"selection",rect:[I,J,F,G]})):E instanceof q?(C=E,x=c.addCoordsNoPrec(O,C.getCoords()),u(x,C),v(x),A=K.push(["M",x]),L.push({selected:C.selected,circle:[x[0],x[1],Q]}),f(x,C.getBonds(),K[A-1],C.selected)):E instanceof r&&(D=E,y=c.addCoordsNoPrec(O,D.getOrigin()),z=c.addCoordsNoPrec(O,D.getEnd()),v(y),v(z),D.selected&&(L.push({selected:!0,circle:[y[0],y[1],Q]}),L.push({selected:!0,circle:[z[0],z[1],Q]})),K.push(e(y,z,D.getType())));return{paths:i(K),rects:N,circles:L,labels:M,minMax:P}}var h,j=g(d),s=j.paths,u=j.circles,v=j.labels,w=j.rects,x=j.minMax;return h=new a.Shape(f().full,f().mini,e),h.elementFull=h.generateStyle("expanded")+h.elementFull,h.elementMini=h.generateStyle("base")+h.elementMini,h.setMinMax(x),h},j.getDirection=function(a,b){function c(c,d,e,f){return a[0]>=b[0]+c&&a[0]<=b[0]+d&&a[1]>=b[1]+e&&a[1]<=b[1]+f}var d=Math.PI/6,e=Math.sqrt(Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2)),f=Math.sin(d/2)*e,g=Math.cos(3*d/2)*e,h=Math.cos(d/2)*e,i=Math.sin(3*d/2)*e;return c(-f,f,-e,-h)?"N":c(f,g,-h,-i)?"NE1":c(g,h,-i,-f)?"NE2":c(h,e,-f,f)?"E":c(g,h,f,i)?"SE1":c(f,g,i,h)?"SE2":c(-f,f,h,e)?"S":c(-g,-f,i,h)?"SW1":c(-h,-g,f,i)?"SW2":c(-e,-h,-f,f)?"W":c(-h,-g,-i,-f)?"NW1":c(-g,-f,-h,-i)?"NW2":void 0},j}angular.module("mmAngularDrawChem").factory("DrawChemShapes",a),a.$inject=["DCShape","DrawChemConst","DrawChemUtils","DCAtom","DCBond","DCArrow","DCSelection"]}();