!function(){"use strict";angular.module("mmAngularDrawChem",["ngSanitize","ui.bootstrap"]).config(["$sanitizeProvider",function(a){a.enableSvg()}])}(),function(){"use strict";function a(a,b,c){function d(a,b){this.name=a,this.defs=b}var e={},f=c.Arrow;return d.prototype.getDefault=function(){var c;for(c=0;c<this.defs.length;c+=1)if(a.compareVectors(this.defs[c].getRelativeEnd(),b.BOND_E,5))return this.defs[c]},d.prototype.getArrow=function(b,c){var d,e,g=[];for(e=0;e<this.defs.length;e+=1)g.push(this.defs[e].getRelativeEnd());return d=a.getClosestVector(b,c,g),new f(this.name,d)},e.ArrowCluster=d,e}angular.module("mmAngularDrawChem").factory("DCArrowCluster",a),a.$inject=["DrawChemUtils","DrawChemConst","DCArrow"]}(),function(){"use strict";function a(){function a(a,b){this.type=a,this.relativeEnd=b}var b={};return a.prototype.isSelected=function(){return!!this.selected},a.prototype.select=function(){this.selected=!0},a.prototype.deselect=function(){this.selected=!1},a.prototype.getType=function(){return this.type},a.prototype.getRelativeEnd=function(){return this.relativeEnd},a.prototype.getEnd=function(a){return"x"===a?this.end[0]:"y"===a?this.end[1]:this.end},a.prototype.setOrigin=function(a){this.origin=a,"undefined"!=typeof this.relativeEnd&&(this.end=[a[0]+this.relativeEnd[0],a[1]+this.relativeEnd[1]])},a.prototype.getOrigin=function(a){return"x"===a?this.origin[0]:"y"===a?this.origin[1]:this.origin},a.prototype.updateEnd=function(){"undefined"!=typeof this.relativeEnd&&(this.end=[this.origin[0]+this.relativeEnd[0],this.origin[1]+this.relativeEnd[1]])},b.Arrow=a,b}angular.module("mmAngularDrawChem").factory("DCArrow",a)}(),function(){"use strict";function a(a,b){function c(a,b,c){this.coords=a,this.bonds=b,this.attachedBonds=c||{},this.label}var d={};return c.prototype.isSelected=function(){return!!this.selected},c.prototype.select=function(){this.selected=!0},c.prototype.setAsOrphan=function(){this.orphan=!0},c.prototype.isOrphan=function(){return!!this.orphan},c.prototype.deselect=function(){this.selected=!1},c.getOppositeDirection=function(c){var d=a.DIRECTIONS,e=d.indexOf(c),f=b.moveToRight(d,e,d.length/2);return d[f]},c.prototype.attachBond=function(a,b){"undefined"==typeof this.attachedBonds[a]&&(this.attachedBonds[a]=[]),this.attachedBonds[a].push(b)},c.prototype.setCoords=function(a){this.coords=a},c.prototype.getCoords=function(a){return"x"===a?this.coords[0]:"y"===a?this.coords[1]:this.coords},c.prototype.getAttachedBonds=function(a){return"undefined"==typeof a?this.attachedBonds:this.attachedBonds[a]},c.prototype.setLabel=function(a){this.label=a},c.prototype.getLabel=function(){return this.label},c.prototype.getBonds=function(a){return"undefined"==typeof a?this.bonds:this.bonds[a]},c.prototype.setBonds=function(a){this.bonds=a},c.prototype.addBond=function(a){this.bonds.push(a)},c.prototype.addBonds=function(a){a.forEach(function(a){this.bonds.push(a)},this)},d.Atom=c,d}angular.module("mmAngularDrawChem").factory("DCAtom",a),a.$inject=["DrawChemConst","DrawChemUtils"]}(),function(){"use strict";function a(){function a(a,b){this.name=a,this.multiplicity=b}var b={};return a.prototype.getName=function(){return this.name},a.prototype.getMultiplicity=function(){return this.multiplicity},b.BondStructure=a,b}angular.module("mmAngularDrawChem").factory("DCBondStructure",a)}(),function(){"use strict";function a(){function a(a,b){this.type=a,this.atom=b}var b={};return a.prototype.setType=function(a){this.type=a},a.prototype.getType=function(){return this.type},a.prototype.setAtom=function(a){this.atom=a},a.prototype.getAtom=function(){return this.atom},b.Bond=a,b}angular.module("mmAngularDrawChem").factory("DCBond",a)}(),function(){"use strict";function a(){function a(a,b,c,d){this.name=a,this.ringSize=b,this.angle=c,this.aromatic=d}var b={};return a.prototype.getName=function(){return this.name},a.prototype.getRingSize=function(){return this.ringSize},a.prototype.getAngle=function(){return this.angle},a.prototype.isAromatic=function(){return!!this.aromatic},b.CyclicStructure=a,b}angular.module("mmAngularDrawChem").factory("DCCyclicStructure",a)}(),function(){"use strict";function a(){function a(a,b,c){this.labelName=a,this.bonds=b,this.mode=c}var b={};return a.prototype.getLabelName=function(){return this.labelName},a.prototype.setLabelName=function(a){this.labelName=a},a.prototype.getMaxBonds=function(){return this.bonds},a.prototype.setMaxBonds=function(a){this.bonds=a},a.prototype.getMode=function(){return this.mode},a.prototype.setMode=function(a){this.mode=a},b.Label=a,b}angular.module("mmAngularDrawChem").factory("DCLabel",a)}(),function(){"use strict";function a(){function a(a,b){this.origin=a,this.current=b}var b={};return a.prototype.getOrigin=function(a){return"x"===a?this.origin[0]:"y"===a?this.origin[1]:this.origin},a.prototype.setOrigin=function(a){this.origin=a},a.prototype.getCurrent=function(a){return"x"===a?this.current[0]:"y"===a?this.current[1]:this.current},a.prototype.setCurrent=function(a){this.current=a},b.Selection=a,b}angular.module("mmAngularDrawChem").factory("DCSelection",a)}(),function(){"use strict";function a(a,b){function c(a,b,c,d,e){this.name=a,this.defs=b,this.ringSize=c,this.angle=d,this.multiplicity=e,this.defaultStructure=b[0]}var d={};return c.prototype.getDefs=function(){return this.defs},c.prototype.getName=function(){return this.name},c.prototype.getRingSize=function(){return this.ringSize},c.prototype.getMult=function(){return this.multiplicity},c.prototype.getAngle=function(){return this.angle},c.prototype.getDefault=function(){return this.defaultStructure},c.prototype.getStructure=function(c,d){var e,f,g,h=[];for(e=0;e<b.BONDS.length;e+=1)h.push(b.BONDS[e].bond);for(f=a.getClosestVector(c,d,h),e=0;e<this.defs.length;e+=1)if(g=b.getBondByDirection(this.defs[e].getName()).bond,a.compareVectors(g,f,5))return this.defs[e]},d.StructureCluster=c,d}angular.module("mmAngularDrawChem").factory("DCStructureCluster",a),a.$inject=["DrawChemUtils","DrawChemConst"]}(),function(){"use strict";function a(a,b,c,d){function e(a,b,c){this.name=a||"",this.structure=b||[],this.origin=[],this.selectedAll=!1,this.decorate=c||{},this.aromatic=!1}function f(a,b){var c=e.prototype.findMinMax.call(this,a);return h.call(this,b,c.minY)&&h.call(this,b,c.maxY)&&i.call(this,b,c.minX)&&i.call(this,b,c.maxX)}function g(a,b){var c=e.prototype.findMinMax.call(this,a);return h.call(this,b,c.minY)&&h.call(this,b,c.maxY)&&i.call(this,b,c.minX)&&i.call(this,b,c.maxX)}function h(a,b){var c=d.addVectors(this.origin,a.getOrigin()),e=a.getCurrent(),f=d.getQuadrant(c,e);return 1===f||2===f?b<=c[1]&&b>=e[1]:3===f||4===f?b>=c[1]&&b<=e[1]:void 0}function i(a,b){var c=d.addVectors(this.origin,a.getOrigin()),e=a.getCurrent(),f=d.getQuadrant(c,e);return 1===f||4===f?b>=c[0]&&b<=e[0]:2===f||3===f?b<=c[0]&&b>=e[0]:void 0}function j(a,b){var c,d=!1;for(c=0;c<this.structure.length;c+=1){var e,f=this.structure[c];f.selected&&(f instanceof t?(e=o.call(this,f,a,b),d=d?!0:e):f instanceof u&&(e=p.call(this,f,a,b),d=d?!0:e))}return d}function k(a,b){("undefined"==typeof b.minY||a[1]<b.minY)&&(b.minY=a[1])}function l(a,b){("undefined"==typeof b.maxY||a[1]>b.maxY)&&(b.maxY=a[1])}function m(a,b){("undefined"==typeof b.maxX||a[0]>b.maxX)&&(b.maxX=a[0])}function n(a,b){("undefined"==typeof b.minX||a[0]<b.minX)&&(b.minX=a[0])}function o(a,b,c){var e,f=d.addVectors(this.origin,a.getOrigin()),g=d.addVectors(this.origin,a.getEnd()),h={minX:f[0],minY:f[1],maxX:f[0],maxY:f[1]};return"up"===b?(k(g,h),e=c-h.minY,r(a,[0,e])):"down"===b?(l(g,h),e=c-h.maxY,r(a,[0,e])):"left"===b?(n(g,h),e=c-h.minX,r(a,[e,0])):"right"===b&&(m(g,h),e=c-h.maxX,r(a,[e,0])),!d.compareFloats(e,0,5)}function p(a,b,c){function e(a,b){var c,f,g;for(k(a,p),c=0;c<b.getBonds().length;c+=1)g=b.getBonds(c).getAtom(),f=d.addVectors(a,g.getCoords()),e(f,g)}function f(a,b){var c,e,g;for(l(a,p),c=0;c<b.getBonds().length;c+=1)g=b.getBonds(c).getAtom(),e=d.addVectors(a,g.getCoords()),f(e,g)}function g(a,b){var c,e,f;for(m(a,p),c=0;c<b.getBonds().length;c+=1)f=b.getBonds(c).getAtom(),e=d.addVectors(a,f.getCoords()),g(e,f)}function h(a,b){var c,e,f;for(n(a,p),c=0;c<b.getBonds().length;c+=1)f=b.getBonds(c).getAtom(),e=d.addVectors(a,f.getCoords()),h(e,f)}var i,j=a.getCoords(),o=d.addVectors(this.origin,j),p={};return"up"===b?(e(o,a),i=c-p.minY,q.call(this,[0,i],a),r(a,[0,i])):"down"===b?(f(o,a),i=c-p.maxY,q.call(this,[0,i],a),r(a,[0,i])):"left"===b?(h(o,a),i=c-p.minX,q.call(this,[i,0],a),r(a,[i,0])):"right"===b&&(g(o,a),i=c-p.maxX,q.call(this,[i,0],a),r(a,[i,0])),!d.compareFloats(i,0,5)}function q(a,b){angular.forEach(this.decorate.aromatic,function(c){var e=d.compareFloats(c.fromWhich[0],b.getCoords("x"),3)&&d.compareFloats(c.fromWhich[1],b.getCoords("y"),3);e&&(c.fromWhich=d.addVectors(c.fromWhich,a),c.coords=d.addVectors(c.coords,a))})}function r(a,b){var c;a instanceof u?(c=a.getCoords(),a.setCoords([c[0]+b[0],c[1]+b[1]])):a instanceof t&&(c=a.getOrigin(),a.setOrigin([c[0]+b[0],c[1]+b[1]]))}var s={},t=a.Arrow,u=(c.Selection,b.Atom);return e.prototype.setAromatic=function(){this.aromatic=!0},e.prototype.isAromatic=function(){return this.aromatic},e.prototype.moveStructureTo=function(a,b){function c(a,b,c,d,e){var b=b||5;"left"===c?("undefined"!=typeof d&&q.call(d,[-b,0],e),a[0]-=b):"right"===c?("undefined"!=typeof d&&q.call(d,[b,0],e),a[0]+=b):"up"===c?("undefined"!=typeof d&&q.call(d,[0,-b],e),a[1]-=b):"down"===c?("undefined"!=typeof d&&q.call(d,[0,b],e),a[1]+=b):"mouse"===c&&("undefined"!=typeof d&&q.call(d,b,e),a[0]+=b[0],a[1]+=b[1])}var d,e,f;for(e=0;e<this.structure.length;e+=1)f=this.structure[e],f.selected&&(f instanceof u?(d=f.getCoords(),c(d,b,a,this,f)):f instanceof t&&(d=f.getOrigin(),c(d,b,a),f.updateEnd()))},e.prototype.selectAll=function(){var a;for(this.selectedAll=!0,a=0;a<this.structure.length;a+=1)this.structure[a].select()},e.prototype.select=function(a){var b,c,d;for(b=0;b<this.structure.length;b+=1)c=this.structure[b],c instanceof t?(d=f.call(this,c,a),d&&c.select()):c instanceof u&&(d=g.call(this,c,a),d&&c.select())},e.prototype.deleteSelected=function(){var a,b,c,e,f,g,h=[];for(a=0;a<this.structure.length;a+=1)if(e=this.structure[a],e.selected){if(e instanceof u&&this.aromatic){for(c=[],b=0;b<this.decorate.aromatic.length;b+=1)g=this.decorate.aromatic[b],f=d.compareFloats(g.fromWhich[0],e.getCoords("x"),3)&&d.compareFloats(g.fromWhich[1],e.getCoords("y"),3),f||c.push(g);this.decorate.aromatic=c}}else h.push(e);this.structure=h},e.prototype.deselectAll=function(){var a;for(this.selectedAll=!1,a=0;a<this.structure.length;a+=1)this.structure[a].deselect()},e.prototype.alignUp=function(a){return j.call(this,"up",a)},e.prototype.alignDown=function(a){return j.call(this,"down",a)},e.prototype.alignRight=function(a){return j.call(this,"right",a)},e.prototype.alignLeft=function(a){return j.call(this,"left",a)},e.prototype.setOrigin=function(a){this.origin=a},e.prototype.getOrigin=function(a){return"x"===a?this.origin[0]:"y"===a?this.origin[1]:this.origin},e.prototype.setStructure=function(a){this.structure=a},e.prototype.addToStructures=function(a){this.structure.push(a)},e.prototype.getStructure=function(a){return 0===arguments.length?this.structure:this.structure[a]},e.prototype.getName=function(){return this.name},e.prototype.getDecorate=function(a){return this.decorate[a]},e.prototype.setDecorate=function(a,b){this.decorate[a]=b},e.prototype.findMinMax=function(a){function b(a){var b,f,g,h;a instanceof u?(b=a.getCoords(),f=d.addVectors(this.origin,b),c(f,a)):a instanceof t&&(g=d.addVectors(this.origin,a.getOrigin()),h=d.addVectors(this.origin,a.getEnd()),e(g),e(h))}function c(a,b){var e,f,h;for(k(a,g),n(a,g),l(a,g),m(a,g),e=0;e<b.getBonds().length;e+=1)h=b.getBonds(e).getAtom(),f=d.addVectors(a,h.getCoords()),c(f,h)}function e(a){k(a,g),n(a,g),l(a,g),m(a,g)}var f,g={};if("undefined"==typeof a)for(f=0;f<this.structure.length;f+=1)a=this.structure[f],a.selected&&b.call(this,a);else b.call(this,a);return g},e.prototype.addDecorate=function(a,b){"undefined"==typeof this.decorate[a]&&(this.decorate[a]=[]),this.decorate[a].push(b)},s.Structure=e,s}angular.module("mmAngularDrawChem").factory("DCStructure",a),a.$inject=["DCArrow","DCAtom","DCSelection","DrawChemUtils"]}(),function(){"use strict";function a(a){function b(a,b,c){this.elementFull=a,this.elementMini=b,this.id=c}var c={};return c.fontSize=18,c.subFontSize=14,c.font="Arial",b.prototype.getElementFull=function(){return this.elementFull},b.prototype.setElementFull=function(a){this.elementFull=a},b.prototype.getElementMini=function(){return this.elementMini},b.prototype.setElementMini=function(a){this.elementMini=a},b.prototype.setMinMax=function(a){this.minMax=a},b.prototype.wrap=function(a,b,c){var d,e={};return"g"!==b||c||(c=e,c.id=this.id),c?(d="<"+b+" ",angular.forEach(c,function(a,b){d+=b+"='"+a+"' "}),"full"===a?this.elementFull=d+">"+this.elementFull+"</"+b+">":"mini"===a&&(this.elementMini=d+">"+this.elementMini+"</"+b+">")):"full"===a?this.elementFull="<"+b+">"+this.elementFull+"</"+b+">":"mini"===a&&(this.elementMini="<"+b+">"+this.elementMini+"</"+b+">"),this},b.generateStyle=function(b){var d={expanded:{"circle.atom:hover":{opacity:"0.3",stroke:"black","stroke-width":a.BOND_WIDTH},"circle.arom:hover":{opacity:"0.3",stroke:"black","stroke-width":a.BOND_WIDTH,fill:"black"},"text:hover":{opacity:"0.3"},"circle.atom":{opacity:"0"},"circle.edit":{stroke:"black",fill:"none"},"rect.selection":{stroke:"black","stroke-dasharray":"10 5",fill:"none"}},base:{path:{stroke:"black","stroke-width":a.BOND_WIDTH,fill:"none"},"path.wedge":{fill:"black"},"path.arrow":{fill:"black"},"path.arrow-eq":{fill:"none"},"circle.arom":{stroke:"black","stroke-width":a.BOND_WIDTH,fill:"none"},"circle.tr-arom":{stroke:"black","stroke-width":a.BOND_WIDTH,fill:"none"},text:{"font-family":c.font,cursor:"default","font-size":c.fontSize+"px"},"tspan.sub":{"font-size":c.subFontSize+"px"},"polygon.text":{fill:"white"}}},e='<style type="text/css">';return"expanded"===b?b={base:d.base,expanded:d.expanded}:"base"===b&&(b={base:d.base,expanded:{}}),angular.forEach(b,function(a,b){angular.forEach(a,function(a,b){e+=b+"{",angular.forEach(a,function(a,b){e+=b+":"+a+";"}),e+="}"})}),e+"</style>"},c.Svg=b,c}angular.module("mmAngularDrawChem").factory("DCSvg",a),a.$inject=["DrawChemConst"]}(),function(){"use strict";function a(){var a={};return a.mouseFlags={downAtomCoords:void 0,downAtomObject:void 0,downMouseCoords:void 0,movedOnEmpty:!1,mouseDown:!1,downOnAtom:!1},a.customLabel="",a.focused=!1,a.selected="",a}angular.module("mmAngularDrawChem").factory("DrawChemDirectiveFlags",a),a.$inject=[]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h){function i(a,c,e){return b.modifyStructure(d.getCurrentStructure(),a.chosenStructure,c,p.downAtomCoords,e)}function j(a){var c,e;return b.isContentEmpty()||(c=angular.copy(d.getCurrentStructure()),e=b.subtractVectors(a,p.downMouseCoords),c.moveStructureTo("mouse",e)),c}function k(a){var c,e,f;return b.isContentEmpty()?(c=new o,c.setOrigin(p.downMouseCoords),e=new n([0,0],a)):(c=angular.copy(d.getCurrentStructure()),f=b.subtractVectors(p.downMouseCoords,c.getOrigin()),e=new n(f,a)),c.select(e),c.addToStructures(e),c}var l={},m=f.Label,n=h.Selection,o=g.Structure,p=a.mouseFlags;return l.doOnMouseDown=function(e,f,g){function h(){var a=c.isWithin(d.getCurrentStructure(),p.downMouseCoords);p.downAtomCoords=a.absPos,p.downAtomObject=a.foundAtom,"undefined"!=typeof a.foundAtom&&(p.downOnAtom=!0)}var i;return 1!==e.which?void 0:(p.downMouseCoords=b.innerCoords(g,e),p.mouseDown=!0,void(b.isContentEmpty()||"label"!==a.selected&&"customLabel"!==a.selected&&"structure"!==a.selected||("tspan"===e.target.nodeName&&(i=angular.element(e.target).parent(),p.downMouseCoords=[i.attr("atomx"),i.attr("atomy")]),h())))},l.doOnMouseUp=function(f,g,h){function l(){return b.isContentEmpty()?void 0:b.deleteFromStructure(d.getCurrentStructure(),t)}function n(){var b=angular.copy(d.getCurrentStructure()),e=c.isWithin(b,p.downMouseCoords).foundAtom,f=e.getLabel();return"label"===a.selected?e.setLabel(angular.copy(g.chosenLabel)):"customLabel"===a.selected&&(a.customLabel="undefined"==typeof a.customLabel?"":a.customLabel,e.setLabel(new m(a.customLabel,0))),"undefined"!=typeof f&&("lr"===f.getMode()?e.getLabel().setMode("rl"):"rl"===f.getMode()&&e.getLabel().setMode("lr")),b}function q(){var a,c,e;return b.isContentEmpty()?(a=new o,p.movedOnEmpty?(a.setOrigin(p.downMouseCoords),c=g.chosenArrow.getArrow(p.downMouseCoords,t),c.setOrigin([0,0])):(a.setOrigin(t),c=angular.copy(g.chosenArrow.getDefault()),e=b.subtractVectors(t,a.getOrigin()),c.setOrigin(e))):(a=angular.copy(d.getCurrentStructure()),c=p.movedOnEmpty?g.chosenArrow.getArrow(p.downMouseCoords,t):angular.copy(g.chosenArrow.getDefault()),e=b.subtractVectors(p.downMouseCoords,a.getOrigin()),c.setOrigin(e)),a.addToStructures(c),a}function r(){var a,c,f,h;return b.isContentEmpty()?p.movedOnEmpty?(a=angular.copy(g.chosenStructure.getStructure(p.downMouseCoords,t)),a.setOrigin(p.downMouseCoords),a.isAromatic()&&(h=e.getBondByDirection(a.getName()).bond,a.addDecorate("aromatic",{fromWhich:[0,0],coords:[p.downMouseCoords[0]+h[0],p.downMouseCoords[1]+h[1]]}))):(a=angular.copy(g.chosenStructure.getDefault()),a.setOrigin(t),a.isAromatic()&&(h=e.getBondByDirection(a.getName()).bond,a.addDecorate("aromatic",{fromWhich:[0,0],coords:[t[0]+h[0],t[1]+h[1]]}))):(a=angular.copy(d.getCurrentStructure()),f=b.subtractVectors(p.downMouseCoords,a.getOrigin()),p.movedOnEmpty?(c=angular.copy(g.chosenStructure.getStructure(p.downMouseCoords,t)),c.isAromatic()&&(h=e.getBondByDirection(c.getName()).bond,a.addDecorate("aromatic",{fromWhich:angular.copy(f),coords:[p.downMouseCoords[0]+h[0],p.downMouseCoords[1]+h[1]]}))):(c=angular.copy(g.chosenStructure.getDefault()),c.isAromatic()&&(h=e.getBondByDirection(c.getName()).bond,a.addDecorate("aromatic",{fromWhich:angular.copy(f),coords:[t[0]+h[0],t[1]+h[1]]}))),c.getStructure(0).setCoords(f),a.addToStructures(c.getStructure(0))),a}var s,t=b.innerCoords(h,f);return 1!==f.which||""===a.selected?void b.resetMouseFlags():("delete"===a.selected?s=l():"select"===a.selected?(s=k(t),s.getStructure().pop()):s="moveStructure"===a.selected?j(t):"arrow"===a.selected?q():!p.downOnAtom||"label"!==a.selected&&"customLabel"!==a.selected?p.downOnAtom&&"structure"===a.selected?i(g,t,!1):r():n(),"undefined"!=typeof s&&(d.addStructure(s),b.drawStructure(s)),void b.resetMouseFlags())},l.doOnMouseMove=function(c,f,g){function h(){var a,c,e;return b.isContentEmpty()?(a=new o,a.setOrigin(p.downMouseCoords),c=f.chosenArrow.getArrow(p.downMouseCoords,n),c.setOrigin([0,0])):(a=angular.copy(d.getCurrentStructure()),c=f.chosenArrow.getArrow(p.downMouseCoords,n),e=b.subtractVectors(p.downMouseCoords,a.getOrigin()),c.setOrigin(e)),a.addToStructures(c),p.movedOnEmpty=!0,a}function l(){var a,c,g,h;return b.isContentEmpty()?(a=angular.copy(f.chosenStructure.getStructure(p.downMouseCoords,n)),a.setOrigin(p.downMouseCoords),a.isAromatic()&&(h=e.getBondByDirection(a.getName()).bond,a.addDecorate("aromatic",{fromWhich:angular.copy(g),coords:[p.downMouseCoords[0]+h[0],p.downMouseCoords[1]+h[1]]}))):(a=angular.copy(d.getCurrentStructure()),g=b.subtractVectors(p.downMouseCoords,a.getOrigin()),c=angular.copy(f.chosenStructure.getStructure(p.downMouseCoords,n)),c.isAromatic()&&(h=e.getBondByDirection(c.getName()).bond,a.addDecorate("aromatic",{fromWhich:angular.copy(g),coords:[p.downMouseCoords[0]+h[0],p.downMouseCoords[1]+h[1]]})),c.getStructure(0).setCoords(g),a.addToStructures(c.getStructure(0))),p.movedOnEmpty=!0,a}var m,n=b.innerCoords(g,c);return p.mouseDown&&"label"!==a.selected&&"labelCustom"!==a.selected&&""!==a.selected?("select"===a.selected?m=k(n):"moveStructure"===a.selected?m=j(n):"arrow"===a.selected?m=h():p.downOnAtom?m=i(f,n,!0):"structure"===a.selected&&(m=l()),void("undefined"!=typeof m&&b.drawStructure(m))):void 0},l}angular.module("mmAngularDrawChem").factory("DrawChemDirectiveMouseActions",a),a.$inject=["DrawChemDirectiveFlags","DrawChemDirectiveUtils","DrawChemModStructure","DrawChemCache","DrawChemConst","DCLabel","DCStructure","DCSelection"]}(),function(){"use strict";function a(a,b,c,d){var e={};return e.drawStructure=function(a){var d="";return d=b.draw(a,"cmpd1"),c.setCurrentSvg(d.wrap("full","g").wrap("full","svg").elementFull),d},e.resetMouseFlags=function(){angular.forEach(d.mouseFlags,function(a,b){"boolean"==typeof a?d.mouseFlags[b]=!1:d.mouseFlags[b]=void 0})},e.subtractVectors=function(a,b){return[a[0]-b[0],a[1]-b[1]]},e.isContentEmpty=function(){return null===c.getCurrentStructure()},e.innerCoords=function(a,b){var c=a.find("dc-content")[0],d=[parseFloat((b.clientX-c.getBoundingClientRect().left-2).toFixed(2)),parseFloat((b.clientY-c.getBoundingClientRect().top-2).toFixed(2))];return d},e.modifyStructure=function(b,c,d,e,f){return a.modifyStructure(angular.copy(b),angular.copy(c),d,e,f)},e.deleteFromStructure=function(b,c){return a.deleteFromStructure(angular.copy(b),c)},e}angular.module("mmAngularDrawChem").factory("DrawChemDirectiveUtils",a),a.$inject=["DrawChemModStructure","DrawChemSvgRenderer","DrawChemCache","DrawChemDirectiveFlags"]}(),function(){"use strict";function a(a,b,c,d,e,f,g){return{template:'<div ng-include="getEditorUrl()"></div>',scope:{showEditor:"="},link:function(d,h,i){d.getEditorUrl=function(){var b=""===i.dcModal?"draw-chem-editor-modal.html":"draw-chem-editor.html";return a.getPath()+b},d.pathToSvg=a.getPathToSvg(),d.dialogStyle={},i.width&&(d.dialogStyle.width=i.width),i.height&&(d.dialogStyle.height=i.height),d.setFocus=function(){c.focused=!0},d.unsetFocus=function(){c.focused=!1},d.content=function(){var a=g.trustAsHtml(b.getCurrentSvg());return a},f.addButtonsToScope(d),d.doOnMouseDown=function(a){try{e.doOnMouseDown(a,d,h)}catch(b){console.log(b)}},d.doOnMouseUp=function(a){try{e.doOnMouseUp(a,d,h)}catch(b){console.log(b)}},d.doOnMouseMove=function(a){try{e.doOnMouseMove(a,d,h)}catch(b){console.log(b)}}}}}angular.module("mmAngularDrawChem").directive("drawChemEditor",a),a.$inject=["DrawChemPaths","DrawChemCache","DrawChemDirectiveFlags","DrawChemDirectiveUtils","DrawChemDirectiveMouseActions","DrawChemMenuButtons","$sce"]}(),function(){"use strict";function a(){var a={},b=[{structure:null,svg:""}],c=0;return a.addStructure=function(d){c<b.length-1&&(b=b.slice(0,c+1)),b.push({structure:d,svg:""}),b.length>10&&b.shift(),a.moveRightInStructures()},a.getCurrentPosition=function(){return c},a.getStructureLength=function(){return b.length},a.getCurrentStructure=function(){return b[c].structure},a.getCurrentSvg=function(){return b[c].svg},a.setCurrentSvg=function(a){b[c].svg=a},a.moveLeftInStructures=function(){c>0&&(c-=1)},a.moveRightInStructures=function(){c<b.length-1&&(c+=1)},a}angular.module("mmAngularDrawChem").factory("DrawChemCache",a)}(),function(){"use strict";function a(a){function b(){function b(){var b=[0,-c.BOND_LENGTH];c.DIRECTIONS.forEach(function(d){var e="BOND_"+d;c[e]=b,c.BONDS.push({direction:d,bond:b}),b=a.rotVectCW(b,c.FREQ)})}c.BOND_LENGTH=c.SET_BOND_LENGTH||20,c.WIDTH_TO_LENGTH=.04,c.FREQ=15,c.PUSH=.25,c.ANGLE=120,c.MAX_BONDS=10,c.AROMATIC_R=.45*c.BOND_LENGTH,c.BETWEEN_DBL_BONDS=.065,c.BETWEEN_TRP_BONDS=.1,c.ARROW_SIZE=.065,c.ARROW_START=.85,c.BOND_WIDTH=(c.BOND_LENGTH*c.WIDTH_TO_LENGTH).toFixed(2),c.CIRC_R=.12*c.BOND_LENGTH,c.DIRECTIONS=["N","NE1","NE2","NE3","NE4","NE5","E","SE1","SE2","SE3","SE4","SE5","S","SW1","SW2","SW3","SW4","SW5","W","NW1","NW2","NW3","NW4","NW5"],c.BONDS=[],b(),c.getBondByDirection=function(a){var b;for(b=0;b<c.BONDS.length;b+=1)if(c.BONDS[b].direction===a)return c.BONDS[b]}}var c={};return c.SET_BOND_LENGTH,c.setBondLength=function(a){c.SET_BOND_LENGTH=a,b()},b(),c}angular.module("mmAngularDrawChem").factory("DrawChemConst",a),a.$inject=["DrawChemUtils"]}(),function(){"use strict";function a(){var a={};return a.getQuadrant=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return c>0&&0>d?1:0>c&&0>d?2:0>c&&d>0?3:4},a.addVectors=function(a,b,c){return"undefined"==typeof c?[a[0]+b[0],a[1]+b[1]]:[a[0]+c*b[0],a[1]+c*b[1]]},a.multVectByScalar=function(a,b){return[a[0]*b,a[1]*b]},a.compareVectors=function(a,b,c){return"undefined"==typeof a||"undefined"==typeof b?!1:a[0].toFixed(c)===b[0].toFixed(c)&&a[1].toFixed(c)===b[1].toFixed(c)},a.isNumeric=function(a){return a-parseFloat(a)>=0},a.isSmallLetter=function(a){return a.length>1?!1:a>="a"&&"z">=a},a.compareFloats=function(a,b,c){return a.toFixed(c)===b.toFixed(c)},a.invertGroup=function(a){var b,c,d="";if(c="undefined"==typeof a?"":a.match(/[A-Z][a-z\d]*/g),null===c)return a;for(b=c.length-1;b>=0;b-=1)d+=c[b];return d},a.moveToLeft=function(a,b,c){return 0>b-c?b-c+a.length:b-c},a.moveToRight=function(a,b,c){return b+c>a.length-1?b+c-a.length:b+c},a.calcPossibleVectors=function(b,c){var d,e=[];for(d=0;360/c>d;d+=1)b=a.rotVectCW(b,c),e.push(b);return e},a.getClosestVector=function(b,c,d){var e,f,g,h=[c[0]-b[0],c[1]-b[1]],i=Math.PI,j=0;for(f=0;f<d.length;f+=1)g=d[f],e=Math.acos(a.dotProduct(a.norm(g),a.norm(h))),Math.abs(e)<i&&(i=Math.abs(e),j=f);return d[j]},a.checkAttachedBonds=function(b,c,d,e){function f(c){function e(e,g){var h,i;for(h=0;h<e.length;h+=1)i="in"===g?a.rotVectCW(e[h].vector,180):e[h].vector,a.compareVectors(i,c,5)&&(b=a.rotVectCW(c,d),f(b))}e(g,"in"),e(h,"out")}var g=c.getAttachedBonds("in")||[],h=c.getAttachedBonds("out")||[];return g.length+h.length>=e?"full atom":(f(b),b)},a.dotProduct=function(a,b){return a[0]*b[0]+a[1]*b[1]},a.norm=function(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]);return[a[0]/b,a[1]/b]},a.rotVectCCW=function(a,b){var c=b*(Math.PI/180),d=a[0]*Math.cos(c)+a[1]*Math.sin(c),e=a[1]*Math.cos(c)-a[0]*Math.sin(c);return[d,e]},a.rotVectCW=function(a,b){var c=b*(Math.PI/180),d=a[0]*Math.cos(c)-a[1]*Math.sin(c),e=a[0]*Math.sin(c)+a[1]*Math.cos(c);return[d,e]},a.insideCircle=function(a,b,c){return Math.abs(a[0]-b[0])<c&&Math.abs(a[1]-b[1])<c},a.subtractVectors=function(a,b){return[a[0]-b[0],a[1]-b[1]]},a}angular.module("mmAngularDrawChem").factory("DrawChemUtils",a)}(),function(){"use strict";function a(a,b,c,d){return{restrict:"A",link:function(e,f){f.bind("keydown",function(d){!a.showEditor()||c.focused&&!d.ctrlKey||(d.preventDefault(),b.down(d.keyCode))}),f.bind("keyup",function(e){!a.showEditor()||c.focused&&!e.ctrlKey||(e.preventDefault(),b.released(e.keyCode),d.$digest())})}}}angular.module("mmAngularDrawChem").directive("dcShortcuts",a),a.$inject=["DrawChem","DrawChemKeyShortcuts","DrawChemDirectiveFlags","$rootScope"]}(),function(){"use strict";function a(a,b,c){function d(a,b){var c,d,e={cb:b,keys:{}};if(a.indexOf(" + ")>=0)for(d=a.split(" + "),c=0;c<d.length;c+=1)e.keys[d[c]]=!1;else d=a,e.keys[d]=!1;h[a]=e}function e(a,b){var c=g[a];"undefined"!=typeof c&&angular.forEach(h,function(a,d){"undefined"!=typeof a.keys[c]&&(a.keys[c]=b)})}function f(a){function b(a){var b="undefined"!=typeof a;return angular.forEach(a,function(a,c){a||(b=!1)}),b}angular.forEach(h,function(a,c){b(a.keys)&&a.cb()})}var g={16:"shift",17:"ctrl",37:"leftarrow",38:"uparrow",39:"rightarrow",40:"downarrow",46:"del",65:"a",68:"d",69:"e",70:"f",81:"q",82:"r",83:"s",84:"t",87:"w",90:"z"},h={},i={};return angular.forEach(a.actions,function(a){"undefined"!=typeof a.shortcut&&d(a.shortcut,a.action)}),angular.forEach(b.edits,function(a){"undefined"!=typeof a.shortcut&&("arrows"===a.shortcut?(d("leftarrow",a.shortcutBind.left),d("uparrow",a.shortcutBind.up),d("rightarrow",a.shortcutBind.right),d("downarrow",a.shortcutBind.down)):d(a.shortcut,a.action))}),i.down=function(a){e(a,!0)},i.released=function(a){f(),e(a,!1)},i}angular.module("mmAngularDrawChem").factory("DrawChemKeyShortcuts",a),a.$inject=["DrawChemActions","DrawChemEdits"]}(),function(){"use strict";function a(){function a(a){for(var b=0;b<g.length;b++)if(g[b].name===a)return!0;return!1}function b(a){for(var b=0;b<g.length;b++)if(g[b].name===a)return g[b]}function c(a,b){var c;for(c=0;c<g.length;c++)if(g[c].name===b)return g[c].content=a;g.push({name:b,content:a})}function d(a,b){var c;for(c=0;c<g.length;c++)if(g[c].name===b)return g[c].structure=a;g.push({name:b,structure:a})}var e={},f=!1,g=[],h={};return e.showEditor=function(){return f},e.runEditor=function(c){var d;f=!0,a(c)||g.push({name:c,content:"",structure:null}),d=b(c),h.name=d.name,h.content=d.content,h.structure=d.structure},e.getContent=function(a){if("string"==typeof a){var c=b(a);return"undefined"==typeof c?"":c.content}return h.content},e.getInstance=function(a){return"undefined"==typeof a?h:b(a)},e.setContent=function(a,b){"undefined"==typeof b?h.content=a:c(a,b)},e.setStructure=function(a,b){"undefined"==typeof b?h.structure=a:d(a,b)},e.transferContent=function(){c(h.content,h.name),d(h.structure,h.name)},e.closeEditor=function(){f=!1,h={}},e.clearContent=function(a){"string"==typeof a?c("",a):h.content=""},e.beautifySvg=function(a){var b,c=e.getContent(a),d="<!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'>\n";return b=c.match(/<svg.*?>|<g.*?>|<style.*?<\/style>|<path.*?><\/path>|<circle.*?><\/circle>|<polygon.*?><\/polygon>|<text.*?<\/text>|<\/g>|<\/svg>|/g),b.forEach(function(a){d+=a+"\n"}),d},e}angular.module("mmAngularDrawChem").factory("DrawChem",a)}(),function(){"use strict";function a(a,b,c,d){var e={};return e.forward=function(){a.moveRightInStructures(),null===a.getCurrentStructure()?b.clearContent():d.drawStructure(a.getCurrentStructure())},e.close=function(){b.closeEditor()},e.clear=function(){a.addStructure(null),a.setCurrentSvg("")},e.undo=function(){a.moveLeftInStructures(),null===a.getCurrentStructure()?b.clearContent():d.drawStructure(a.getCurrentStructure())},e.transfer=function(){var d,e,f=a.getCurrentStructure(),g="";null!==f&&(d=c.draw(f,"transfer"),e={viewBox:(d.minMax.minX-20).toFixed(2)+" "+(d.minMax.minY-20).toFixed(2)+" "+(d.minMax.maxX-d.minMax.minX+40).toFixed(2)+" "+(d.minMax.maxY-d.minMax.minY+40).toFixed(2),height:"100%",width:"100%",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},g=d.wrap("mini","g").wrap("mini","svg",e).elementMini),b.setContent(g),b.setStructure(f),b.transferContent()},e.actions={undo:{shortcut:"ctrl + z",id:"undo",action:e.undo},forward:{shortcut:"ctrl + f",id:"forward",action:e.forward},transfer:{shortcut:"ctrl + t",id:"transfer",action:e.transfer},clear:{shortcut:"ctrl + e",id:"clear",action:e.clear},close:{shortcut:"ctrl + q",id:"close",action:e.close}},e}angular.module("mmAngularDrawChem").factory("DrawChemActions",a),a.$inject=["DrawChemCache","DrawChem","DrawChemSvgRenderer","DrawChemDirectiveUtils"]}(),function(){"use strict";function a(a,b,c,d,e){function f(b){function c(){var a=g(b),c=new j(b,a);return c}return function(b){b.chosenArrow=c(),a.selected="arrow"}}function g(a){var d,e=c.BOND_N,f=[],g=b.calcPossibleVectors(e,c.FREQ);for(g.push(e),d=0;d<g.length;d+=1)f.push(new i(a,g[d]));return f}var h={},i=(c.BONDS,d.Arrow),j=e.ArrowCluster;return h.arrows={"one way arrow":{action:f("one-way-arrow"),id:"one-way-arrow",thumbnail:!0},"two way arrow":{action:f("two-way-arrow"),id:"two-way-arrow",thumbnail:!0},"equilibrium arrow":{action:f("equilibrium-arrow"),id:"equilibrium-arrow",thumbnail:!0}},h}angular.module("mmAngularDrawChem").factory("DrawChemArrows",a),a.$inject=["DrawChemDirectiveFlags","DrawChemUtils","DrawChemConst","DCArrow","DCArrowCluster"]}(),function(){"use strict";function a(a,b,c){var d={};return d.deleteFromStructure=function(){c.selected="delete"},d.deleteSelected=function(){var c=angular.copy(a.getCurrentStructure());null!==c&&(c.deleteSelected(),a.addStructure(c),b.drawStructure(c))},d.select=function(){d.deselectAll(),c.selected="select"},d.selectAll=function(){var c=angular.copy(a.getCurrentStructure());null!==c&&(c.selectAll(),a.addStructure(c),b.drawStructure(c))},d.deselectAll=function(){var c=angular.copy(a.getCurrentStructure());null!==c&&(c.deselectAll(),a.addStructure(c),b.drawStructure(c))},d.alignUp=function(){var c,d=angular.copy(a.getCurrentStructure()),e=!1;
null!==d&&(c=d.findMinMax(),e=d.alignUp(c.minY),e&&(a.addStructure(d),b.drawStructure(d)))},d.alignDown=function(){var c,d=angular.copy(a.getCurrentStructure()),e=!1;null!==d&&(c=d.findMinMax(),e=d.alignDown(c.maxY),e&&(a.addStructure(d),b.drawStructure(d)))},d.alignRight=function(){var c,d=angular.copy(a.getCurrentStructure()),e=!1;null!==d&&(c=d.findMinMax(),e=d.alignRight(c.maxX),e&&(a.addStructure(d),b.drawStructure(d)))},d.alignLeft=function(){var c,d=angular.copy(a.getCurrentStructure()),e=!1;null!==d&&(c=d.findMinMax(),e=d.alignLeft(c.minX),e&&(a.addStructure(d),b.drawStructure(d)))},d.moveStructure=function(){function d(c){return function(){var d=angular.copy(a.getCurrentStructure());null!==d&&(d.moveStructureTo(c),a.addStructure(d),b.drawStructure(d))}}return c.selected="moveStructure",{left:d("left"),up:d("up"),right:d("right"),down:d("down")}},d.edits={move:{action:d.moveStructure,id:"move",shortcut:"arrows",shortcutBind:{left:d.moveStructure().left,up:d.moveStructure().up,right:d.moveStructure().right,down:d.moveStructure().down}},select:{action:d.select,id:"select",shortcut:"shift + s"},"select all":{action:d.selectAll,id:"select-all",shortcut:"shift + a"},"deselect all":{action:d.deselectAll,id:"deselect-all",shortcut:"shift + d"},"align up":{action:d.alignUp,id:"align-up",shortcut:"shift + q"},"align down":{action:d.alignDown,id:"align-down",shortcut:"shift + w"},"align right":{action:d.alignRight,id:"align-right",shortcut:"shift + r"},"align left":{action:d.alignLeft,id:"align-left",shortcut:"shift + e"},"delete selected":{action:d.deleteSelected,id:"delete-selected",shortcut:"del"},"delete":{action:d.deleteFromStructure,id:"delete"}},d}angular.module("mmAngularDrawChem").factory("DrawChemEdits",a),a.$inject=["DrawChemCache","DrawChemDirectiveUtils","DrawChemDirectiveFlags"]}(),function(){"use strict";function a(){var a={};return a.todo=function(){},a.shapes={dummy:{action:a.todo}},a}angular.module("mmAngularDrawChem").factory("DrawChemGeomShapes",a),a.$inject=[]}(),function(){"use strict";function a(a,b){function c(a,c){return function(d){d.chosenLabel=new e(a,c),b.selected="label"}}var d={},e=a.Label;return d.labels={oxygen:{action:c("O",2),id:"oxygen"},sulfur:{action:c("S",2),id:"sulfur"},phosphorus:{action:c("P",3),id:"phosphorus"},nitrogen:{action:c("N",3),id:"nitrogen"},carbon:{action:c("C",4),id:"carbon"},fluorine:{action:c("F",1),id:"fluorine"},chlorine:{action:c("Cl",1),id:"chlorine"},bromine:{action:c("Br",1),id:"bromine"},iodine:{action:c("I",1),id:"iodine"},hydrogen:{action:c("H",1),id:"hydrogen"}},d}angular.module("mmAngularDrawChem").factory("DrawChemLabels",a),a.$inject=["DCLabel","DrawChemDirectiveFlags"]}(),function(){"use strict";function a(a,b,c,d,e,f,g){var h={};return h.addButtonsToScope=function(h){var i={Actions:{actions:c.actions},Edit:{actions:d.edits},Arrows:{actions:e.arrows},Shapes:{actions:f.shapes},Structures:{actions:a.structures},Labels:{actions:b.labels}};h.menu={},angular.forEach(i,function(a,b){h.menu[b]={actions:a.actions,scope:h}}),h.chooseCustomLabel=function(a){g.customLabel=a,g.selected="customLabel"}},h}angular.module("mmAngularDrawChem").factory("DrawChemMenuButtons",a),a.$inject=["DrawChemStructures","DrawChemLabels","DrawChemActions","DrawChemEdits","DrawChemArrows","DrawChemGeomShapes","DrawChemDirectiveFlags"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i){function j(a){return function(b){b.chosenStructure=a(),i.selected="structure"}}function k(){n.forEach(function(a){var b=a.getName(),c=a.getMultiplicity();o[b+"Bond"]=function(){var a=o.generateBonds(b,c),d=new u(b,a,0,0,c);return d}})}function l(){m.forEach(function(a){var b=a.getName(),c=a.getRingSize(),d=a.getAngle(),e=a.isAromatic();o[b]=function(){var a=o.generateRings(d,c,e),f=new u(b,a,c,d);return f}})}var m,n,o={},p=e.Atom,q=f.Bond,r=g.CyclicStructure,s=h.BondStructure,t=c.Structure,u=d.StructureCluster,v=a.BONDS;return m=[new r("cyclopropane",3,60),new r("cyclobutane",4,90),new r("cyclopentane",5,108),new r("cyclohexane",6,120),new r("benzene",6,120,!0),new r("cycloheptane",7,128.57),new r("cyclooctane",8,135),new r("cyclononane",9,140)],n=[new s("single",1),new s("wedge",1),new s("dash",1),new s("double",2),new s("triple",3)],l(),k(),o.structures={cyclopropane:{action:j(o.cyclopropane),id:"cyclopropane",thumbnail:!0},cyclobutane:{action:j(o.cyclobutane),id:"cyclobutane",thumbnail:!0},benzene:{action:j(o.benzene),id:"benzene",thumbnail:!0},cyclohexane:{action:j(o.cyclohexane),id:"cyclohexane",thumbnail:!0},cyclopentane:{action:j(o.cyclopentane),id:"cyclopentane",thumbnail:!0},cycloheptane:{action:j(o.cycloheptane),id:"cycloheptane",thumbnail:!0},cyclooctane:{action:j(o.cyclooctane),id:"cyclooctane",thumbnail:!0},cyclononane:{action:j(o.cyclononane),id:"cyclononane",thumbnail:!0},"single bond":{action:j(o.singleBond),id:"single-bond",thumbnail:!0},"wedge bond":{action:j(o.wedgeBond),id:"wedge-bond",thumbnail:!0},"dash bond":{action:j(o.dashBond),id:"dash-bond",thumbnail:!0},"double bond":{action:j(o.doubleBond),id:"double-bond",thumbnail:!0},"triple bond":{action:j(o.tripleBond),id:"triple-bond",thumbnail:!0}},o.generateBonds=function(a,b){var c,d,e,f=[];for(c=0;c<v.length;c+=1)d=v[c].bond,e=v[c].direction,f.push(new t(e,[new p([0,0],[o.generateBond(d,a,b)],{out:[{vector:d,multiplicity:b}]})]));return f},o.generateBond=function(a,b,c){return new q(b,new p(a,[],{"in":[{vector:angular.copy(a),multiplicity:c}]}))},o.generateRings=function(c,d,e){function f(c,d,f){var g,h,i,j=p.getOppositeDirection(c),k=a.getBondByDirection(j).bond,l=b.rotVectCCW(k,d/2);return g=new p([0,0],[],{out:[{vector:angular.copy(l),multiplicity:1}]}),h=new p(l,[],{"in":[{vector:angular.copy(l),multiplicity:1}]}),g.addBond(new q("single",h)),o.generateRing(h,f,d,g),i=new t(j,[g]),e&&i.setAromatic(),i}var g,h,i=[];for(g=0;g<v.length;g+=1)h=v[g].direction,i.push(f(h,c,d,e));return i},o.generateRing=function(a,c,d,e){var f=b.rotVectCW(a.getCoords(),180-d),g=new p(f,[]);return a.attachBond("out",{vector:angular.copy(f),multiplicity:1}),1===c?(a.setAsOrphan(),void e.attachBond("in",{vector:angular.copy(a.getCoords()),multiplicity:1})):(g.attachBond("in",{vector:angular.copy(f),multiplicity:1}),a.addBond(new q("single",g)),void o.generateRing(g,c-1,d,e))},o}angular.module("mmAngularDrawChem").factory("DrawChemStructures",a),a.$inject=["DrawChemConst","DrawChemUtils","DCStructure","DCStructureCluster","DCAtom","DCBond","DCCyclicStructure","DCBondStructure","DrawChemDirectiveFlags"]}(),function(){"use strict";function a(){var a="",b=a+"svg";return{setPath:function(b){a=b},setPathSvg:function(a){b=a},$get:function(){return{getPath:function(){return a},getPathToSvg:function(){return b}}}}}angular.module("mmAngularDrawChem").provider("DrawChemPaths",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h){var i={},j=(a.BOND_LENGTH,a.BONDS_AUX,d.Atom),k=f.Arrow,l=e.Bond;h.Svg,g.Selection;return i.modifyStructure=function(d,e,f,g,h){function k(s,t){function u(a,f,g){var h,k,m,n,o,p=e.getName(),q=e.getRingSize(),r=e.getMult();q>0?(k=e.getAngle(),n=b.rotVectCCW(a,k/2),m=new j(n,[],{"in":[{vector:angular.copy(n),multiplicity:1}]}),f.addBond(new l("single",m)),f.attachBond("out",{vector:angular.copy(n),multiplicity:1}),c.generateRing(m,q,k,f)):(h=c.generateBond(a,p,r),o=i.isWithin(d,b.addVectors(g,a)).foundAtom,"undefined"!=typeof o&&(h.getAtom().setAsOrphan(),o.attachBond("in",{vector:a,multiplicity:r})),f.addBond(h),f.attachBond("out",{vector:angular.copy(a),multiplicity:r}))}var v,w,x,y;for(v=0;v<s.length;v+=1)if(y=s[v],y instanceof j||y instanceof l){if(r)break;if(y instanceof j)p=s[v],x=y;else if(x=y.getAtom(),x.isOrphan())continue;if(w=[x.getCoords("x")+t[0],x.getCoords("y")+t[1]],q=b.insideCircle(w,f,a.CIRC_R),q&&!h)return o=n(x),"full atom"!==o&&u(o,x,w),r=!0,d;if(!q&&b.compareVectors(g,w,5))return o=m(x),u(o,x,w),r=!0,d;k(x.getBonds(),w)}}function m(c){var d,e,h,i,j,k=c.getAttachedBonds("in"),l=c.getAttachedBonds("out");return"undefined"!=typeof k&&"undefined"!=typeof l?(e=k[0].vector,h=l[0].vector,i=180*Math.acos(b.dotProduct(b.norm(e),b.norm(h)))/Math.PI,j=b.rotVectCCW(e,(180-i)/2)):j="undefined"!=typeof k?k[0].vector:"undefined"!=typeof l?l[0].vector:a.BOND_N,d=b.calcPossibleVectors(j,a.FREQ),b.getClosestVector(g,f,d)}function n(c){var d,f,g,h,i,j=c.getAttachedBonds("in"),k=c.getAttachedBonds("out"),l=e.getRingSize();return"undefined"!=typeof j&&"undefined"!=typeof k?(d=j[0].vector,f=k[0].vector,g=180*Math.acos(b.dotProduct(b.norm(d),b.norm(f)))/Math.PI,i=b.rotVectCCW(d,(180-g)/2),h=b.compareVectors(i,f,5)?b.rotVectCW(d,(180-g)/2):i):h="undefined"!=typeof j?l>0?angular.copy(j[0].vector):b.rotVectCCW(j[0].vector,a.ANGLE/2):"undefined"!=typeof k?b.rotVectCCW(k[0].vector,a.ANGLE):a.BOND_N,b.checkAttachedBonds(h,c,a.FREQ,a.MAX_BONDS)}var o,p,q,r=!1,s=d.getOrigin();return k(d.getStructure(),s),d},i.deleteFromStructure=function(c,d){function e(c,f,g){function m(a,c){var d,e,f,g;for(d=0;d<c.getBonds().length;d+=1)g=c.getBonds(d).getAtom(),f=[g.getCoords("x")+a[0],g.getCoords("y")+a[1]],e=b.subtractVectors(f,h),i.push({obj:g,coords:e})}var n,o,p,q,r,s=[];for(n=0;n<c.length;n+=1)p=c[n],p instanceof k?(q=[p.getOrigin("x")+f[0],p.getOrigin("y")+f[1]],r=[p.getEnd("x")+f[0],p.getEnd("y")+f[1]],b.insideCircle(q,d,a.CIRC_R)||b.insideCircle(r,d,a.CIRC_R)||i.push({obj:p,coords:p.getOrigin()})):p instanceof j?(o=[p.getCoords("x")+f[0],p.getCoords("y")+f[1]],b.insideCircle(o,d,a.CIRC_R)?m(o,p):i.push({obj:p,coords:p.getCoords()}),e(p.getBonds(),o,p)):p instanceof l&&(o=[p.getAtom().getCoords("x")+f[0],p.getAtom().getCoords("y")+f[1]],b.insideCircle(o,d,a.CIRC_R)?m(o,p.getAtom()):s.push(p),e(p.getAtom().getBonds(),o,p.getAtom()));"undefined"!=typeof g&&g.setBonds(s)}var f,g,h=c.getOrigin(),i=[],m=[];return e(c.getStructure(),h),angular.forEach(i,function(a){var b=a.obj;b instanceof k?b.setOrigin(a.coords):b instanceof j&&b.setCoords(a.coords),m.push(b)}),c.isAromatic()&&(f=c.getDecorate("aromatic"),g=[],angular.forEach(f,function(c){b.insideCircle(c.coords,d,a.AROMATIC_R)||g.push(c)}),c.setDecorate("aromatic",g)),c.setStructure(m),c},i.isWithin=function(c,d){function e(c,h){var i,k,m,n;for(i=0;i<c.length;i+=1)if(n=c[i],n instanceof j||n instanceof l){if(n instanceof j)m=n;else if(m=n.getAtom(),m.isOrphan())continue;k=[m.getCoords("x")+h[0],m.getCoords("y")+h[1]],!f&&b.insideCircle(k,d,a.CIRC_R)?(f=!0,g.foundAtom=m,g.absPos=k):e(m.getBonds(),k)}}var f=!1,g={},h=c.getOrigin();return e(c.getStructure(),h),g},i}angular.module("mmAngularDrawChem").factory("DrawChemModStructure",a),a.$inject=["DrawChemConst","DrawChemUtils","DrawChemStructures","DCAtom","DCBond","DCArrow","DCSelection","DCSvg"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i){function j(a,b,c){var d,e,f,h,i,j,k,l,m=[b[0]-a[0],b[1]-a[1]],n=[-m[1],m[0]],o=[m[1],-m[0]];return"one-way-arrow"===c?(d=[a[0]+m[0]*t,a[1]+m[1]*t],i=g.addVectors(d,o,u),j=g.addVectors(d,n,u),["arrow","M",a,"L",b,"M",d,"L",i,"L",b,"L",j,"Z"]):"two-way-arrow"===c?(d=[a[0]+m[0]*t,a[1]+m[1]*t],e=[a[0]+m[0]*(1-t),a[1]+m[1]*(1-t)],i=g.addVectors(d,o,u),j=g.addVectors(d,n,u),k=g.addVectors(e,o,u),l=g.addVectors(e,n,u),["arrow","M",a,"L",b,"M",d,"L",i,"L",b,"L",j,"Z","M",e,"L",k,"L",a,"L",l,"Z"]):"equilibrium-arrow"===c?(f=g.addVectors(a,o,r),i=g.addVectors(b,o,r),d=[parseFloat(f[0])+m[0]*t,parseFloat(f[1])+m[1]*t],j=g.addVectors(d,o,u),h=g.addVectors(b,n,r),k=g.addVectors(a,n,r),e=[parseFloat(k[0])+m[0]*(1-t),parseFloat(k[1])+m[1]*(1-t)],l=g.addVectors(e,n,u),["arrow-eq","M",f,"L",i,"L",j,"M",h,"L",k,"L",l]):void 0}function k(a,b,c,d){var e=[b[0]-a[0],b[1]-a[1]],h=g.multVectByScalar(e,f.PUSH),i=[-e[1],e[0]],j=[e[1],-e[0]],k=g.addVectors(a,i,r),l=g.addVectors(b,i,r),m=g.addVectors(a,j,r),n=g.addVectors(b,j,r);return c&&p("add",[k,m],h),d&&p("subtract",[l,n],h),["M",k,"L",l,"M",m,"L",n]}function l(a,b,c,d){var e=[b[0]-a[0],b[1]-a[1]],h=g.multVectByScalar(e,f.PUSH),i=[-e[1],e[0]],j=[e[1],-e[0]],k=g.addVectors(a,i,s),l=g.addVectors(b,i,s),m=g.addVectors(a,j,s),n=g.addVectors(b,j,s);return c&&p("add",[k,m,a],h),d&&p("subtract",[l,n,b],h),["M",k,"L",l,"M",a,"L",b,"M",m,"L",n]}function m(a,b,c,d){var e=[b[0]-a[0],b[1]-a[1]],h=g.multVectByScalar(e,f.PUSH),i=[-e[1],e[0]],j=[e[1],-e[0]],k=g.addVectors(b,i,r),l=g.addVectors(b,j,r);return c&&(a=g.addVectors(a,h)),d&&(b=g.subtractVectors(b,h),k=g.addVectors(b,i,r),l=g.addVectors(b,j,r)),["wedge","M",a,"L",k,"L",l,"Z"]}function n(a,b,c,d){var e,h,i,j=10,k=r/j,l=[],m=[b[0]-a[0],b[1]-a[1]],n=g.multVectByScalar(m,f.PUSH),o=a,p=[-m[1],m[0]],q=[m[1],-m[0]];for(c&&(o=g.addVectors(a,n),m=g.subtractVectors(m,n),j-=2),d&&(m=g.subtractVectors(m,n),j-=2),e=j;e>0;e-=1)k+=r/j,o=[o[0]+m[0]/j,o[1]+m[1]/j],h=g.addVectors(o,p,k),i=g.addVectors(o,q,k),l=l.concat(["M",h,"L",i]);return l}function o(a,b){var c,d,e,f,h=g.getQuadrant(a,b);return 1===h?(c=a[0],d=b[1],e=b[0]-c,f=a[1]-d):2===h?(c=b[0],d=b[1],e=a[0]-c,f=a[1]-d):3===h?(c=b[0],d=a[1],e=a[0]-c,f=b[1]-d):4===h&&(c=a[0],d=a[1],e=b[0]-c,f=b[1]-d),0>e&&(e=0),0>f&&(f=0),{"class":"selection",rect:[c,d,e,f]}}function p(a,b,c){var d;b.forEach(function(b){"add"===a?(d=g.addVectors(b,c),b[0]=d[0],b[1]=d[1]):"subtract"===a&&(d=g.subtractVectors(b,c),b[0]=d[0],b[1]=d[1])})}var q={},r=f.BETWEEN_DBL_BONDS,s=f.BETWEEN_TRP_BONDS,t=f.ARROW_START,u=f.ARROW_SIZE,v=c.Atom,w=d.Arrow,x=e.Selection,y=a.Svg;return q.draw=function(a,b){function c(){var b={full:"",mini:""};return h.generateRects(u,b),h.generatePaths(r,b),h.generateCircles(s,b),h.generateLabels(t,b),a.isAromatic()&&h.generateAromatics(a,b),b}function d(a){function b(a,b,e,f,g){var i,j,k,l;for(i=0;i<b.length;i+=1)k=b[i].getAtom(),l=b[i].getType(),j=[a[0]+k.getCoords("x"),a[1]+k.getCoords("y")],d(j),h.updateLabel(D,j,k),C.push({selected:f,circle:[j[0],j[1],H]}),0===i?c(a,j,l,k,"continue",f,g):c(a,j,l,k,"begin",f,g)}function c(c,d,e,h,j,o,p){var q,r=B.length,s=g.addVectors(c,g.multVectByScalar(h.getCoords(),f.PUSH)),t="undefined"!=typeof h.getLabel(),u=g.addVectors(c,g.multVectByScalar(h.getCoords(),1-f.PUSH));h.isOrphan()&&(q=i.isWithin(a,d).foundAtom,t="undefined"!=typeof q.getLabel()),"single"===e?"continue"===j?(p&&(B[r-1].push("M"),B[r-1].push(s)),B[r-1].push("L"),t?B[r-1].push(u):B[r-1].push(d)):"begin"===j&&(r=p&&t?B.push(["M",s,"L",u]):p?B.push(["M",s,"L",d]):t?B.push(["M",c,"L",u]):B.push(["M",c,"L",d])):"double"===e?(B.push(k(c,d,p,t)),r=B.push(["M",d])):"triple"===e?(B.push(l(c,d,p,t)),r=B.push(["M",d])):"wedge"===e?(B.push(m(c,d,p,t)),r=B.push(["M",d])):"dash"===e&&(B.push(n(c,d,p,t)),r=B.push(["M",d])),b(d,h.getBonds(),B[r-1],o,t)}function d(a){a[0]>G.maxX&&(G.maxX=a[0]),a[0]<G.minX&&(G.minX=a[0]),a[1]>G.maxY&&(G.maxY=a[1]),a[1]<G.minY&&(G.minY=a[1])}var e,p,q,r,s,t,u,y,z,A,B=[],C=[],D=[],E=[],F=a.getOrigin(),G={minX:F[0],maxX:F[0],minY:F[1],maxY:F[1]},H=f.CIRC_R;for(e=0;e<a.getStructure().length;e+=1)z=a.getStructure(e),z instanceof x?(t=z,q=g.addVectors(F,t.getOrigin()),r=t.getCurrent(),E.push(o(q,r))):z instanceof v?(u=z,p=g.addVectors(F,u.getCoords()),h.updateLabel(D,p,u),d(p),A="undefined"!=typeof u.getLabel(),s=B.push(["M",p]),C.push({selected:u.selected,circle:[p[0],p[1],H]}),b(p,u.getBonds(),B[s-1],u.isSelected(),A)):z instanceof w&&(y=z,q=g.addVectors(F,y.getOrigin()),r=g.addVectors(F,y.getEnd()),d(q),d(r),C.push({selected:y.isSelected(),circle:[q[0],q[1],H]}),C.push({selected:y.isSelected(),circle:[r[0],r[1],H]}),B.push(j(q,r,y.getType())));return{paths:h.stringifyPaths(B),rects:E,circles:C,labels:D,minMax:G}}var e=y.generateStyle("base"),p=y.generateStyle("expanded"),q=d(a),r=q.paths,s=q.circles,t=q.labels,u=q.rects,z=q.minMax,A=new y(p+c().full,e+c().mini,b);return A.setMinMax(z),A},q}angular.module("mmAngularDrawChem").factory("DrawChemSvgRenderer",a),a.$inject=["DCSvg","DCBond","DCAtom","DCArrow","DCSelection","DrawChemConst","DrawChemUtils","DrawChemSvgUtils","DrawChemModStructure"]}(),function(){"use strict";function a(a,b,c){var d={},e=(a.BONDS,a.BOND_LENGTH),f=a.AROMATIC_R;return d.generateRects=function(a,b){a.forEach(function(a){var c="<rect class='"+a["class"]+"' x='"+a.rect[0].toFixed(2)+"' y='"+a.rect[1].toFixed(2)+"' width='"+a.rect[2].toFixed(2)+"' height='"+a.rect[3].toFixed(2)+"'></rect>";b.full+=c,b.mini+=c})},d.generatePaths=function(a,b){a.forEach(function(a){var c;c="undefined"!=typeof a["class"]?"<path class='"+a["class"]+"' d='"+a.line+"'></path>":"<path d='"+a.line+"'></path>",b.full+=c,b.mini+=c})},d.generateCircles=function(a,b){a.forEach(function(a){var c=a.selected?"edit":"atom";b.full+="<circle class='"+c+"' cx='"+a.circle[0].toFixed(2)+"' cy='"+a.circle[1].toFixed(2)+"' r='"+a.circle[2].toFixed(2)+"'></circle>"})},d.generateLabels=function(a,d){function e(a){return"rl"===a?"end":"start"}function f(a){var d,e,f=!1,g="";for(d=0;d<a.length;d+=1)e=a.substr(d,1),b.isNumeric(e)?(g+="<tspan class='sub' dy='"+.25*c.fontSize+"' >"+e+"</tspan>",f=!0):f?(g+="<tspan dy='-"+.25*c.fontSize+"' >"+e+"</tspan>",f=!1):g+="<tspan>"+e+"</tspan>";return g}a.forEach(function(a){var b="<text dy='0.2125em' x='"+a.labelX.toFixed(2)+"' y='"+a.labelY.toFixed(2)+"' atomx='"+a.atomX.toFixed(2)+"' atomy='"+a.atomY.toFixed(2)+"' text-anchor='"+e(a.mode)+"' >"+f(a.label)+"</text>";d.full+=b,d.mini+=b})},d.generateAromatics=function(a,b){function c(a,b){return"<circle class='"+b+"' cx='"+a.coords[0].toFixed(2)+"' cy='"+a.coords[1].toFixed(2)+"' r='"+f.toFixed(2)+"' ></circle>"}var d=a.getDecorate("aromatic");d.forEach(function(a){b.full+=c(a,"arom"),b.mini+=c(a,"tr-arom")})},d.stringifyPaths=function(a){var b,c,d,e,f,g=[];for(b=0;b<a.length;b+=1){for(d=a[b],f={line:""},c=0;c<d.length;c+=1)e=d[c],"string"==typeof e?"arrow"===e||"arrow-eq"===e||"wedge"===e?f["class"]=e:f.line+=e+" ":"number"==typeof e[0]&&(f.line+=e[0].toFixed(2)+" "+e[1].toFixed(2)+" ");g.push(f)}return g},d.updateLabel=function(a,d,f){function g(){function a(a){var b,c=0;if("undefined"==typeof a)return 0;for(b=0;b<a.length;b+=1)c+=a[b].multiplicity;return c}function f(a){return"rl"===a?.175:"lr"===a?-.175:void 0}function g(){return.09}function h(){function a(){"rl"===f?m.name=1===g?"H"+m.name:"H"+g+m.name:"lr"===f&&(m.name=1===g?m.name+"H":m.name+"H"+g)}function c(){"rl"===f&&(m.name=b.invertGroup(m.name))}function d(){var a=0,b=0;return"undefined"!=typeof j&&j.forEach(function(c){c.vector[0]>0?a+=1:b+=1}),"undefined"!=typeof k&&k.forEach(function(c){c.vector[0]<0?a+=1:b+=1}),a>b?"lr":"rl"}var e,f=i.getMode(),g=0;for(e=0;l>e;e+=1)g+=1;m.hydrogens=g,"undefined"==typeof f&&(f=d(),i.setMode(f)),m.mode=f,g>0?a():c()}var l=i.getMaxBonds()-a(j)-a(k),m={name:i.getLabelName()};return h(),{length:m.name.length,label:m.name,mode:m.mode,atomX:d[0],atomY:d[1],labelX:d[0]+f(m.mode)*e,labelY:d[1]+g()*e,width:c.fontSize*m.name.length,height:c.fontSize}}var h,i=f.getLabel(),j=f.getAttachedBonds("in"),k=f.getAttachedBonds("out");"undefined"!=typeof i&&(h=g(),a.push(h))},d}angular.module("mmAngularDrawChem").factory("DrawChemSvgUtils",a),a.$inject=["DrawChemConst","DrawChemUtils","DCSvg"]}();