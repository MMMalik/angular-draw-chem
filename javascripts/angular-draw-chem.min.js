!function(){"use strict";angular.module("mmAngularDrawChem",["ngSanitize"]).config(["$sanitizeProvider",function(a){a.enableSvg()}])}(),function(){"use strict";function a(a,b,c,d,e,f){return{templateUrl:"draw-chem-editor.html",scope:{showEditor:"="},link:function(e,f,g){e.dialogStyle={},g.width&&(e.dialogStyle.width=g.width),g.height&&(e.dialogStyle.height=g.height),e.closeEditor=function(){c.closeEditor()},e.content=function(){return d.trustAsHtml(c.getContent())},e.clear=function(){c.clearContent()},e.transfer=function(){c.transferContent()},e.chosenStructure,e.currentStructure,e.customButtons=[],angular.forEach(b.custom,function(a){var b=a();e.customButtons.push({name:b.name,choose:function(){e.chosenStructure=b}})}),e.drawShape=function(b){function d(){var a=f.find("dc-content")[0],c=[parseFloat((b.clientX-a.getBoundingClientRect().left-2).toFixed(2)),parseFloat((b.clientY-a.getBoundingClientRect().top-2).toFixed(2))];return c}function g(){""!==c.getContent()?a.modifyStructure(e.currentStructure.getDefault(),angular.copy(e.chosenStructure),h):(e.currentStructure=angular.copy(e.chosenStructure),e.currentStructure.getDefault().getStructure(0).setCoords(h))}var h=d(),i="";g(),i=a.draw(e.currentStructure.getDefault().getStructure(),"cmpd1",e.currentStructure.decorate).generate(),c.setContent(i)}}}}angular.module("mmAngularDrawChem").directive("drawChemEditor",a),a.$inject=["DrawChemShapes","DrawChemStructures","DrawChem","$sce","$window","DrawChemConst"]}(),function(){"use strict";function a(){function a(a,b,c,d){this.coords=a,this.bonds=b,this.info=c,this.next=d}var b={};return a.prototype.setCoords=function(a){this.coords=a},a.prototype.getInfo=function(){return this.info},a.prototype.setPreceding=function(a){this.preceding=a},a.prototype.getPreceding=function(a){return"x"===a?this.preceding[0]:"y"===a?this.preceding[1]:this.preceding},a.prototype.getNext=function(){return this.next},a.prototype.setNext=function(a){this.next=a},a.prototype.getCoords=function(a){return"x"===a?this.coords[0]:"y"===a?this.coords[1]:this.coords},a.prototype.getBonds=function(a){return 0===arguments.length?this.bonds:this.bonds[a]},a.prototype.addBond=function(a){this.bonds.push(a)},a.prototype.addBonds=function(a){a.forEach(function(a){this.bonds.push(a)},this)},b.Atom=a,b}angular.module("mmAngularDrawChem").factory("DCAtom",a)}(),function(){"use strict";function a(a){function b(b,c){this.element=b,this.id=c,this.scale=1,this.transformAttr="",this.style={path:{stroke:"black","stroke-width":a.BOND_WIDTH*this.scale,fill:"none"},"circle.atom:hover":{opacity:"0.3",stroke:"black","stroke-width":a.BOND_WIDTH*this.scale},"circle.atom":{opacity:"0"},"circle.arom":{stroke:"black","stroke-width":a.BOND_WIDTH*this.scale,fill:"none"}}}var c={};return b.prototype.wrap=function(a,b){var c,d={};return"g"!==a||b||(b=d,b.id=this.id),b?(c="<"+a+" ",angular.forEach(b,function(a,b){c+=b+"='"+a+"' "}),this.element=c+">"+this.element+"</"+a+">"):this.element="<"+a+">"+this.element+"</"+a+">",this},b.prototype.transform=function(a,b){return this.transformAttr&&(this.transformAttr+=" "),this.transformAttr+=a+"("+b[0],b.length>1&&(this.transformAttr+=","+b[1]),this.transformAttr+=")",this},b.prototype.style=function(a){},b.prototype.generateUse=function(){return"<use xmlns:xlink='http://www.w3.org/1999/xlink' xlink:href='#"+this.id+"' transform='"+this.transformAttr+"'></use>"},b.prototype.generateStyle=function(){var a='<style type="text/css">';return angular.forEach(this.style,function(b,c){a+=c+"{",angular.forEach(b,function(b,c){a+=c+":"+b+";"}),a+="}"}),a+"</style>"},b.prototype.generate=function(){return this.wrap("svg").element},c.Shape=b,c}angular.module("mmAngularDrawChem").factory("DCShape",a),a.$inject=["DrawChemConst"]}(),function(){"use strict";function a(){function a(a,b){this.name=a,this.structure=b,this.transform=[],this.origin=[]}var b={};return a.prototype.setTransform=function(a,b){this.transform.push({name:a,content:b})},a.prototype.getTransform=function(a){var b,c=this.transform;for(b=0;b<c.length;b+=1)if(c[b].name===a)return c[b].content},a.prototype.setOrigin=function(a){this.origin=a},a.prototype.getOrigin=function(){return this.origin},a.prototype.setStructure=function(a){this.structure=a},a.prototype.getStructure=function(a){return 0===arguments.length?this.structure:this.structure[a]},a.prototype.getName=function(){return this.name},b.Structure=a,b}angular.module("mmAngularDrawChem").factory("DCStructure",a)}(),function(){"use strict";function a(){function a(){b.BOND_LENGTH=b.SET_BOND_LENGTH||20,b.WIDTH_TO_LENGTH=.04,b.BOND_WIDTH=parseFloat((b.BOND_LENGTH*b.WIDTH_TO_LENGTH).toFixed(2)),b.CIRC_R=.12*b.BOND_LENGTH,b.BOND_N=[0,-b.BOND_LENGTH],b.BOND_S=[0,b.BOND_LENGTH],b.BOND_E=[parseFloat((b.BOND_LENGTH*Math.sqrt(3)/2).toFixed(2)),0],b.BOND_W=[-parseFloat((b.BOND_LENGTH*Math.sqrt(3)/2).toFixed(2)),0],b.BOND_NE=[parseFloat((b.BOND_LENGTH*Math.sqrt(3)/2).toFixed(2)),-b.BOND_LENGTH/2],b.BOND_NW=[-parseFloat((b.BOND_LENGTH*Math.sqrt(3)/2).toFixed(2)),-b.BOND_LENGTH/2],b.BOND_SE=[parseFloat((b.BOND_LENGTH*Math.sqrt(3)/2).toFixed(2)),b.BOND_LENGTH/2],b.BOND_SW=[-parseFloat((b.BOND_LENGTH*Math.sqrt(3)/2).toFixed(2)),b.BOND_LENGTH/2],b.BONDS=[{direction:"N",bond:b.BOND_N},{direction:"S",bond:b.BOND_S},{direction:"E",bond:b.BOND_E},{direction:"W",bond:b.BOND_W},{direction:"NE",bond:b.BOND_NE},{direction:"NW",bond:b.BOND_NW},{direction:"SE",bond:b.BOND_SE},{direction:"SW",bond:b.BOND_SW}]}var b={};return b.SET_BOND_LENGTH,b.setBondLength=function(c){b.SET_BOND_LENGTH=c,a()},a(),b}angular.module("mmAngularDrawChem").factory("DrawChemConst",a)}(),function(){"use strict";function a(){function a(a){for(var b=0;b<f.length;b++)if(f[b].name===a)return!0;return!1}function b(a){for(var b=0;b<f.length;b++)if(f[b].name===a)return f[b]}function c(a,b){var c;for(c=0;c<f.length;c++)if(f[c].name===b)return f[c].content=a;f.push({name:b,content:a})}var d={},e=!1,f=[],g={};return d.showEditor=function(){return e},d.runEditor=function(c){var d;e=!0,a(c)||f.push({name:c,content:""}),d=b(c),g.name=d.name,g.content=d.content},d.getContent=function(a){if("string"==typeof a){var c=b(a);return"undefined"==typeof c?"":c.content}return g.content},d.setContent=function(a,b){"undefined"==typeof b?g.content=a:c(a,b)},d.transferContent=function(){c(g.content,g.name)},d.closeEditor=function(){e=!1,g={}},d.clearContent=function(a){"string"==typeof a?c("",a):g.content=""},d}angular.module("mmAngularDrawChem").factory("DrawChem",a)}(),function(){"use strict";function a(a,b){function c(a){function c(a,b,d){var h,i,j,k=[f[f.length-1][0],f[f.length-1][1]];for(b.length>0&&(j=[k[0]+b[0].getCoords("x"),k[1]+b[0].getCoords("y")],f.push([j[0],j[1],g]),d.push("L"),d.push(j),"Z"===b[0].getInfo()?(d.push("Z"),b[0].getBonds().length>0&&(i=e.push(["M",j]),c(j,b[0].getBonds(),e[i-1]))):c(b[0].getCoords(),b[0].getBonds(),d)),h=1;h<b.length;h+=1)j=[k[0]+b[h].getCoords("x"),k[1]+b[h].getCoords("y")],f.push([j[0],j[1],g]),i=e.push(["M",k,"L",j]),c(j,b[h].getBonds(),e[i-1])}function d(){var a,b,c,d,f,g=[];for(a=0;a<e.length;a+=1){for(c=e[a],f="",b=0;b<c.length;b+=1)d=c[b],f+="string"==typeof d?d+" ":d[0]+" "+d[1]+" ";g.push(f)}return g}var e=[],f=[],g=b.CIRC_R,h=e.push(["M",a[0].getCoords()]);return f.push([a[0].getCoords("x"),a[0].getCoords("y"),g]),c(a[0].getCoords(),a[0].getBonds(),e[h-1]),{paths:d(),circles:f}}var d={};return d.modifyStructure=function(a,c,d){function e(b,c){var h,k;for(h=0;h<b.length;h+=1){if(k=[b[h].getCoords("x")+c[0],b[h].getCoords("y")+c[1]],f(k[0],d[0])&&f(k[1],d[1]))return j||(i=g(b[h]),b[h].addBonds(i),j=!0),a;e(b[h].getBonds(),k)}}function f(a,c){var d=b.CIRC_R;return Math.abs(a-c)<d}function g(a){var b,d;if(1===c.defs.length)return c.getDefault().getStructure(0).getBonds();for(b=0;b<c.defs.length;b+=1)if(d=c.defs[b],a.getNext()===d.getName())return h(a,d),d.getStructure(0).getBonds()}function h(a,c){function d(){var a,c=b.BONDS;for(a=0;a<c.length;a+=1)if(c[a].bond[0]===e&&c[a].bond[1]===f)return c[a].direction}var e=a.getCoords("x"),f=a.getCoords("y"),g=d(),h=c.getName();"N"===g&&"NE"===h?a.setNext("NW"):"N"===g&&"NW"===h?a.setNext("NE"):"S"===g&&"SE"===h?a.setNext("SW"):"S"===g&&"SW"===h?a.setNext("SE"):"SW"===g&&"S"===h?a.setNext("NW"):"SW"===g&&"NW"===h?a.setNext("S"):"SE"===g&&"S"===h?a.setNext("NE"):"SE"===g&&"NE"===h?a.setNext("S"):"NW"===g&&"SW"===h?a.setNext("N"):"NW"===g&&"N"===h?a.setNext("SW"):"NE"===g&&"N"===h?a.setNext("SE"):"NE"===g&&"SE"===h&&a.setNext("N")}var i,j=!1,k=a.getStructure(0).getCoords();return f(k[0],d[0])&&f(k[1],d[1])?(i=g(a.getStructure(0)),a.getStructure(0).addBonds(i),a):void e(a.getStructure(0).getBonds(),k)},d.draw=function(d,e,f){function g(){var a="";return j.forEach(function(b){a+="<path d='"+b+"'></path>"}),k.forEach(function(b){a+="<circle class='atom' cx='"+b[0]+"' cy='"+b[1]+"' r='"+b[2]+"' ></circle>"}),"aromatic"===f&&(a+="<circle class='arom' cx='"+d[0].getCoords("x")+"' cy='"+(d[0].getCoords("y")+b.BOND_LENGTH)+"' r='"+.45*b.BOND_LENGTH+"' ></circle>"),a}var h,i=c(d),j=i.paths,k=i.circles;return h=new a.Shape(g(),e),h.element=h.generateStyle()+h.element,h.wrap("g")},d}angular.module("mmAngularDrawChem").factory("DrawChemShapes",a),a.$inject=["DCShape","DrawChemConst"]}(),function(){"use strict";function a(a,b,c){var d={},e=c.Atom,f=a.BOND_N,g=a.BOND_S,h=a.BOND_W,i=a.BOND_E,j=a.BOND_NE,k=a.BOND_NW,l=a.BOND_SE,m=a.BOND_SW;return d.benzene=function(){return{name:"benzene",getDefault:function(){return this.defs[0]},decorate:"aromatic",defs:[new b.Structure("N",[new e([0,0],[new e(l,[new e(g,[new e(m,[new e(k,[new e(f,[],"Z","NW")],"","SW")],"","S")],"","SE")],"","NE")],"","N")])]}},d.cyclohexane=function(){return{name:"cyclohexane",getDefault:function(){return this.defs[0]},defs:[new b.Structure("N",[new e([0,0],[new e(l,[new e(g,[new e(m,[new e(k,[new e(f,[],"Z","NW")],"","SW")],"","S")],"","SE")],"","NE")],"","N")])]}},d.singleBond=function(){return{name:"single-bond",getDefault:function(){return this.defs[0]},defs:[new b.Structure("N",[new e([0,0],[new e(f,[],"","NE")],"","SW")]),new b.Structure("NE",[new e([0,0],[new e(j,[],"","SE")],"","NW")]),new b.Structure("E",[new e([0,0],[new e(i,[],"","SE")],"","NW")]),new b.Structure("SE",[new e([0,0],[new e(l,[],"","NE")],"","SW")]),new b.Structure("S",[new e([0,0],[new e(g,[],"","SW")],"","NE")]),new b.Structure("SW",[new e([0,0],[new e(m,[],"","NW")],"","SE")]),new b.Structure("W",[new e([0,0],[new e(h,[],"","SW")],"","NE")]),new b.Structure("NW",[new e([0,0],[new e(k,[],"","SW")],"","SE")])]}},d.custom=[d.benzene,d.cyclohexane,d.singleBond],d}angular.module("mmAngularDrawChem").factory("DrawChemStructures",a),a.$inject=["DrawChemConst","DCStructure","DCAtom"]}();